/*!
 *  ____  _   _  ___  _____  ___  _   _ _____ ____ _    _ ____ ____
 * |  _ \| | | |/ _ \|_   _|/ _ \| | | |_   _|  __| |  | |  __|  _ \
 * | |_| | |_| | | | | | | | | | | | | | | | | |__| |  | | |__| |_| |
 * |  __/|  _  | | | | | | | | | | |_| | | | |  __| |/\| |  __|    /
 * | |   | | | | |_| | | | | |_| |\   / _| |_| |__|  /\  | |__| |\ \
 * |_|   |_| |_|\___/  |_|  \___/  \_/ |_____|____|_/  \_|____|_| \_\
 *
 * photoviewer - v3.0.0-beta.1
 * A JS plugin to view images just like in Windows
 * https://github.com/nzbin/photoviewer#readme
 *
 * Copyright (c) 2018 nzbin
 * Released under MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.photoviewer=e()}(this,function(){"use strict";var k=function(t,e){return new k.fn.init(t,e)},c=window.document,n=[],o=n.concat,s=n.filter,l=n.slice,e={},i={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},r=/^\s*<(\w+|!)[^>]*>/,a=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,h=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,u=/^(?:body|html)$/i,f=["val","css","html","text","data","width","height","offset"],t=c.createElement("table"),d=c.createElement("tr"),p={tr:c.createElement("tbody"),tbody:t,thead:t,tfoot:t,td:d,th:d,"*":c.createElement("div")},g=/^[\w-]*$/,m={},v=m.toString,w=c.createElement("div"),x={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},b=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},y=c.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1};function z(t){return null==t?String(t):m[v.call(t)]||"object"}function M(t){return"function"==z(t)}function C(t){return null!=t&&t==t.window}function T(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function L(t){return"object"==z(t)}function H(t){return L(t)&&!C(t)&&Object.getPrototypeOf(t)==Object.prototype}function E(t){var e=!!t&&"length"in t&&t.length,i=z(t);return"function"!=i&&!C(t)&&("array"==i||0===e||"number"==typeof e&&0<e&&e-1 in t)}function D(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function O(t,e){return"number"!=typeof e||i[D(t)]?e:e+"px"}function A(i){return s.call(i,function(t,e){return i.indexOf(t)==e})}function V(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function I(t){return t in e?e[t]:e[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function S(t){return"children"in t?l.call(t.children):k.map(t.childNodes,function(t){if(1==t.nodeType)return t})}function R(t){return t instanceof k}function j(t,e){return null==e?k(t):k(t).filter(e)}function N(t,e,i,n){return M(e)?e.call(t,i,n):e}function P(t,e,i){null==i?t.removeAttribute(e):t.setAttribute(e,i)}function F(t,e){var i=t.className||"",n=i&&void 0!==i.baseVal;if(void 0===e)return n?i.baseVal:i;n?i.baseVal=e:t.className=e}k.fn=k.prototype={constuctor:k,length:0,forEach:n.forEach,reduce:n.reduce,push:n.push,sort:n.sort,splice:n.splice,indexOf:n.indexOf,init:function(t,e){var i,n;if(!t)return this;if("string"==typeof t)if("<"==(t=t.trim())[0]&&r.test(t))i=k.fragment(t,RegExp.$1,e),t=null;else{if(void 0!==e)return k(e).find(t);i=k.qsa(c,t)}else{if(M(t))return k(c).ready(t);if(R(t))return t;if(b(t))n=t,i=s.call(n,function(t){return null!=t});else if(L(t))i=[t],t=null;else{if(void 0!==e)return k(e).find(t);i=k.qsa(c,t)}}return k.makeArray(i,t,this)},concat:function(){var t,e,i=[];for(t=0;t<arguments.length;t++)e=arguments[t],i[t]=R(e)?e.toArray():e;return o.apply(R(this)?this.toArray():this,i)},pluck:function(e){return k.map(this,function(t){return t[e]})},toArray:function(){return this.get()},get:function(t){return void 0===t?l.call(this):this[0<=t?t:t+this.length]},size:function(){return this.length},each:function(i){return n.every.call(this,function(t,e){return!1!==i.call(t,e,t)}),this},map:function(i){return k(k.map(this,function(t,e){return i.call(t,e,t)}))},slice:function(){return k(l.apply(this,arguments))},first:function(){var t=this[0];return t&&!L(t)?t:k(t)},last:function(){var t=this[this.length-1];return t&&!L(t)?t:k(t)},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)}},k.extend=k.fn.extend=function(){var t,e,i,n,o,s,r=arguments[0]||{},a=1,h=arguments.length,l=!1;for("boolean"==typeof r&&(l=r,r=arguments[a]||{},a++),"object"==typeof r||M(r)||(r={}),a===h&&(r=this,a--);a<h;a++)if(null!=(t=arguments[a]))for(e in t)i=r[e],r!==(n=t[e])&&(l&&n&&(H(n)||(o=Array.isArray(n)))?(s=o?(o=!1,i&&Array.isArray(i)?i:[]):i&&H(i)?i:{},r[e]=k.extend(l,s,n)):void 0!==n&&(r[e]=n));return r},k.extend({makeArray:function(t,e,i){var n,o=t?t.length:0;for(n=0;n<o;n++)i[n]=t[n];return i.length=o,i.selector=e||"",i},qsa:function(t,e){var i,n="#"==e[0],o=!n&&"."==e[0],s=n||o?e.slice(1):e,r=g.test(s);return t.getElementById&&r&&n?(i=t.getElementById(s))?[i]:[]:1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType?[]:l.call(r&&!n&&t.getElementsByClassName?o?t.getElementsByClassName(s):t.getElementsByTagName(e):t.querySelectorAll(e))},fragment:function(t,e,i){var n,o,s;return a.test(t)&&(n=k(c.createElement(RegExp.$1))),n||(t.replace&&(t=t.replace(h,"<$1></$2>")),void 0===e&&(e=r.test(t)&&RegExp.$1),e in p||(e="*"),(s=p[e]).innerHTML=""+t,n=k.each(l.call(s.childNodes),function(){s.removeChild(this)})),H(i)&&(o=k(n),k.each(i,function(t,e){-1<f.indexOf(t)?o[t](e):o.attr(t,e)})),n},matches:function(t,e){if(!e||!t||1!==t.nodeType)return!1;var i=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(i)return i.call(t,e);var n,o=t.parentNode,s=!o;return s&&(o=w).appendChild(t),n=~k.qsa(o,e).indexOf(t),s&&w.removeChild(t),n},each:function(t,e){var i,n;if(E(t)){for(i=0;i<t.length;i++)if(!1===e.call(t[i],i,t[i]))return t}else for(n in t)if(!1===e.call(t[n],n,t[n]))return t;return t},map:function(t,e){var i,n,o,s,r=[];if(E(t))for(n=0;n<t.length;n++)null!=(i=e(t[n],n))&&r.push(i);else for(o in t)null!=(i=e(t[o],o))&&r.push(i);return 0<(s=r).length?k.fn.concat.apply([],s):s}}),k.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){m["[object "+e+"]"]=e.toLowerCase()}),k.fn.init.prototype=k.fn;var B=Object.freeze({type:z,contains:y,camelCase:V,isFunction:M,isWindow:C,isPlainObject:H,isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isNumeric:function(t){var e=Number(t),i=typeof t;return null!=t&&"boolean"!=i&&("string"!=i||t.length)&&!isNaN(e)&&isFinite(e)||!1},isArray:b,inArray:function(t,e,i){return emptyArray.indexOf.call(e,t,i)},trim:function(t){return null==t?"":String.prototype.trim.call(t)},grep:function(t,e){return s.call(t,e)},noop:function(){}});var _=Object.freeze({css:function(t,e){if(arguments.length<2){var i=this[0];if("string"==typeof t){if(!i)return;return i.style[V(t)]||getComputedStyle(i,"").getPropertyValue(t)}if(b(t)){if(!i)return;var n={},o=getComputedStyle(i,"");return k.each(t,function(t,e){n[e]=i.style[V(e)]||o.getPropertyValue(e)}),n}}var s="";if("string"==z(t))e||0===e?s=D(t)+":"+O(t,e):this.each(function(){this.style.removeProperty(D(t))});else for(var r in t)t[r]||0===t[r]?s+=D(r)+":"+O(r,t[r])+";":this.each(function(){this.style.removeProperty(D(r))});return this.each(function(){this.style.cssText+=";"+s})}});var W=Object.freeze({hasClass:function(t){return!!t&&n.some.call(this,function(t){return this.test(F(t))},I(t))},addClass:function(i){var n=[];return i?this.each(function(t){if("className"in this){n=[];var e=F(this);N(this,i,t,e).split(/\s+/g).forEach(function(t){k(this).hasClass(t)||n.push(t)},this),n.length&&F(this,e+(e?" ":"")+n.join(" "))}}):this},removeClass:function(e){var i=[];return this.each(function(t){if("className"in this){if(void 0===e)return F(this,"");i=F(this),N(this,e,t,i).split(/\s+/g).forEach(function(t){i=i.replace(I(t)," ")}),F(this,i.trim())}})},toggleClass:function(i,n){return i?this.each(function(t){var e=k(this);N(this,i,t,F(this)).split(/\s+/g).forEach(function(t){(void 0===n?!e.hasClass(t):n)?e.addClass(t):e.removeClass(t)})}):this}});var Y=Object.freeze({offset:function(s){if(s)return this.each(function(t){var e=k(this),i=N(this,s,t,e.offset()),n=e.offsetParent().offset(),o={top:i.top-n.top,left:i.left-n.left};"static"==e.css("position")&&(o.position="relative"),e.css(o)});if(!this.length)return null;if(c.documentElement!==this[0]&&!y(c.documentElement,this[0]))return{top:0,left:0};var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),i=this.offset(),n=u.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(k(t).css("margin-top"))||0,i.left-=parseFloat(k(t).css("margin-left"))||0,n.top+=parseFloat(k(e[0]).css("border-top-width"))||0,n.left+=parseFloat(k(e[0]).css("border-left-width"))||0,{top:i.top-n.top,left:i.left-n.left}}},scrollTop:function(t){if(this.length){var e="scrollTop"in this[0];return void 0===t?e?this[0].scrollTop:C(this[0])?this[0].pageYOffset:this[0].defaultView.pageYOffset:this.each(e?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var e="scrollLeft"in this[0];return void 0===t?e?this[0].scrollLeft:C(this[0])?this[0].pageXOffset:this[0].defaultView.pageXOffset:this.each(e?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||c.body;t&&!u.test(t.nodeName)&&"static"==k(t).css("position");)t=t.offsetParent;return t})}});var X=Object.freeze({attr:function(i,n){var t;return"string"!=typeof i||1 in arguments?this.each(function(t){if(1===this.nodeType)if(L(i))for(var e in i)P(this,e,i[e]);else P(this,i,N(this,n,t,this.getAttribute(i)))}):0 in this&&1==this[0].nodeType&&null!=(t=this[0].getAttribute(i))?t:void 0},removeAttr:function(t){return this.each(function(){1===this.nodeType&&t.split(" ").forEach(function(t){P(this,t)},this)})}});var q=Object.freeze({prop:function(i,n){return"string"!=typeof(i=x[i]||i)||1 in arguments?this.each(function(t){if(L(i))for(var e in i)this[x[e]||e]=i[e];else this[i]=N(this,n,t,this[i])}):this[0]&&this[0][i]},removeProp:function(t){return t=x[t]||t,this.each(function(){delete this[t]})}});var Z=Object.freeze({val:function(e){return 0 in arguments?(null==e&&(e=""),this.each(function(t){this.value=N(this,e,t,this.value)})):this[0]&&(this[0].multiple?k(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)}});var K=Object.freeze({wrap:function(e){var i=M(e);if(this[0]&&!i)var n=k(e).get(0),o=n.parentNode||1<this.length;return this.each(function(t){k(this).wrapAll(i?e.call(this,t):o?n.cloneNode(!0):n)})},wrapAll:function(t){if(this[0]){var e;for(k(this[0]).before(t=k(t));(e=t.children()).length;)t=e.first();k(t).append(this)}return this},wrapInner:function(o){var s=M(o);return this.each(function(t){var e=k(this),i=e.contents(),n=s?o.call(this,t):o;i.length?i.wrapAll(n):e.append(n)})},unwrap:function(){return this.parent().each(function(){k(this).replaceWith(k(this).children())}),this}});var U=Object.freeze({find:function(t){var i=this;return t?"object"==typeof t?k(t).filter(function(){var e=this;return n.some.call(i,function(t){return y(t,e)})}):1==this.length?k(k.qsa(this[0],t)):this.map(function(){return k.qsa(this,t)}):k()},filter:function(e){return M(e)?this.not(this.not(e)):k(s.call(this,function(t){return k.matches(t,e)}))},has:function(t){return this.filter(function(){return L(t)?y(this,t):k(this).find(t).size()})},not:function(e){var i=[];if(M(e)&&void 0!==e.call)this.each(function(t){e.call(this,t)||i.push(this)});else{var n="string"==typeof e?this.filter(e):E(e)&&M(e.item)?l.call(e):k(e);this.forEach(function(t){n.indexOf(t)<0&&i.push(t)})}return k(i)},is:function(t){return"string"==typeof t?0<this.length&&k.matches(this[0],t):t&&this.selector==t.selector},add:function(t,e){return k(A(this.concat(k(t,e))))},contents:function(){return this.map(function(){return this.contentDocument||l.call(this.childNodes)})},closest:function(i,n){var o=[],s="object"==typeof i&&k(i);return this.each(function(t,e){for(;e&&!(s?0<=s.indexOf(e):k.matches(e,i));)e=e!==n&&!T(e)&&e.parentNode;e&&o.indexOf(e)<0&&o.push(e)}),k(o)},parents:function(t){for(var e=[],i=this;0<i.length;)i=k.map(i,function(t){if((t=t.parentNode)&&!T(t)&&e.indexOf(t)<0)return e.push(t),t});return j(e,t)},parent:function(t){return j(A(this.pluck("parentNode")),t)},children:function(t){return j(this.map(function(){return S(this)}),t)},siblings:function(t){return j(this.map(function(t,e){return s.call(S(e.parentNode),function(t){return t!==e})}),t)},prev:function(t){return k(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return k(this.pluck("nextElementSibling")).filter(t||"*")},index:function(t){return t?this.indexOf(k(t)[0]):this.parent().children().indexOf(this[0])}});function G(e,i){var t,n,o=e.replace(/./,function(t){return t[0].toUpperCase()}),s=this[0];return void 0===i?C(s)?s["inner"+o]:T(s)?s.documentElement["scroll"+o]:(n=e,"border-box"===(t=this).css("box-sizing")?"width"===n?parseFloat(t.css(n))-parseFloat(t.css("padding-left"))-parseFloat(t.css("padding-right"))-parseFloat(t.css("border-left"))-parseFloat(t.css("border-right")):parseFloat(t.css(n))-parseFloat(t.css("padding-top"))-parseFloat(t.css("padding-bottom"))-parseFloat(t.css("border-top"))-parseFloat(t.css("border-bottom")):parseFloat(t.css(n))):this.each(function(t){(s=k(this)).css(e,N(this,i,t,s[e]()))})}var J=Object.freeze({width:function(t){return G.call(this,"width",t)},height:function(t){return G.call(this,"height",t)}}),Q=function(t,e){e(t);for(var i=0,n=t.childNodes.length;i<n;i++)Q(t.childNodes[i],e)},tt=function(t,e,n,o){var i,s=k.map(e,function(t){var e=[];return"array"==(i=z(t))?(t.forEach(function(t){return void 0!==t.nodeType?e.push(t):R(t)?e=e.concat(t.get()):void(e=e.concat(k.fragment(t)))}),e):"object"==i||null==t?t:k.fragment(t)}),r=1<t.length;return s.length<1?t:t.each(function(t,e){parent=o?e:e.parentNode;var i=y(c.documentElement,parent);s.forEach(function(t){if(r)t=t.cloneNode(!0);else if(!parent)return k(t).remove();n.call(e,t),i&&Q(t,function(t){if(!(null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src)){var e=t.ownerDocument?t.ownerDocument.defaultView:window;e.eval.call(e,t.innerHTML)}})})})};var et=Object.freeze({remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},empty:function(){return this.each(function(){this.innerHTML=""})},clone:function(){return this.map(function(){return this.cloneNode(!0)})},html:function(i){return 0 in arguments?this.each(function(t){var e=this.innerHTML;k(this).empty().append(N(this,i,t,e))}):0 in this?this[0].innerHTML:null},text:function(i){return 0 in arguments?this.each(function(t){var e=N(this,i,t,this.textContent);this.textContent=null==e?"":""+e}):0 in this?this.pluck("textContent").join(""):null},replaceWith:function(t){return this.before(t).remove()},append:function(){return tt(this,arguments,function(t){this.insertBefore(t,null)},!0)},prepend:function(){return tt(this,arguments,function(t){this.insertBefore(t,this.firstChild)},!0)},after:function(){return tt(this,arguments,function(t){this.parentNode.insertBefore(t,this.nextSibling)},!1)},before:function(){return tt(this,arguments,function(t){this.parentNode.insertBefore(t,this)},!1)},appendTo:function(t){return k(t).append(this),this},prependTo:function(t){return k(t).prepend(this),this},insertAfter:function(t){return k(t).after(this),this},insertBefore:function(t){return k(t).before(this),this},replaceAll:function(t){return k(t).replaceWith(this),this}}),it=1,nt={},ot={click:"MouseEvents",mousedown:"MouseEvents",mouseup:"MouseEvents",mousemove:"MouseEvents"},st="onfocusin"in window,rt={focus:"focusin",blur:"focusout"},at={mouseenter:"mouseover",mouseleave:"mouseout"},ht=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,lt={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function ct(t){return"string"==typeof t}function ut(){return!0}function ft(){return!1}function dt(t){return t._zid||(t._zid=it++)}function pt(t,e,i,n){if((e=gt(e)).ns)var o=(s=e.ns,new RegExp("(?:^| )"+s.replace(" "," .* ?")+"(?: |$)"));var s;return(nt[dt(t)]||[]).filter(function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||o.test(t.ns))&&(!i||dt(t.fn)===dt(i))&&(!n||t.sel==n)})}function gt(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function mt(t,e){return t.del&&!st&&t.e in rt||!!e}function vt(t){return at[t]||st&&rt[t]||t}function wt(o,t,e,s,r,a,h){var i=dt(o),l=nt[i]||(nt[i]=[]);t.split(/\s/).forEach(function(t){if("ready"==t)return k(c).ready(e);var i=gt(t);i.fn=e,i.sel=r,i.e in at&&(e=function(t){var e=t.relatedTarget;if(!e||e!==this&&!y(this,e))return i.fn.apply(this,arguments)});var n=(i.del=a)||e;i.proxy=function(t){if(!(t=bt(t)).isImmediatePropagationStopped()){t.data=s;var e=n.apply(o,null==t._args?[t]:[t].concat(t._args));return!1===e&&(t.preventDefault(),t.stopPropagation()),e}},i.i=l.length,l.push(i),"addEventListener"in o&&o.addEventListener(vt(i.e),i.proxy,mt(i,h))})}function xt(e,t,i,n,o){var s=dt(e);(t||"").split(/\s/).forEach(function(t){pt(e,t,i,n).forEach(function(t){delete nt[s][t.i],"removeEventListener"in e&&e.removeEventListener(vt(t.e),t.proxy,mt(t,o))})})}function bt(n,o){if(o||!n.isDefaultPrevented){o||(o=n),k.each(lt,function(t,e){var i=o[t];n[t]=function(){return this[e]=ut,i&&i.apply(o,arguments)},n[e]=ft});try{n.timeStamp||(n.timeStamp=Date.now())}catch(t){}(void 0!==o.defaultPrevented?o.defaultPrevented:"returnValue"in o?!1===o.returnValue:o.getPreventDefault&&o.getPreventDefault())&&(n.isDefaultPrevented=ut)}return n}function yt(t){var e,i={originalEvent:t};for(e in t)ht.test(e)||void 0===t[e]||(i[e]=t[e]);return bt(i,t)}k.event={add:wt,remove:xt},k.Event=function(t,e){ct(t)||(t=(e=t).type);var i=c.createEvent(ot[t]||"Events"),n=!0;if(e)for(var o in e)"bubbles"==o?n=!!e[o]:i[o]=e[o];return i.initEvent(t,n,!0),bt(i)},k.proxy=function(t,e){var i=2 in arguments&&l.call(arguments,2);if(M(t)){var n=function(){return t.apply(e,i?i.concat(l.call(arguments)):arguments)};return n._zid=dt(t),n}if(ct(e))return i?(i.unshift(t[e],t),k.proxy.apply(null,i)):k.proxy(t[e],t);throw new TypeError("expected function")};"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){k.fn[e]=function(t){return 0 in arguments?this.on(e,t):this.trigger(e)}});var zt,$t,Mt,Ct,Tt,Lt,Ht,Et,Dt,Ot,At=Object.freeze({one:function(t,e,i,n){return this.on(t,e,i,n,1)},on:function(e,o,i,s,r){var a,h,n=this;return e&&!ct(e)?(k.each(e,function(t,e){n.on(t,o,i,e,r)}),n):(ct(o)||M(s)||!1===s||(s=i,i=o,o=void 0),void 0!==s&&!1!==i||(s=i,i=void 0),!1===s&&(s=ft),n.each(function(t,n){r&&(a=function(t){return xt(n,t.type,s),s.apply(this,arguments)}),o&&(h=function(t){var e,i=k(t.target).closest(o,n).get(0);if(i&&i!==n)return e=k.extend(yt(t),{currentTarget:i,liveFired:n}),(a||s).apply(i,[e].concat(l.call(arguments,1)))}),wt(n,e,s,i,o,h||a)}))},off:function(t,i,e){var n=this;return t&&!ct(t)?(k.each(t,function(t,e){n.off(t,i,e)}),n):(ct(i)||M(e)||!1===e||(e=i,i=void 0),!1===e&&(e=ft),n.each(function(){xt(this,t,e,i)}))},trigger:function(t,e){return(t=ct(t)||H(t)?k.Event(t):bt(t))._args=e,this.each(function(){t.type in rt&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):k(this).triggerHandler(t,e)})},triggerHandler:function(i,n){var o,s;return this.each(function(t,e){(o=yt(ct(i)?k.Event(i):i))._args=n,o.target=e,k.each(pt(e,i.type||i),function(t,e){if(s=e.proxy(o),o.isImmediatePropagationStopped())return!1})}),s}}),Vt="",It=c.createElement("div"),St=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,Rt={};function kt(t){return zt?zt+t:t.toLowerCase()}void 0===It.style.transform&&k.each({Webkit:"webkit",Moz:"",O:"o"},function(t,e){if(void 0!==It.style[t+"TransitionProperty"])return Vt="-"+t.toLowerCase()+"-",zt=e,!1}),$t=Vt+"transform",Rt[Mt=Vt+"transition-property"]=Rt[Ct=Vt+"transition-duration"]=Rt[Lt=Vt+"transition-delay"]=Rt[Tt=Vt+"transition-timing-function"]=Rt[Ht=Vt+"animation-name"]=Rt[Et=Vt+"animation-duration"]=Rt[Ot=Vt+"animation-delay"]=Rt[Dt=Vt+"animation-timing-function"]="",k.fx={off:void 0===zt&&void 0===It.style.transitionProperty,speeds:{_default:400,fast:200,slow:600},cssPrefix:Vt,transitionEnd:kt("TransitionEnd"),animationEnd:kt("AnimationEnd")};It=null;var jt=Object.freeze({animate:function(t,e,i,n,o){return M(e)&&(n=e,e=i=void 0),M(i)&&(n=i,i=void 0),H(e)&&(i=e.easing,n=e.complete,o=e.delay,e=e.duration),e&&(e=("number"==typeof e?e:k.fx.speeds[e]||k.fx.speeds._default)/1e3),o&&(o=parseFloat(o)/1e3),this.anim(t,e,i,n,o)},anim:function(t,e,i,n,o){var s,r,a,h={},l="",c=this,u=k.fx.transitionEnd,f=!1;if(void 0===e&&(e=k.fx.speeds._default/1e3),void 0===o&&(o=0),k.fx.off&&(e=0),"string"==typeof t)h[Ht]=t,h[Et]=e+"s",h[Ot]=o+"s",h[Dt]=i||"linear",u=k.fx.animationEnd;else{for(s in r=[],t)St.test(s)?l+=s+"("+t[s]+") ":(h[s]=t[s],r.push(s.replace(/([A-Z])/g,"-$1").toLowerCase()));l&&(h[$t]=l,r.push($t)),0<e&&"object"==typeof t&&(h[Mt]=r.join(", "),h[Ct]=e+"s",h[Lt]=o+"s",h[Tt]=i||"linear")}return a=function(t){if(void 0!==t){if(t.target!==t.currentTarget)return;k(t.target).off(u,a)}else k(this).off(u,a);f=!0,k(this).css(Rt),n&&n.call(this)},0<e&&(this.on(u,a),setTimeout(function(){f||a.call(c)},1e3*(e+o)+25)),this.size()&&this.get(0).clientLeft,this.css(h),e<=0&&setTimeout(function(){c.each(function(){a.call(this)})},0),this}}),Nt=function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=defaultDisplay(this.nodeName))})},Pt=function(){return this.css("display","none")};function Ft(t,e,i,n,o){"function"!=typeof e||o||(o=e,e=void 0);var s={opacity:i};return n&&(s.scale=n,t.css(k.fx.cssPrefix+"transform-origin","0 0")),t.animate(s,e,null,o)}function Bt(t,e,i,n){return Ft(t,e,0,i,function(){Pt.call(k(this)),n&&n.call(this)})}var _t=Object.freeze({show:function(t,e){return Nt.call(this),void 0===t?t=0:this.css("opacity",0),Ft(this,t,1,"1,1",e)},hide:function(t,e){return void 0===t?Pt.call(this):Bt(this,t,"0,0",e)},toggle:function(e,i){return void 0===e||"boolean"==typeof e?function(e){return this.each(function(){var t=$(this);(void 0===e?"none"==t.css("display"):e)?t.show():t.hide()})}.call(this,e):this.each(function(){var t=k(this);t["none"==t.css("display")?"show":"hide"](e,i)})},fadeTo:function(t,e,i){return Ft(this,t,e,null,i)},fadeIn:function(t,e){var i=this.css("opacity");return 0<i?this.css("opacity",0):i=1,Nt.call(this).fadeTo(t,i,e)},fadeOut:function(t,e){return Bt(this,t,null,e)},fadeToggle:function(e,i){return this.each(function(){var t=k(this);t[0==t.css("opacity")||"none"==t.css("display")?"fadeIn":"fadeOut"](e,i)})}});k.extend(k,B),k.extend(k.fn,_,W,Y,X,q,Z,K,U,J,et,At,jt,_t);var Wt={draggable:!0,resizable:!0,movable:!0,keyboard:!0,title:!0,modalWidth:320,modalHeight:320,fixedContent:!0,fixedModalSize:!1,initMaximized:!1,gapThreshold:.02,ratioThreshold:.1,minRatio:.05,maxRatio:16,headToolbar:["maximize","close"],footToolbar:["zoomIn","zoomOut","prev","fullscreen","next","actualSize","rotateRight"],icons:{minimize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n               <path fill="currentColor" d="M20,14H4V10H20"></path>\n               </svg>',maximize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n               <path fill="currentColor" d="M4,4H20V20H4V4M6,8V18H18V8H6Z"></path>\n               </svg>',close:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n            <path fill="currentColor" d="M13.46,12L19,17.54V19H17.54L12,13.46\n            L6.46,19H5V17.54L10.54,12L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46\n            L13.46,12Z"></path>\n            </svg>',zoomIn:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n             <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71\n             L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,\n             6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,\n             13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,\n             7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z"></path>\n            </svg>',zoomOut:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n              <path fill="currentColor" d="M15.5,14H14.71L14.43,13.73C15.41,\n              12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,\n              6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5\n              L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,\n              5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z"></path>\n              </svg>',prev:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n           <path fill="currentColor" d="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"></path>\n           </svg>',next:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n           <path fill="currentColor" d="M16,18H18V6H16M6,18L14.5,12L6,6V18Z"></path>\n           </svg>',fullscreen:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                 <path fill="currentColor" d="M8.5,12.5L11,15.5L14.5,11L19,17H5\n                 M23,18V6A2,2 0 0,0 21,4H3A2,2 0 0,0 1,6V18A2,2 0 0,0 3,20H21A2,\n                 2 0 0,0 23,18Z"></path>\n                 </svg>',actualSize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                 <path fill="currentColor" d="M9.5,13.09L10.91,14.5L6.41,19H10V21\n                 H3V14H5V17.59L9.5,13.09M10.91,9.5L9.5,10.91L5,6.41V10H3V3H10V5\n                 H6.41L10.91,9.5M14.5,13.09L19,17.59V14H21V21H14V19H17.59L13.09,\n                 14.5L14.5,13.09M13.09,9.5L17.59,5H14V3H21V10H19V6.41L14.5,10.91\n                 L13.09,9.5Z"></path>\n                </svg>',rotateLeft:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                 <path fill="currentColor" d="M13,4.07V1L8.45,5.55L13,10V6.09\n                 C15.84,6.57 18,9.03 18,12C18,14.97 15.84,17.43 13,17.91V19.93\n                 C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07M7.1,18.32\n                 C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,\n                 16.87L7.1,18.32M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89\n                 L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13M7.11,8.53L5.7,7.11C4.8,\n                 8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z"></path>\n                 </svg>',rotateRight:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                  <path fill="currentColor" d="M16.89,15.5L18.31,16.89C19.21,\n                  15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,\n                  15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,\n                  16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,\n                  8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,\n                  5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93\n                  V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,\n                  5.55Z"></path>\n                  </svg>'},i18n:{minimize:"minimize",maximize:"maximize",close:"close",zoomIn:"zoom-in(+)",zoomOut:"zoom-out(-)",prev:"prev(←)",next:"next(→)",fullscreen:"fullscreen",actualSize:"actual-size(Ctrl+Alt+0)",rotateLeft:"rotate-left(Ctrl+,)",rotateRight:"rotate-right(Ctrl+.)"},multiInstances:!0,initAnimation:!0,fixedModalPos:!1,zIndex:1090,dragHandle:!1,callbacks:{beforeOpen:(window.D=k).noop,opened:k.noop,beforeClose:k.noop,closed:k.noop,beforeChange:k.noop,changed:k.noop},index:0,progressiveLoading:!0};function Yt(t){var e=t.match(/\d+/g);return parseFloat(e[0])}function Xt(t,e,i,n){var o=n?t.h:t.w,s=n?t.w:t.h;(s>e.h||o>e.w)&&i.addClass("is-grab"),s<=e.h&&o<=e.w&&i.removeClass("is-grab")}function qt(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}var Zt=k(window),Kt=k(document),Ut="click",Gt="keydown",Jt="wheel mousewheel DOMMouseScroll",Qt=qt()?"touchstart":"mousedown",te=qt()?"touchmove":"mousemove",ee=qt()?"touchend":"mouseup",ie="photoviewer",ne="."+ie,oe="."+ie,se={isMoving:!1,isResizing:!1,zIndex:Wt.zIndex},re={draggable:function(s,t,e){var r=this,a=!1,h=0,l=0,c=0,u=0,i=function(t){if((t=t||window.event).preventDefault(),a&&!se.isMoving&&!se.isResizing&&!r.isMaximized){var e="touchmove"===t.type?t.targetTouches[0].pageX:t.clientX,i="touchmove"===t.type?t.targetTouches[0].pageY:t.clientY,n=e-h,o=i-l;k(s).css({left:n+c+"px",top:o+u+"px"})}},n=function t(){Kt.off(te+oe,i).off(ee+oe,t),a=!1};k(t).on(Qt+oe,function(t){if(t=t||window.event,r.options.multiInstances&&s.css("z-index",++se.zIndex),k(t.target).closest(e).length)return!0;a=!0,h="touchstart"===t.type?t.targetTouches[0].pageX:t.clientX,l="touchstart"===t.type?t.targetTouches[0].pageY:t.clientY,c=k(s).offset().left,u=k(s).offset().top,Kt.on(te+oe,i).on(ee+oe,n)})}},ae="html,body,."+ie+"-modal,."+ie+"-stage,."+ie+"-button,."+ie+"-resizable-handle",he={movable:function(s,a){var h=this,l=!1,c=0,u=0,f=0,d=0,p=0,g=0,m=0,r=function(t){if((t=t||window.event).preventDefault(),l){var e="touchmove"===t.type?t.targetTouches[0].pageX:t.clientX,i="touchmove"===t.type?t.targetTouches[0].pageY:t.clientY,n=e-c,o=i-u,s=n+f,r=o+d;0<g?m<o+d?r=m:o+d<-g+m&&(r=-g+m):r=d,0<p?-m<n+f?s=-m:n+f<-p-m&&(s=-p-m):s=f,k(a).css({left:s+"px",top:r+"px"}),k.extend(h.imageData,{left:s,top:r})}},v=function t(){Kt.off(te+oe,r).off(ee+oe,t),l=!1,se.isMoving=!1,k(ae).removeClass("is-grabbing")};k(s).on(Qt+oe,function(t){(t=t||window.event).preventDefault();var e=k(a).width(),i=k(a).height(),n=k(s).width(),o=k(s).height();c="touchstart"===t.type?t.targetTouches[0].pageX:t.clientX,u="touchstart"===t.type?t.targetTouches[0].pageY:t.clientY,m=h.isRotated?(e-i)/2:0,p=h.isRotated?i-n:e-n,g=h.isRotated?e-o:i-o,l=0<p||0<g,se.isMoving=0<p||0<g,f=k(a).position().left-m,d=k(a).position().top+m,s.hasClass("is-grab")&&k(ae).addClass("is-grabbing"),Kt.on(te+oe,r).on(ee+oe,v)})}},le="html,body,."+ie+"-modal,."+ie+"-stage,."+ie+"-button",ce={resizable:function($,o,M,C,T){var L=this,t=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-e"></div>'),e=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-w"></div>'),i=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-s"></div>'),n=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-n"></div>'),s=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-se"></div>'),r=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-sw"></div>'),a=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-ne"></div>'),h=k('<div class="'+ie+"-resizable-handle "+ie+'-resizable-handle-nw"></div>'),l={e:t,s:i,se:s,n:n,w:e,nw:h,ne:a,sw:r};k($).append(t,e,i,n,s,r,a,h);var H=!1,E=0,D=0,O={w:0,h:0,l:0,t:0},A={w:0,h:0,l:0,t:0},c={w:0,h:0,l:0,t:0},V=0,I=0,S=0,R="",u=function(t){if((t=t||window.event).preventDefault(),H&&!L.isMaximized){var e="touchmove"===t.type?t.targetTouches[0].pageX:t.clientX,i="touchmove"===t.type?t.targetTouches[0].pageY:t.clientY,n=e-E,o=i-D,s=(w=R,b=o,y=-(x=n)+O.w>C?x+O.l:O.l+O.w-C,z=-b+O.h>T?b+O.t:O.t+O.h-T,{e:{width:Math.max(x+O.w,C)+"px"},s:{height:Math.max(b+O.h,T)+"px"},se:{width:Math.max(x+O.w,C)+"px",height:Math.max(b+O.h,T)+"px"},w:{width:Math.max(-x+O.w,C)+"px",left:y+"px"},n:{height:Math.max(-b+O.h,T)+"px",top:z+"px"},nw:{width:Math.max(-x+O.w,C)+"px",height:Math.max(-b+O.h,T)+"px",top:z+"px",left:y+"px"},ne:{width:Math.max(x+O.w,C)+"px",height:Math.max(-b+O.h,T)+"px",top:z+"px"},sw:{width:Math.max(-x+O.w,C)+"px",height:Math.max(b+O.h,T)+"px",left:y+"px"}}[w]);k($).css(s);var r=(a=R,l=o,c=(h=n)+O.w>C?A.w-I+h-V:C-(O.w-A.w)-I-V,u=l+O.h>T?A.h-S+l+V:T-(O.h-A.h)-S+V,f=-h+O.w>C?A.w-I-h-V:C-(O.w-A.w)-I-V,d=-l+O.h>T?A.h-S-l+V:T-(O.h-A.h)-S+V,p=(0<c?k(M).position().left:k(M).position().left<0?k(M).position().left:0)-V,g=(0<u?k(M).position().top:k(M).position().top<0?k(M).position().top:0)+V,m=(0<f?k(M).position().left:k(M).position().left<0?k(M).position().left:0)-V,v=(0<d?k(M).position().top:k(M).position().top<0?k(M).position().top:0)+V,{e:{left:-V<=c?(c-V)/2+"px":c<p?p+"px":c+"px"},s:{top:V<=u?(u+V)/2+"px":u<g?g+"px":u+"px"},se:{top:V<=u?(u+V)/2+"px":u<g?g+"px":u+"px",left:-V<=c?(c-V)/2+"px":c<p?p+"px":c+"px"},w:{left:-V<=f?(f-V)/2+"px":f<m?m+"px":f+"px"},n:{top:V<=d?(d+V)/2+"px":d<v?v+"px":d+"px"},nw:{top:V<=d?(d+V)/2+"px":d<v?v+"px":d+"px",left:-V<=f?(f-V)/2+"px":f<m?m+"px":f+"px"},ne:{top:V<=d?(d+V)/2+"px":d<v?v+"px":d+"px",left:-V<=c?(c-V)/2+"px":c<p?p+"px":c+"px"},sw:{top:V<=u?(u+V)/2+"px":u<g?g+"px":u+"px",left:-V<=f?(f-V)/2+"px":f<m?m+"px":f+"px"}}[a]);k(M).css(r),L.isDoResize=!0}var a,h,l,c,u,f,d,p,g,m,v,w,x,b,y,z},f=function t(){Kt.off(te+oe,u).off(ee+oe,t),se.isResizing&&Xt({w:I,h:S},{w:k(o).width(),h:k(o).height()},o),H=!1,se.isResizing=!1,k(le).css("cursor","");var e=L.getImageScaleToStage(k(o).width(),k(o).height());k.extend(L.imageData,{initWidth:L.img.width*e,initHeight:L.img.height*e,initLeft:(k(o).width()-L.img.width*e)/2,initTop:(k(o).height()-L.img.height*e)/2})};k.each(l,function(n,t){t.on(Qt+oe,function(t){var e,i;e=n,(i=(i=t)||window.event).preventDefault(),H=!0,se.isResizing=!0,E="touchstart"===i.type?i.targetTouches[0].pageX:i.clientX,D="touchstart"===i.type?i.targetTouches[0].pageY:i.clientY,O={w:k($).width(),h:k($).height(),l:k($).offset().left,t:k($).offset().top},A={w:k(o).width(),h:k(o).height(),l:k(o).offset().left,t:k(o).offset().top},c={w:k(M).width(),h:k(M).height(),l:k(M).position().left,t:k(M).position().top},V=L.isRotated?(c.w-c.h)/2:0,I=L.isRotated?c.h:c.w,S=L.isRotated?c.w:c.h,R=e,k(le).css("cursor",e+"-resize"),Kt.on(te+oe,u).on(ee+oe,f)})})}},ue=function(){function t(t,e,i){this.options=k.extend(!0,{},Wt,e),e&&k.isArray(e.footToolbar)&&(this.options.footToolbar=e.footToolbar),e&&k.isArray(e.headToolbar)&&(this.options.headToolbar=e.headToolbar),this.$el=k(i),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isDoResize=!1,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(t,this.options,i)}var e=t.prototype;return e.init=function(t,e,i){this.groupData=t,this.groupIndex=e.index;var n=t[this.groupIndex].src;this.open(),this.loadImg(n),e.draggable&&this.draggable(this.$photoviewer,this.dragHandle,ne+"-button"),e.movable&&this.movable(this.$stage,this.$image),e.resizable&&this.resizable(this.$photoviewer,this.$stage,this.$image,e.modalWidth,e.modalHeight)},e._creatBtns=function(t,i){var n="";return k.each(t,function(t,e){n+=i[e]}),n},e._creatTitle=function(){return this.options.title?'<div class="'+ie+'-title"></div>':""},e._creatDOM=function(){var t={minimize:'<button class="'+ie+"-button "+ie+'-button-minimize"\n                  title="'+this.options.i18n.minimize+'">\n                    '+this.options.icons.minimize+"\n                  </button>",maximize:'<button class="'+ie+"-button "+ie+'-button-maximize"\n                  title="'+this.options.i18n.maximize+'">\n                    '+this.options.icons.maximize+"\n                  </button>",close:'<button class="'+ie+"-button "+ie+'-button-close"\n              title="'+this.options.i18n.close+'">\n                '+this.options.icons.close+"\n              </button>",zoomIn:'<button class="'+ie+"-button "+ie+'-button-zoom-in"\n                title="'+this.options.i18n.zoomIn+'">\n                  '+this.options.icons.zoomIn+"\n                </button>",zoomOut:'<button class="'+ie+"-button "+ie+'-button-zoom-out"\n                title="'+this.options.i18n.zoomOut+'">\n                  '+this.options.icons.zoomOut+"\n                </button>",prev:'<button class="'+ie+"-button "+ie+'-button-prev"\n              title="'+this.options.i18n.prev+'">\n                '+this.options.icons.prev+"\n              </button>",next:'<button class="'+ie+"-button "+ie+'-button-next"\n              title="'+this.options.i18n.next+'">\n                '+this.options.icons.next+"\n              </button>",fullscreen:'<button class="'+ie+"-button "+ie+'-button-fullscreen"\n                    title="'+this.options.i18n.fullscreen+'">\n                    '+this.options.icons.fullscreen+"\n                  </button>",actualSize:'<button class="'+ie+"-button "+ie+'-button-actual-size"\n                    title="'+this.options.i18n.actualSize+'">\n                      '+this.options.icons.actualSize+"\n                    </button>",rotateLeft:'<button class="'+ie+"-button "+ie+'-button-rotate-left"\n                    title="'+this.options.i18n.rotateLeft+'">\n                      '+this.options.icons.rotateLeft+"\n                    </button>",rotateRight:'<button class="'+ie+"-button "+ie+'-button-rotate-right"\n                      title="'+this.options.i18n.rotateRight+'">\n                      '+this.options.icons.rotateRight+"\n                    </button>"};return'<div class="'+ie+'-modal">\n        <div class="'+ie+'-inner">\n          <div class="'+ie+'-header">\n            <div class="'+ie+"-toolbar "+ie+'-toolbar-head">\n              '+this._creatBtns(this.options.headToolbar,t)+"\n            </div>\n            "+this._creatTitle()+'\n          </div>\n          <div class="'+ie+'-stage">\n            <img class="'+ie+'-image" src="" alt="" />\n          </div>\n          <div class="'+ie+'-footer">\n            <div class="'+ie+"-toolbar "+ie+'-toolbar-foot">\n              '+this._creatBtns(this.options.footToolbar,t)+"\n            </div>\n          </div>\n        </div>\n      </div>"},e.build=function(){var t=this._creatDOM(),e=k(t);this.$photoviewer=e,this.$header=e.find(ne+"-header"),this.$headToolbar=e.find(ne+"-toolbar-head"),this.$footer=e.find(ne+"-footer"),this.$footToolbar=e.find(ne+"-toolbar-foot"),this.$stage=e.find(ne+"-stage"),this.$title=e.find(ne+"-title"),this.$image=e.find(ne+"-image"),this.$close=e.find(ne+"-button-close"),this.$maximize=e.find(ne+"-button-maximize"),this.$minimize=e.find(ne+"-button-minimize"),this.$zoomIn=e.find(ne+"-button-zoom-in"),this.$zoomOut=e.find(ne+"-button-zoom-out"),this.$actualSize=e.find(ne+"-button-actual-size"),this.$fullscreen=e.find(ne+"-button-fullscreen"),this.$rotateLeft=e.find(ne+"-button-rotate-left"),this.$rotateRight=e.find(ne+"-button-rotate-right"),this.$prev=e.find(ne+"-button-prev"),this.$next=e.find(ne+"-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$photoviewer.css("z-index",se.zIndex),this.options.dragHandle&&this.options.dragHandle!==ne+"-modal"?this.dragHandle=this.$photoviewer.find(this.options.dragHandle):this.dragHandle=this.$photoviewer},e.open=function(){if(this.options.multiInstances||k(ne+"-modal").eq(0).remove(),!k(ne+"-modal").length&&this.options.fixedContent&&(k("html").css({overflow:"hidden"}),document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight))){var t=function(){var t=document.createElement("div");t.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e}();t&&k("html").css({"padding-right":t})}this.build(),this._triggerHook("beforeOpen",this.$el),k("body").append(this.$photoviewer),this.addEvents(),this.setModalPos(this.$photoviewer),this._triggerHook("opened",this.$el)},e.close=function(){this._triggerHook("beforeClose",this.$el),this.$photoviewer.remove(),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0;var t=!k(ne+"-modal").length;t&&this.options.fixedContent&&k("html").css({overflow:"","padding-right":""}),t&&this.options.multiInstances&&(se.zIndex=this.options.zIndex),k(ne+"-modal").length||(Kt.off(Gt+oe),Zt.off("resize"+oe)),this._triggerHook("closed",this.$el)},e.setModalPos=function(t){var e=Zt.width(),i=Zt.height(),n=document.documentElement.scrollLeft,o=document.documentElement.scrollTop,s=this.options.modalWidth,r=this.options.modalHeight;this.options.initMaximized?(t.addClass(ie+"-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:s,height:r,left:(e-s)/2+n+"px",top:(i-r)/2+o+"px"})},e.setModalSize=function(t){var e=this,i=Zt.width(),n=Zt.height(),o=document.documentElement.scrollLeft,s=document.documentElement.scrollTop,r={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},a=t.width+Yt(r.left)+Yt(r.right)+Yt(r.borderLeft)+Yt(r.borderRight),h=t.height+Yt(r.top)+Yt(r.bottom)+Yt(r.borderTop)+Yt(r.borderBottom),l=(0<this.options.gapThreshold?this.options.gapThreshold:0)+1,c=Math.min(i/(a*l),n/(h*l),1),u=Math.max(a*c,this.options.modalWidth),f=Math.max(h*c,this.options.modalHeight),d={width:(u=this.options.fixedModalSize?this.options.modalWidth:Math.round(u))+"px",height:(f=this.options.fixedModalSize?this.options.modalHeight:Math.round(f))+"px",left:(i-u)/2+o+"px",top:(n-f)/2+s+"px"};this.options.initAnimation?this.$photoviewer.animate(d,function(){e.setImageSize(t)},300,"ease-in-out"):(this.$photoviewer.css(d),this.setImageSize(t)),this.isOpened=!0},e.getImageScaleToStage=function(t,e){return this.isRotated?Math.min(t/this.img.height,e/this.img.width,1):Math.min(t/this.img.width,e/this.img.height,1)},e.setImageSize=function(t){var e={w:this.$stage.width(),h:this.$stage.height()},i=this.getImageScaleToStage(e.w,e.h);this.$image.css({width:Math.ceil(t.width*i)+"px",height:Math.ceil(t.height*i)+"px",left:(e.w-Math.ceil(t.width*i))/2+"px",top:(e.h-Math.ceil(t.height*i))/2+"px"}),k.extend(this.imageData,{initWidth:t.width*i,initHeight:t.height*i,initLeft:(e.w-t.width*i)/2,initTop:(e.h-t.height*i)/2,width:t.width*i,height:t.height*i,left:(e.w-t.width*i)/2,top:(e.h-t.height*i)/2}),Xt({w:this.$image.width(),h:this.$image.height()},{w:this.$stage.width(),h:this.$stage.height()},this.$stage,this.isRotated),this.$stage.removeClass("stage-ready"),this.$image.removeClass("image-ready"),this.$photoviewer.find(ne+"-loader").remove(),this.options.initAnimation&&!this.options.progressiveLoading&&"none"===this.$image.css("display")&&this.$image.fadeIn()},e.loadImg=function(t,e,i){var n,o,s,r,a=this;this.$photoviewer.append('<div class="photoviewer-loader"></div>'),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$image.removeAttr("style").attr("src",""),this.isRotated=!1,this.rotateAngle=0,this.options.initAnimation&&!this.options.progressiveLoading&&this.$image.hide(),this.$image.attr("src",t),n=t,o=function(t){a.img=t,a.imageData={originalWidth:t.width,originalHeight:t.height},a.isMaximized||a.isOpened&&a.options.fixedModalPos?a.setImageSize(t):a.setModalSize(t),e&&e.call()},s=function(){a.$photoviewer.find(ne+"-loader").remove(),i&&i.call()},(r=new Image).onload=function(){o(r)},r.onerror=function(){s(r)},r.src=n,this.options.title&&this.setImgTitle(t)},e.setImgTitle=function(t){var e=this.groupData[this.groupIndex].title?this.groupData[this.groupIndex].title:t.replace(/^.*?\/*([^/?]*)\.[a-z]+(\?.+|$)/gi,"$1");this.$title.html(e)},e.jump=function(t){this._triggerHook("beforeChange",this.groupIndex),this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)},e.jumpTo=function(t){var e=this;0<=(t%=this.groupData.length)?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImg(this.groupData[t].src,function(){e._triggerHook("changed",t)},function(){e._triggerHook("changed",t)})},e.wheel=function(t){t.preventDefault();var e=1;t.deltaY?e=0<t.deltaY?1:-1:t.wheelDelta?e=-t.wheelDelta/120:t.detail&&(e=0<t.detail?1:-1);var i=-e*this.options.ratioThreshold,n={x:t.clientX-this.$stage.offset().left+document.documentElement.scrollLeft,y:t.clientY-this.$stage.offset().top+document.documentElement.scrollTop};this.zoom(i,n,t)},e.zoom=function(t,e,i){t=t<0?1/(1-t):1+t,(t=this.$image.width()/this.imageData.originalWidth*t)>this.options.maxRatio||t<this.options.minRatio||this.zoomTo(t,e,i)},e.zoomTo=function(t,e,i){var n=this.$image,o=this.$stage,s=this.imageData.width,r=this.imageData.height,a=this.imageData.left,h=this.imageData.top,l={w:o.width(),h:o.height(),x:o.offset().left,y:o.offset().top},c=this.imageData.originalWidth*t,u=this.imageData.originalHeight*t,f=e.x-(e.x-a)/s*c,d=e.y-(e.y-h)/r*u,p=this.isRotated?(c-u)/2:0,g=this.isRotated?u:c,m=this.isRotated?c:u,v=l.w-c,w=l.h-u;
// The conditions with image rotate 90 degree drive me crazy alomst!
d=m<=l.h?(l.h-u)/2:p<d?p:w-p<d?d:w-p,f=g<=l.w?(l.w-c)/2:-p<f?-p:v+p<f?f:v+p,Math.abs(this.imageData.initWidth-c)<.05*this.imageData.initWidth?this.setImageSize(this.img):(n.css({width:Math.round(c)+"px",height:Math.round(u)+"px",left:Math.round(f)+"px",top:Math.round(d)+"px"}),Xt({w:Math.round(g),h:Math.round(m)},{w:l.w,h:l.h},this.$stage)),k.extend(this.imageData,{width:c,height:u,left:f,top:d})},e.rotate=function(t){this.rotateAngle=this.rotateAngle+t,this.rotateAngle/90%2==0?this.isRotated=!1:this.isRotated=!0,this.rotateTo(this.rotateAngle)},e.rotateTo=function(t){this.$image.css({transform:"rotate("+t+"deg)"}),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}),this.$stage.removeClass("is-grab")},e.resize=function(){var i,n,o,t=this;return i=function(){t.isOpened&&(t.isMaximized?t.setImageSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}):t.setModalSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}))},n=500,o=null,function(){var t=this,e=arguments;clearTimeout(o),o=setTimeout(function(){i.apply(t,e)},n)}},e.maximize=function(){this.isMaximized?(this.$photoviewer.removeClass(ie+"-maximize"),this.$photoviewer.css({width:this.modalData.width?this.modalData.width:this.options.modalWidth,height:this.modalData.height?this.modalData.height:this.options.modalHeight,left:this.modalData.left?this.modalData.left:(Zt.width()-this.options.modalWidth)/2+document.documentElement.scrollLeft,top:this.modalData.top?this.modalData.top:(Zt.height()-this.options.modalHeight)/2+document.documentElement.scrollTop}),this.isMaximized=!1):(this.modalData={width:this.$photoviewer.width(),height:this.$photoviewer.height(),left:this.$photoviewer.offset().left,top:this.$photoviewer.offset().top},this.$photoviewer.addClass(ie+"-maximize"),this.$photoviewer.css({width:"100%",height:"100%",left:0,top:0}),this.isMaximized=!0),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight})},e.fullscreen=function(){var t;(t=this.$photoviewer[0]).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},e.keydown=function(t){if(!this.options.keyboard)return!1;var e=t.keyCode||t.which||t.charCode,i=t.ctrlKey||t.metaKey,n=t.altKey||t.metaKey;switch(e){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 187:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 189:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 61:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 173:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 48:i&&n&&this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 188:i&&this.rotate(-90);break;case 190:i&&this.rotate(90)}},e.addEvents=function(){var e=this;this.$close.off(Ut+oe).on(Ut+oe,function(t){e.close()}),this.$stage.off(Jt+oe).on(Jt+oe,function(t){e.wheel(t)}),this.$zoomIn.off(Ut+oe).on(Ut+oe,function(t){e.zoom(3*e.options.ratioThreshold,{x:e.$stage.width()/2,y:e.$stage.height()/2},t)}),this.$zoomOut.off(Ut+oe).on(Ut+oe,function(t){e.zoom(3*-e.options.ratioThreshold,{x:e.$stage.width()/2,y:e.$stage.height()/2},t)}),this.$actualSize.off(Ut+oe).on(Ut+oe,function(t){e.zoomTo(1,{x:e.$stage.width()/2,y:e.$stage.height()/2},t)}),this.$prev.off(Ut+oe).on(Ut+oe,function(){e.jump(-1)}),this.$fullscreen.off(Ut+oe).on(Ut+oe,function(){e.fullscreen()}),this.$next.off(Ut+oe).on(Ut+oe,function(){e.jump(1)}),this.$rotateLeft.off(Ut+oe).on(Ut+oe,function(){e.rotate(-90)}),this.$rotateRight.off(Ut+oe).on(Ut+oe,function(){e.rotate(90)}),this.$maximize.off(Ut+oe).on(Ut+oe,function(){e.maximize()}),Kt.off(Gt+oe).on(Gt+oe,function(t){e.keydown(t)}),Zt.on("resize"+oe,this.resize())},e._triggerHook=function(t,e){this.options.callbacks[t]&&this.options.callbacks[t].apply(this,k.isArray(e)?e:[e])},t}();return k.extend(ue.prototype,re,he,ce),window.PhotoViewer=ue});