/*!
 *  ____  _   _  ___  _____  ___  _   _ _____ ____ _    _ ____ ____
 * |  _ \| | | |/ _ \|_   _|/ _ \| | | |_   _|  __| |  | |  __|  _ \
 * | |_| | |_| | | | | | | | | | | | | | | | | |__| |  | | |__| |_| |
 * |  __/|  _  | | | | | | | | | | |_| | | | |  __| |/\| |  __|    /
 * | |   | | | | |_| | | | | |_| |\   / _| |_| |__|  /\  | |__| |\ \
 * |_|   |_| |_|\___/  |_|  \___/  \_/ |_____|____|_/  \_|____|_| \_\
 *
 * photoviewer - v2.2.1
 * A JS plugin to view images just like in Windows
 * https://github.com/nzbin/photoviewer#readme
 *
 * Copyright (c) 2018 nzbin
 * Released under MIT License
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],i):t.photoviewer=i(t.jQuery)}(this,function(x){"use strict";x=x&&x.hasOwnProperty("default")?x.default:x;var n={draggable:!0,resizable:!0,movable:!0,keyboard:!0,title:!0,modalWidth:320,modalHeight:320,fixedContent:!0,fixedModalSize:!1,initMaximized:!1,gapThreshold:.02,ratioThreshold:.1,minRatio:.05,maxRatio:16,headToolbar:["maximize","close"],footToolbar:["zoomIn","zoomOut","prev","fullscreen","next","actualSize","rotateRight"],icons:{minimize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n               <path fill="currentColor" d="M20,14H4V10H20"></path>\n               </svg>',maximize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n               <path fill="currentColor" d="M4,4H20V20H4V4M6,8V18H18V8H6Z"></path>\n               </svg>',close:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n            <path fill="currentColor" d="M13.46,12L19,17.54V19H17.54L12,13.46\n            L6.46,19H5V17.54L10.54,12L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46\n            L13.46,12Z"></path>\n            </svg>',zoomIn:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n             <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71\n             L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,\n             6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,\n             13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,\n             7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z"></path>\n            </svg>',zoomOut:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n              <path fill="currentColor" d="M15.5,14H14.71L14.43,13.73C15.41,\n              12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,\n              6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5\n              L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,\n              5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z"></path>\n              </svg>',prev:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n           <path fill="currentColor" d="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"></path>\n           </svg>',next:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n           <path fill="currentColor" d="M16,18H18V6H16M6,18L14.5,12L6,6V18Z"></path>\n           </svg>',fullscreen:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                 <path fill="currentColor" d="M8.5,12.5L11,15.5L14.5,11L19,17H5\n                 M23,18V6A2,2 0 0,0 21,4H3A2,2 0 0,0 1,6V18A2,2 0 0,0 3,20H21A2,\n                 2 0 0,0 23,18Z"></path>\n                 </svg>',actualSize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                 <path fill="currentColor" d="M9.5,13.09L10.91,14.5L6.41,19H10V21\n                 H3V14H5V17.59L9.5,13.09M10.91,9.5L9.5,10.91L5,6.41V10H3V3H10V5\n                 H6.41L10.91,9.5M14.5,13.09L19,17.59V14H21V21H14V19H17.59L13.09,\n                 14.5L14.5,13.09M13.09,9.5L17.59,5H14V3H21V10H19V6.41L14.5,10.91\n                 L13.09,9.5Z"></path>\n                </svg>',rotateLeft:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                 <path fill="currentColor" d="M13,4.07V1L8.45,5.55L13,10V6.09\n                 C15.84,6.57 18,9.03 18,12C18,14.97 15.84,17.43 13,17.91V19.93\n                 C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07M7.1,18.32\n                 C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,\n                 16.87L7.1,18.32M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89\n                 L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13M7.11,8.53L5.7,7.11C4.8,\n                 8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z"></path>\n                 </svg>',rotateRight:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n                  <path fill="currentColor" d="M16.89,15.5L18.31,16.89C19.21,\n                  15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,\n                  15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,\n                  16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,\n                  8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,\n                  5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93\n                  V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,\n                  5.55Z"></path>\n                  </svg>'},i18n:{minimize:"minimize",maximize:"maximize",close:"close",zoomIn:"zoom-in(+)",zoomOut:"zoom-out(-)",prev:"prev(←)",next:"next(→)",fullscreen:"fullscreen",actualSize:"actual-size(Ctrl+Alt+0)",rotateLeft:"rotate-left(Ctrl+,)",rotateRight:"rotate-right(Ctrl+.)"},multiInstances:!0,initAnimation:!0,fixedModalPos:!1,zIndex:1090,dragHandle:!1,callbacks:{beforeOpen:$.noop,opened:$.noop,beforeClose:$.noop,closed:$.noop,beforeChange:$.noop,changed:$.noop},index:0,progressiveLoading:!0};function u(t){var i=t.match(/\d+/g);return parseFloat(i[0])}function b(t,i,e,o){var s=o?t.h:t.w,n=o?t.w:t.h;(n>i.h||s>i.w)&&e.addClass("is-grab"),n<=i.h&&s<=i.w&&e.removeClass("is-grab")}function t(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}var f=$(window),w=$(document),e="click",o="resize",s="keydown",a="wheel mousewheel DOMMouseScroll",z=t()?"touchstart":"mousedown",M=t()?"touchmove":"mousemove",W=t()?"touchend":"mouseup",c="photoviewer",l="."+c,B="."+c,Y={isMoving:!1,isResizing:!1,zIndex:n.zIndex},i={draggable:function(n,t,i){var a=this,h=!1,l=0,r=0,d=0,g=0,e=function(t){if((t=t||window.event).preventDefault(),h&&!Y.isMoving&&!Y.isResizing&&!a.isMaximized){var i="touchmove"===t.type?t.originalEvent.targetTouches[0].pageX:t.clientX,e="touchmove"===t.type?t.originalEvent.targetTouches[0].pageY:t.clientY,o=i-l,s=e-r;$(n).css({left:o+d+"px",top:s+g+"px"})}},o=function t(){w.off(M+B,e).off(W+B,t),h=!1};$(t).on(z+B,function(t){if(t=t||window.event,a.options.multiInstances&&n.css("z-index",++Y.zIndex),$(t.target).closest(i).length)return!0;h=!0,l="touchstart"===t.type?t.originalEvent.targetTouches[0].pageX:t.clientX,r="touchstart"===t.type?t.originalEvent.targetTouches[0].pageY:t.clientY,d=$(n).offset().left,g=$(n).offset().top,w.on(M+B,e).on(W+B,o)})}},H="html,body,."+c+"-modal,."+c+"-stage,."+c+"-button,."+c+"-resizable-handle",h={movable:function(n,h){var l=this,r=!1,d=0,g=0,p=0,c=0,u=0,f=0,m=0,a=function(t){if((t=t||window.event).preventDefault(),r){var i="touchmove"===t.type?t.originalEvent.targetTouches[0].pageX:t.clientX,e="touchmove"===t.type?t.originalEvent.targetTouches[0].pageY:t.clientY,o=i-d,s=e-g,n=o+p,a=s+c;0<f?m<s+c?a=m:s+c<-f+m&&(a=-f+m):a=c,0<u?-m<o+p?n=-m:o+p<-u-m&&(n=-u-m):n=p,$(h).css({left:n+"px",top:a+"px"}),$.extend(l.imageData,{left:n,top:a})}},v=function t(){w.off(M+B,a).off(W+B,t),r=!1,Y.isMoving=!1,$(H).removeClass("is-grabbing")};$(n).on(z+B,function(t){(t=t||window.event).preventDefault();var i=$(h).width(),e=$(h).height(),o=$(n).width(),s=$(n).height();d="touchstart"===t.type?t.originalEvent.targetTouches[0].pageX:t.clientX,g="touchstart"===t.type?t.originalEvent.targetTouches[0].pageY:t.clientY,m=l.isRotated?(i-e)/2:0,u=l.isRotated?e-o:i-o,f=l.isRotated?i-s:e-s,r=0<u||0<f,Y.isMoving=0<u||0<f,p=$(h).position().left-m,c=$(h).position().top+m,n.hasClass("is-grab")&&$(H).addClass("is-grabbing"),w.on(M+B,a).on(W+B,v)})}},m="html,body,."+c+"-modal,."+c+"-stage,."+c+"-button",r={resizable:function(H,s,C,L,y){var T=this,t=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-e"></div>'),i=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-w"></div>'),e=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-s"></div>'),o=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-n"></div>'),n=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-se"></div>'),a=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-sw"></div>'),h=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-ne"></div>'),l=$('<div class="'+c+"-resizable-handle "+c+'-resizable-handle-nw"></div>'),r={e:t,s:e,se:n,n:o,w:i,nw:l,ne:h,sw:a};$(H).append(t,i,e,o,n,a,h,l);var D=!1,I=0,V=0,R={w:0,h:0,l:0,t:0},S={w:0,h:0,l:0,t:0},d={w:0,h:0,l:0,t:0},k=0,A=0,E=0,O="",g=function(t){if((t=t||window.event).preventDefault(),D&&!T.isMaximized){var i="touchmove"===t.type?t.originalEvent.targetTouches[0].pageX:t.clientX,e="touchmove"===t.type?t.originalEvent.targetTouches[0].pageY:t.clientY,o=i-I,s=e-V,n=(w=O,b=s,z=-(x=o)+R.w>L?x+R.l:R.l+R.w-L,M=-b+R.h>y?b+R.t:R.t+R.h-y,{e:{width:Math.max(x+R.w,L)+"px"},s:{height:Math.max(b+R.h,y)+"px"},se:{width:Math.max(x+R.w,L)+"px",height:Math.max(b+R.h,y)+"px"},w:{width:Math.max(-x+R.w,L)+"px",left:z+"px"},n:{height:Math.max(-b+R.h,y)+"px",top:M+"px"},nw:{width:Math.max(-x+R.w,L)+"px",height:Math.max(-b+R.h,y)+"px",top:M+"px",left:z+"px"},ne:{width:Math.max(x+R.w,L)+"px",height:Math.max(-b+R.h,y)+"px",top:M+"px"},sw:{width:Math.max(-x+R.w,L)+"px",height:Math.max(b+R.h,y)+"px",left:z+"px"}}[w]);$(H).css(n);var a=(h=O,r=s,d=(l=o)+R.w>L?S.w-A+l-k:L-(R.w-S.w)-A-k,g=r+R.h>y?S.h-E+r+k:y-(R.h-S.h)-E+k,p=-l+R.w>L?S.w-A-l-k:L-(R.w-S.w)-A-k,c=-r+R.h>y?S.h-E-r+k:y-(R.h-S.h)-E+k,u=(0<d?$(C).position().left:$(C).position().left<0?$(C).position().left:0)-k,f=(0<g?$(C).position().top:$(C).position().top<0?$(C).position().top:0)+k,m=(0<p?$(C).position().left:$(C).position().left<0?$(C).position().left:0)-k,v=(0<c?$(C).position().top:$(C).position().top<0?$(C).position().top:0)+k,{e:{left:-k<=d?(d-k)/2+"px":d<u?u+"px":d+"px"},s:{top:k<=g?(g+k)/2+"px":g<f?f+"px":g+"px"},se:{top:k<=g?(g+k)/2+"px":g<f?f+"px":g+"px",left:-k<=d?(d-k)/2+"px":d<u?u+"px":d+"px"},w:{left:-k<=p?(p-k)/2+"px":p<m?m+"px":p+"px"},n:{top:k<=c?(c+k)/2+"px":c<v?v+"px":c+"px"},nw:{top:k<=c?(c+k)/2+"px":c<v?v+"px":c+"px",left:-k<=p?(p-k)/2+"px":p<m?m+"px":p+"px"},ne:{top:k<=c?(c+k)/2+"px":c<v?v+"px":c+"px",left:-k<=d?(d-k)/2+"px":d<u?u+"px":d+"px"},sw:{top:k<=g?(g+k)/2+"px":g<f?f+"px":g+"px",left:-k<=p?(p-k)/2+"px":p<m?m+"px":p+"px"}}[h]);$(C).css(a),T.isDoResize=!0}var h,l,r,d,g,p,c,u,f,m,v,w,x,b,z,M},p=function t(){w.off(M+B,g).off(W+B,t),Y.isResizing&&b({w:A,h:E},{w:$(s).width(),h:$(s).height()},s),D=!1,Y.isResizing=!1,$(m).css("cursor","");var i=T.getImageScaleToStage($(s).width(),$(s).height());$.extend(T.imageData,{initWidth:T.img.width*i,initHeight:T.img.height*i,initLeft:($(s).width()-T.img.width*i)/2,initTop:($(s).height()-T.img.height*i)/2})};$.each(r,function(o,t){t.on(z+B,function(t){var i,e;i=o,(e=(e=t)||window.event).preventDefault(),D=!0,Y.isResizing=!0,I="touchstart"===e.type?e.originalEvent.targetTouches[0].pageX:e.clientX,V="touchstart"===e.type?e.originalEvent.targetTouches[0].pageY:e.clientY,R={w:$(H).width(),h:$(H).height(),l:$(H).offset().left,t:$(H).offset().top},S={w:$(s).width(),h:$(s).height(),l:$(s).offset().left,t:$(s).offset().top},d={w:$(C).width(),h:$(C).height(),l:$(C).position().left,t:$(C).position().top},k=T.isRotated?(d.w-d.h)/2:0,A=T.isRotated?d.h:d.w,E=T.isRotated?d.w:d.h,O=i,$(m).css("cursor",i+"-resize"),w.on(M+B,g).on(W+B,p)})})}},d=function(){function t(t,i,e){this.options=x.extend(!0,{},n,i),i&&x.isArray(i.footToolbar)&&(this.options.footToolbar=i.footToolbar),i&&x.isArray(i.headToolbar)&&(this.options.headToolbar=i.headToolbar),this.$el=x(e),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isDoResize=!1,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(t,this.options,e)}var i=t.prototype;return i.init=function(t,i,e){this.groupData=t,this.groupIndex=i.index;var o=t[this.groupIndex].src;this.open(),this.loadImg(o),i.draggable&&this.draggable(this.$photoviewer,this.dragHandle,l+"-button"),i.movable&&this.movable(this.$stage,this.$image),i.resizable&&this.resizable(this.$photoviewer,this.$stage,this.$image,i.modalWidth,i.modalHeight)},i._creatBtns=function(t,e){var o="";return x.each(t,function(t,i){o+=e[i]}),o},i._creatTitle=function(){return this.options.title?'<div class="'+c+'-title"></div>':""},i._creatDOM=function(){var t={minimize:'<button class="'+c+"-button "+c+'-button-minimize"\n                  title="'+this.options.i18n.minimize+'">\n                    '+this.options.icons.minimize+"\n                  </button>",maximize:'<button class="'+c+"-button "+c+'-button-maximize"\n                  title="'+this.options.i18n.maximize+'">\n                    '+this.options.icons.maximize+"\n                  </button>",close:'<button class="'+c+"-button "+c+'-button-close"\n              title="'+this.options.i18n.close+'">\n                '+this.options.icons.close+"\n              </button>",zoomIn:'<button class="'+c+"-button "+c+'-button-zoom-in"\n                title="'+this.options.i18n.zoomIn+'">\n                  '+this.options.icons.zoomIn+"\n                </button>",zoomOut:'<button class="'+c+"-button "+c+'-button-zoom-out"\n                title="'+this.options.i18n.zoomOut+'">\n                  '+this.options.icons.zoomOut+"\n                </button>",prev:'<button class="'+c+"-button "+c+'-button-prev"\n              title="'+this.options.i18n.prev+'">\n                '+this.options.icons.prev+"\n              </button>",next:'<button class="'+c+"-button "+c+'-button-next"\n              title="'+this.options.i18n.next+'">\n                '+this.options.icons.next+"\n              </button>",fullscreen:'<button class="'+c+"-button "+c+'-button-fullscreen"\n                    title="'+this.options.i18n.fullscreen+'">\n                    '+this.options.icons.fullscreen+"\n                  </button>",actualSize:'<button class="'+c+"-button "+c+'-button-actual-size"\n                    title="'+this.options.i18n.actualSize+'">\n                      '+this.options.icons.actualSize+"\n                    </button>",rotateLeft:'<button class="'+c+"-button "+c+'-button-rotate-left"\n                    title="'+this.options.i18n.rotateLeft+'">\n                      '+this.options.icons.rotateLeft+"\n                    </button>",rotateRight:'<button class="'+c+"-button "+c+'-button-rotate-right"\n                      title="'+this.options.i18n.rotateRight+'">\n                      '+this.options.icons.rotateRight+"\n                    </button>"};return'<div class="'+c+'-modal">\n        <div class="'+c+'-inner">\n          <div class="'+c+'-header">\n            <div class="'+c+"-toolbar "+c+'-toolbar-head">\n              '+this._creatBtns(this.options.headToolbar,t)+"\n            </div>\n            "+this._creatTitle()+'\n          </div>\n          <div class="'+c+'-stage">\n            <img class="'+c+'-image" src="" alt="" />\n          </div>\n          <div class="'+c+'-footer">\n            <div class="'+c+"-toolbar "+c+'-toolbar-foot">\n              '+this._creatBtns(this.options.footToolbar,t)+"\n            </div>\n          </div>\n        </div>\n      </div>"},i.build=function(){var t=this._creatDOM(),i=x(t);this.$photoviewer=i,this.$header=i.find(l+"-header"),this.$headToolbar=i.find(l+"-toolbar-head"),this.$footer=i.find(l+"-footer"),this.$footToolbar=i.find(l+"-toolbar-foot"),this.$stage=i.find(l+"-stage"),this.$title=i.find(l+"-title"),this.$image=i.find(l+"-image"),this.$close=i.find(l+"-button-close"),this.$maximize=i.find(l+"-button-maximize"),this.$minimize=i.find(l+"-button-minimize"),this.$zoomIn=i.find(l+"-button-zoom-in"),this.$zoomOut=i.find(l+"-button-zoom-out"),this.$actualSize=i.find(l+"-button-actual-size"),this.$fullscreen=i.find(l+"-button-fullscreen"),this.$rotateLeft=i.find(l+"-button-rotate-left"),this.$rotateRight=i.find(l+"-button-rotate-right"),this.$prev=i.find(l+"-button-prev"),this.$next=i.find(l+"-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$photoviewer.css("z-index",Y.zIndex),this.options.dragHandle&&this.options.dragHandle!==l+"-modal"?this.dragHandle=this.$photoviewer.find(this.options.dragHandle):this.dragHandle=this.$photoviewer},i.open=function(){if(this.options.multiInstances||x(l+"-modal").eq(0).remove(),!x(l+"-modal").length&&this.options.fixedContent&&(x("html").css({overflow:"hidden"}),document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight))){var t=function(){var t=document.createElement("div");t.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),i}();t&&x("html").css({"padding-right":t})}this.build(),this._triggerHook("beforeOpen",this.$el),x("body").append(this.$photoviewer),this.addEvents(),this.setModalPos(this.$photoviewer),this._triggerHook("opened",this.$el)},i.close=function(){this._triggerHook("beforeClose",this.$el),this.$photoviewer.remove(),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0;var t=!x(l+"-modal").length;t&&this.options.fixedContent&&x("html").css({overflow:"","padding-right":""}),t&&this.options.multiInstances&&(Y.zIndex=this.options.zIndex),x(l+"-modal").length||(w.off(s+B),f.off(o+B)),this._triggerHook("closed",this.$el)},i.setModalPos=function(t){var i=f.width(),e=f.height(),o=w.scrollLeft(),s=w.scrollTop(),n=this.options.modalWidth,a=this.options.modalHeight;this.options.initMaximized?(t.addClass(c+"-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:n,height:a,left:(i-n)/2+o+"px",top:(e-a)/2+s+"px"})},i.setModalSize=function(t){var i=this,e=f.width(),o=f.height(),s=w.scrollLeft(),n=w.scrollTop(),a={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},h=t.width+u(a.left)+u(a.right)+u(a.borderLeft)+u(a.borderRight),l=t.height+u(a.top)+u(a.bottom)+u(a.borderTop)+u(a.borderBottom),r=(0<this.options.gapThreshold?this.options.gapThreshold:0)+1,d=Math.min(e/(h*r),o/(l*r),1),g=Math.max(h*d,this.options.modalWidth),p=Math.max(l*d,this.options.modalHeight),c={width:(g=this.options.fixedModalSize?this.options.modalWidth:Math.round(g))+"px",height:(p=this.options.fixedModalSize?this.options.modalHeight:Math.round(p))+"px",left:(e-g)/2+s+"px",top:(o-p)/2+n+"px"};this.options.initAnimation?this.$photoviewer.animate(c,function(){i.setImageSize(t)}):(this.$photoviewer.css(c),this.setImageSize(t)),this.isOpened=!0},i.getImageScaleToStage=function(t,i){return this.isRotated?Math.min(t/this.img.height,i/this.img.width,1):Math.min(t/this.img.width,i/this.img.height,1)},i.setImageSize=function(t){var i={w:this.$stage.width(),h:this.$stage.height()},e=this.getImageScaleToStage(i.w,i.h);this.$image.css({width:Math.ceil(t.width*e)+"px",height:Math.ceil(t.height*e)+"px",left:(i.w-Math.ceil(t.width*e))/2+"px",top:(i.h-Math.ceil(t.height*e))/2+"px"}),x.extend(this.imageData,{initWidth:t.width*e,initHeight:t.height*e,initLeft:(i.w-t.width*e)/2,initTop:(i.h-t.height*e)/2,width:t.width*e,height:t.height*e,left:(i.w-t.width*e)/2,top:(i.h-t.height*e)/2}),b({w:this.$image.width(),h:this.$image.height()},{w:this.$stage.width(),h:this.$stage.height()},this.$stage,this.isRotated),this.$stage.removeClass("stage-ready"),this.$image.removeClass("image-ready"),this.$photoviewer.find(l+"-loader").remove(),this.options.initAnimation&&!this.options.progressiveLoading&&this.$image.fadeIn()},i.loadImg=function(t,i,e){var o,s,n,a,h=this;this.$photoviewer.append('<div class="photoviewer-loader"></div>'),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$image.removeAttr("style").attr("src",""),this.isRotated=!1,this.rotateAngle=0,this.options.initAnimation&&!this.options.progressiveLoading&&this.$image.hide(),this.$image.attr("src",t),o=t,s=function(t){h.img=t,h.imageData={originalWidth:t.width,originalHeight:t.height},h.isMaximized||h.isOpened&&h.options.fixedModalPos?h.setImageSize(t):h.setModalSize(t),i&&i.call()},n=function(){h.$photoviewer.find(l+"-loader").remove(),e&&e.call()},(a=new Image).onload=function(){s(a)},a.onerror=function(){n(a)},a.src=o,this.options.title&&this.setImgTitle(t)},i.setImgTitle=function(t){var i=this.groupData[this.groupIndex].title?this.groupData[this.groupIndex].title:t.replace(/^.*?\/*([^/?]*)\.[a-z]+(\?.+|$)/gi,"$1");this.$title.html(i)},i.jump=function(t){this._triggerHook("beforeChange",this.groupIndex),this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)},i.jumpTo=function(t){var i=this;0<=(t%=this.groupData.length)?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImg(this.groupData[t].src,function(){i._triggerHook("changed",t)},function(){i._triggerHook("changed",t)})},i.wheel=function(t){t.preventDefault();var i=1;t.originalEvent.deltaY?i=0<t.originalEvent.deltaY?1:-1:t.originalEvent.wheelDelta?i=-t.originalEvent.wheelDelta/120:t.originalEvent.detail&&(i=0<t.originalEvent.detail?1:-1);var e=-i*this.options.ratioThreshold,o={x:t.originalEvent.clientX-this.$stage.offset().left+w.scrollLeft(),y:t.originalEvent.clientY-this.$stage.offset().top+w.scrollTop()};this.zoom(e,o,t)},i.zoom=function(t,i,e){t=t<0?1/(1-t):1+t,(t=this.$image.width()/this.imageData.originalWidth*t)>this.options.maxRatio||t<this.options.minRatio||this.zoomTo(t,i,e)},i.zoomTo=function(t,i,e){var o=this.$image,s=this.$stage,n=this.imageData.width,a=this.imageData.height,h=this.imageData.left,l=this.imageData.top,r={w:s.width(),h:s.height(),x:s.offset().left,y:s.offset().top},d=this.imageData.originalWidth*t,g=this.imageData.originalHeight*t,p=i.x-(i.x-h)/n*d,c=i.y-(i.y-l)/a*g,u=this.isRotated?(d-g)/2:0,f=this.isRotated?g:d,m=this.isRotated?d:g,v=r.w-d,w=r.h-g;
// The conditions with image rotate 90 degree drive me crazy alomst!
c=m<=r.h?(r.h-g)/2:u<c?u:w-u<c?c:w-u,p=f<=r.w?(r.w-d)/2:-u<p?-u:v+u<p?p:v+u,Math.abs(this.imageData.initWidth-d)<.05*this.imageData.initWidth?this.setImageSize(this.img):(o.css({width:Math.round(d)+"px",height:Math.round(g)+"px",left:Math.round(p)+"px",top:Math.round(c)+"px"}),b({w:Math.round(f),h:Math.round(m)},{w:r.w,h:r.h},this.$stage)),x.extend(this.imageData,{width:d,height:g,left:p,top:c})},i.rotate=function(t){this.rotateAngle=this.rotateAngle+t,this.rotateAngle/90%2==0?this.isRotated=!1:this.isRotated=!0,this.rotateTo(this.rotateAngle)},i.rotateTo=function(t){this.$image.css({transform:"rotate("+t+"deg)"}),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}),this.$stage.removeClass("is-grab")},i.resize=function(){var e,o,s,t=this;return e=function(){t.isOpened&&(t.isMaximized?t.setImageSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}):t.setModalSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}))},o=500,s=null,function(){var t=this,i=arguments;clearTimeout(s),s=setTimeout(function(){e.apply(t,i)},o)}},i.maximize=function(){this.isMaximized?(this.$photoviewer.removeClass(c+"-maximize"),this.$photoviewer.css({width:this.modalData.width?this.modalData.width:this.options.modalWidth,height:this.modalData.height?this.modalData.height:this.options.modalHeight,left:this.modalData.left?this.modalData.left:(f.width()-this.options.modalWidth)/2+w.scrollLeft(),top:this.modalData.top?this.modalData.top:(f.height()-this.options.modalHeight)/2+w.scrollTop()}),this.isMaximized=!1):(this.modalData={width:this.$photoviewer.width(),height:this.$photoviewer.height(),left:this.$photoviewer.offset().left,top:this.$photoviewer.offset().top},this.$photoviewer.addClass(c+"-maximize"),this.$photoviewer.css({width:"100%",height:"100%",left:0,top:0}),this.isMaximized=!0),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight})},i.fullscreen=function(){var t;(t=this.$photoviewer[0]).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},i.keydown=function(t){if(!this.options.keyboard)return!1;var i=t.keyCode||t.which||t.charCode,e=t.ctrlKey||t.metaKey,o=t.altKey||t.metaKey;switch(i){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 187:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 189:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 61:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 173:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 48:e&&o&&this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 188:e&&this.rotate(-90);break;case 190:e&&this.rotate(90)}},i.addEvents=function(){var i=this;this.$close.off(e+B).on(e+B,function(t){i.close()}),this.$stage.off(a+B).on(a+B,function(t){i.wheel(t)}),this.$zoomIn.off(e+B).on(e+B,function(t){i.zoom(3*i.options.ratioThreshold,{x:i.$stage.width()/2,y:i.$stage.height()/2},t)}),this.$zoomOut.off(e+B).on(e+B,function(t){i.zoom(3*-i.options.ratioThreshold,{x:i.$stage.width()/2,y:i.$stage.height()/2},t)}),this.$actualSize.off(e+B).on(e+B,function(t){i.zoomTo(1,{x:i.$stage.width()/2,y:i.$stage.height()/2},t)}),this.$prev.off(e+B).on(e+B,function(){i.jump(-1)}),this.$fullscreen.off(e+B).on(e+B,function(){i.fullscreen()}),this.$next.off(e+B).on(e+B,function(){i.jump(1)}),this.$rotateLeft.off(e+B).on(e+B,function(){i.rotate(-90)}),this.$rotateRight.off(e+B).on(e+B,function(){i.rotate(90)}),this.$maximize.off(e+B).on(e+B,function(){i.maximize()}),w.off(s+B).on(s+B,function(t){i.keydown(t)}),f.on(o+B,this.resize())},i._triggerHook=function(t,i){this.options.callbacks[t]&&this.options.callbacks[t].apply(this,x.isArray(i)?i:[i])},t}();x.extend(d.prototype,i,h,r),window.PhotoViewer=d;var g=null,p=function(t,e){var o=[];return x(t).each(function(){var t,i=(t=this,$(t).attr("data-src")?$(t).attr("data-src"):$(t).attr("href"));o.push({src:i,title:x(this).attr("data-title"),groupName:e})}),o};return x.fn.photoviewer=function(s){for(var t in g=x(this),s=s||{})"string"!=typeof s[t]||isNaN(s[t])||(s[t]=parseFloat(s[t]));var i=x.extend(!0,{},n,s);return Y.zIndex=i.zIndex,"string"==typeof s||g.off(e+B).on(e+B,function(t){t.preventDefault(),t.stopPropagation();var i=[],e=x(this).attr("data-group"),o=w.find('[data-group="'+e+'"]');s.index=void 0!==e?(i=p(o,e),x(this).index('[data-group="'+e+'"]')):(i=p(g.not("[data-group]")),x(this).index()),x(this).data(c,new d(i,s,this))}),g},w.on(e+B,"[data-"+c+"]",function(t){g=x("[data-"+c+"]"),t.preventDefault();var i=[],e=x(this).attr("data-group"),o=w.find('[data-group="'+e+'"]');n.index=void 0!==e?(i=p(o,e),x(this).index('[data-group="'+e+'"]')):(i=p(g.not("[data-group]")),x(this).index()),x(this).data(c,new d(i,n,this))}),d});