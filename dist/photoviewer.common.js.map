{"version":3,"file":"photoviewer.common.js","sources":["../src/js/defaults.js","../src/js/utilities.js","../src/js/constants.js","../src/js/draggable.js","../src/js/movable.js","../src/js/resizable.js","../src/js/core.js"],"sourcesContent":["export default {\r\n\r\n  // Enable modal to drag\r\n  draggable: true,\r\n\r\n  // Enable modal to resize\r\n  resizable: true,\r\n\r\n  // Enable image to move\r\n  movable: true,\r\n\r\n  // Enable keyboard navigation\r\n  keyboard: true,\r\n\r\n  // Shows the title\r\n  title: true,\r\n\r\n  // Min width of modal\r\n  modalWidth: 320,\r\n\r\n  // Min height of modal\r\n  modalHeight: 320,\r\n\r\n  // Enable the page content fixed\r\n  fixedContent: true,\r\n\r\n  // Disable the modal size fixed\r\n  fixedModalSize: false,\r\n\r\n  // Disable the image viewer maximized on init\r\n  initMaximized: false,\r\n\r\n  // Threshold of modal to browser window\r\n  gapThreshold: 0.02,\r\n\r\n  // Threshold of image ratio\r\n  ratioThreshold: 0.1,\r\n\r\n  // Min ratio of image when zoom out\r\n  minRatio: 0.05,\r\n\r\n  // Max ratio of image when zoom in\r\n  maxRatio: 16,\r\n\r\n  // Toolbar options in header\r\n  headToolbar: [\r\n    'maximize',\r\n    'close'\r\n  ],\r\n\r\n  // Toolbar options in footer\r\n  footToolbar: [\r\n    'zoomIn',\r\n    'zoomOut',\r\n    'prev',\r\n    'fullscreen',\r\n    'next',\r\n    'actualSize',\r\n    'rotateRight'\r\n  ],\r\n\r\n  // Customize button icon\r\n  icons: {\r\n    minimize: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n               <path fill=\"currentColor\" d=\"M20,14H4V10H20\"></path>\r\n               </svg>`,\r\n    maximize: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n               <path fill=\"currentColor\" d=\"M4,4H20V20H4V4M6,8V18H18V8H6Z\"></path>\r\n               </svg>`,\r\n    close: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n            <path fill=\"currentColor\" d=\"M13.46,12L19,17.54V19H17.54L12,13.46\r\n            L6.46,19H5V17.54L10.54,12L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46\r\n            L13.46,12Z\"></path>\r\n            </svg>`,\r\n    zoomIn: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n             <path fill=\"currentColor\" d=\"M15.5,14L20.5,19L19,20.5L14,15.5V14.71\r\n             L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,\r\n             6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,\r\n             13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,\r\n             7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z\"></path>\r\n            </svg>`,\r\n    zoomOut: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n              <path fill=\"currentColor\" d=\"M15.5,14H14.71L14.43,13.73C15.41,\r\n              12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,\r\n              6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5\r\n              L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,\r\n              5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z\"></path>\r\n              </svg>`,\r\n    prev: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n           <path fill=\"currentColor\" d=\"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z\"></path>\r\n           </svg>`,\r\n    next: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n           <path fill=\"currentColor\" d=\"M16,18H18V6H16M6,18L14.5,12L6,6V18Z\"></path>\r\n           </svg>`,\r\n    fullscreen: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n                 <path fill=\"currentColor\" d=\"M8.5,12.5L11,15.5L14.5,11L19,17H5\r\n                 M23,18V6A2,2 0 0,0 21,4H3A2,2 0 0,0 1,6V18A2,2 0 0,0 3,20H21A2,\r\n                 2 0 0,0 23,18Z\"></path>\r\n                 </svg>`,\r\n    actualSize: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n                 <path fill=\"currentColor\" d=\"M9.5,13.09L10.91,14.5L6.41,19H10V21\r\n                 H3V14H5V17.59L9.5,13.09M10.91,9.5L9.5,10.91L5,6.41V10H3V3H10V5\r\n                 H6.41L10.91,9.5M14.5,13.09L19,17.59V14H21V21H14V19H17.59L13.09,\r\n                 14.5L14.5,13.09M13.09,9.5L17.59,5H14V3H21V10H19V6.41L14.5,10.91\r\n                 L13.09,9.5Z\"></path>\r\n                </svg>`,\r\n    rotateLeft: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n                 <path fill=\"currentColor\" d=\"M13,4.07V1L8.45,5.55L13,10V6.09\r\n                 C15.84,6.57 18,9.03 18,12C18,14.97 15.84,17.43 13,17.91V19.93\r\n                 C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07M7.1,18.32\r\n                 C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,\r\n                 16.87L7.1,18.32M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89\r\n                 L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13M7.11,8.53L5.7,7.11C4.8,\r\n                 8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z\"></path>\r\n                 </svg>`,\r\n    rotateRight: `<svg viewBox=\"0 0 24 24\" class=\"svg-inline-icon\">\r\n                  <path fill=\"currentColor\" d=\"M16.89,15.5L18.31,16.89C19.21,\r\n                  15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,\r\n                  15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,\r\n                  16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,\r\n                  8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,\r\n                  5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93\r\n                  V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,\r\n                  5.55Z\"></path>\r\n                  </svg>`\r\n  },\r\n\r\n  // Customize language of button title\r\n  i18n: {\r\n    minimize: 'minimize',\r\n    maximize: 'maximize',\r\n    close: 'close',\r\n    zoomIn: 'zoom-in(+)',\r\n    zoomOut: 'zoom-out(-)',\r\n    prev: 'prev(←)',\r\n    next: 'next(→)',\r\n    fullscreen: 'fullscreen',\r\n    actualSize: 'actual-size(Ctrl+Alt+0)',\r\n    rotateLeft: 'rotate-left(Ctrl+,)',\r\n    rotateRight: 'rotate-right(Ctrl+.)'\r\n  },\r\n\r\n  // Enable multiple instances\r\n  multiInstances: true,\r\n\r\n  // Enable animation\r\n  initAnimation: true,\r\n\r\n  // Disable modal position fixed when change images\r\n  fixedModalPos: false,\r\n\r\n  // Modal z-index\r\n  zIndex: 1090,\r\n\r\n  // Selector of drag handler\r\n  dragHandle: false,\r\n\r\n  // Callback events\r\n  callbacks: {\r\n    beforeOpen: $.noop,\r\n    opened: $.noop,\r\n    beforeClose: $.noop,\r\n    closed: $.noop,\r\n    beforeChange: $.noop,\r\n    changed: $.noop\r\n  },\r\n\r\n  // Start images index\r\n  index: 0,\r\n\r\n  // Load the image progressively\r\n  progressiveLoading: true\r\n\r\n}\r\n","/**\r\n * [getImgSrc]\r\n * @param {[Object]}  el    [description]\r\n */\r\nexport function getImgSrc(el) {\r\n  // Get data-src as image src at first\r\n  let src = $(el).attr('data-src')\r\n    ? $(el).attr('data-src')\r\n    : $(el).attr('href');\r\n  return src;\r\n}\r\n\r\n/**\r\n * [throttle]\r\n * @param  {Function} fn    [description]\r\n * @param  {[Number]} delay [description]\r\n * @return {Function}       [description]\r\n */\r\nexport function throttle(fn, delay) {\r\n\r\n  let timer = null;\r\n\r\n  return function () {\r\n    let context = this,\r\n      args = arguments;\r\n\r\n    clearTimeout(timer);\r\n\r\n    timer = setTimeout(function () {\r\n      fn.apply(context, args);\r\n    }, delay);\r\n  };\r\n\r\n}\r\n\r\n/**\r\n * [preloadImg]\r\n * @param  {[String]}  src      [image src]\r\n * @param  {Function}  success  [callbacks]\r\n * @param  {Function}  error    [callbacks]\r\n */\r\nexport function preloadImg(src, success, error) {\r\n\r\n  let img = new Image();\r\n\r\n  img.onload = function () {\r\n    success(img);\r\n  };\r\n\r\n  img.onerror = function () {\r\n    error(img);\r\n  };\r\n\r\n  img.src = src;\r\n\r\n}\r\n\r\n/**\r\n * [requestFullscreen]\r\n * @param  {[type]} element [description]\r\n */\r\nexport function requestFullscreen(element) {\r\n  if (element.requestFullscreen) {\r\n    element.requestFullscreen();\r\n  } else if (element.mozRequestFullScreen) {\r\n    element.mozRequestFullScreen();\r\n  } else if (element.webkitRequestFullscreen) {\r\n    element.webkitRequestFullscreen();\r\n  } else if (element.msRequestFullscreen) {\r\n    element.msRequestFullscreen();\r\n  }\r\n}\r\n\r\n/**\r\n * [exitFullscreen]\r\n */\r\nexport function exitFullscreen() {\r\n  if (document.exitFullscreen) {\r\n    document.exitFullscreen();\r\n  } else if (document.mozCancelFullScreen) {\r\n    document.mozCancelFullScreen();\r\n  } else if (document.webkitExitFullscreen) {\r\n    document.webkitExitFullscreen();\r\n  }\r\n}\r\n\r\n/**\r\n * [getImageNameFromUrl]\r\n * @param  {[String]} url [description]\r\n * @return {[String]}     [description]\r\n */\r\nexport function getImageNameFromUrl(url) {\r\n  let reg = /^.*?\\/*([^/?]*)\\.[a-z]+(\\?.+|$)/ig,\r\n    txt = url.replace(reg, '$1');\r\n  return txt;\r\n}\r\n\r\n/**\r\n * [getNumFromCSSValue]\r\n * @param  {[String]} value [description]\r\n * @return {[Number]}       [description]\r\n */\r\nexport function getNumFromCSSValue(value) {\r\n  let reg = /\\d+/g,\r\n    arr = value.match(reg),\r\n    num = parseFloat(arr[0]);\r\n  return num;\r\n}\r\n\r\n/**\r\n * [hasScrollbar]\r\n * @return {[Boolean]}       [description]\r\n */\r\nexport function hasScrollbar() {\r\n  return document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight);\r\n}\r\n\r\n/**\r\n * [getScrollbarWidth]\r\n * @return {[Number]}       [description]\r\n */\r\nexport function getScrollbarWidth() {\r\n\r\n  let scrollDiv = document.createElement('div');\r\n  scrollDiv.style.cssText = 'width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';\r\n  document.body.appendChild(scrollDiv);\r\n  let scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\r\n  document.body.removeChild(scrollDiv);\r\n\r\n  return scrollbarWidth;\r\n\r\n}\r\n\r\n/**\r\n * [setGrabCursor]\r\n * @param {[Object]}  imageData    [description]\r\n * @param {[Object]}  stageData    [description]\r\n * @param {[Object]}  stage        [description]\r\n * @param {[Boolean]} isRotate     [description]\r\n */\r\nexport function setGrabCursor(imageData, stageData, stage, isRotated) {\r\n\r\n  let imageWidth = !isRotated ? imageData.w : imageData.h,\r\n    imageHeight = !isRotated ? imageData.h : imageData.w;\r\n\r\n  if (imageHeight > stageData.h || imageWidth > stageData.w) {\r\n    stage.addClass('is-grab');\r\n  }\r\n  if (imageHeight <= stageData.h && imageWidth <= stageData.w) {\r\n    stage.removeClass('is-grab');\r\n  }\r\n}\r\n\r\n/**\r\n * [supportTouch]\r\n * @return {[Boolean]}     [description]\r\n */\r\nexport function supportTouch() {\r\n  return !!(('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch);\r\n}\r\n","import defaults from './defaults';\r\nimport { supportTouch } from './utilities';\r\n\r\nexport const $W = $(window);\r\nexport const $D = $(document);\r\n\r\nexport const CLICK_EVENT = 'click';\r\nexport const RESIZE_EVENT = 'resize';\r\nexport const KEYDOWN_EVENT = 'keydown';\r\nexport const WHEEL_EVENT = 'wheel mousewheel DOMMouseScroll';\r\n\r\nexport const TOUCH_START_EVENT = supportTouch() ? 'touchstart' : 'mousedown';\r\nexport const TOUCH_MOVE_EVENT = supportTouch() ? 'touchmove' : 'mousemove';\r\nexport const TOUCH_END_EVENT = supportTouch() ? 'touchend' : 'mouseup';\r\n\r\nexport const NS = 'photoviewer';\r\nexport const CLASS_NS = '.' + NS;\r\nexport const EVENT_NS = '.' + NS;\r\n\r\nexport const PUBLIC_VARS = {\r\n  // image moving flag\r\n  isMoving: false,\r\n  // modal resizing flag\r\n  isResizing: false,\r\n  // modal z-index setting\r\n  zIndex: defaults.zIndex,\r\n};\r\n","import {\r\n  $D,\r\n  TOUCH_START_EVENT,\r\n  TOUCH_MOVE_EVENT,\r\n  TOUCH_END_EVENT,\r\n  EVENT_NS,\r\n  PUBLIC_VARS\r\n} from './constants';\r\n\r\nexport default {\r\n\r\n  /**\r\n   * [draggable]\r\n   * @param  {[Object]} modal       [the modal element]\r\n   * @param  {[Object]} dragHandle  [the handle element when dragging]\r\n   * @param  {[Object]} dragCancel  [the cancel element when dragging]\r\n   */\r\n  draggable(modal, dragHandle, dragCancel) {\r\n\r\n    let isDragging = false;\r\n\r\n    let startX = 0,\r\n      startY = 0,\r\n\r\n      left = 0,\r\n      top = 0;\r\n\r\n    let dragStart = (e) => {\r\n\r\n      e = e || window.event;\r\n\r\n      // Must be removed\r\n      // e.preventDefault();\r\n\r\n      if (this.options.multiInstances) {\r\n        modal.css('z-index', ++PUBLIC_VARS['zIndex']);\r\n      }\r\n\r\n      // Get clicked button\r\n      let elemCancel = $(e.target).closest(dragCancel);\r\n      // Stop modal moving when click buttons\r\n      if (elemCancel.length) {\r\n        return true;\r\n      }\r\n\r\n      isDragging = true;\r\n\r\n      startX = e.type === 'touchstart'\r\n        ? e.originalEvent.targetTouches[0].pageX\r\n        : e.clientX;\r\n      startY = e.type === 'touchstart'\r\n        ? e.originalEvent.targetTouches[0].pageY\r\n        : e.clientY;\r\n\r\n      left = $(modal).offset().left;\r\n      top = $(modal).offset().top;\r\n\r\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\r\n        .on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\r\n\r\n    };\r\n\r\n    let dragMove = (e) => {\r\n\r\n      e = e || window.event;\r\n\r\n      e.preventDefault();\r\n\r\n      if (isDragging && !PUBLIC_VARS['isMoving'] && !PUBLIC_VARS['isResizing'] && !this.isMaximized) {\r\n\r\n        let endX = e.type === 'touchmove'\r\n          ? e.originalEvent.targetTouches[0].pageX\r\n          : e.clientX,\r\n          endY = e.type === 'touchmove'\r\n            ? e.originalEvent.targetTouches[0].pageY\r\n            : e.clientY,\r\n\r\n          relativeX = endX - startX,\r\n          relativeY = endY - startY;\r\n\r\n        $(modal).css({\r\n          left: relativeX + left + 'px',\r\n          top: relativeY + top + 'px'\r\n        });\r\n\r\n      }\r\n\r\n    };\r\n\r\n    let dragEnd = () => {\r\n\r\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\r\n        .off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\r\n\r\n      isDragging = false;\r\n\r\n    };\r\n\r\n    $(dragHandle).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\r\n\r\n  }\r\n\r\n}\r\n","import {\r\n  $D,\r\n  TOUCH_START_EVENT,\r\n  TOUCH_MOVE_EVENT,\r\n  TOUCH_END_EVENT,\r\n  NS,\r\n  EVENT_NS,\r\n  PUBLIC_VARS\r\n} from './constants';\r\n\r\nconst ELEMS_WITH_GRABBING_CURSOR = `html,body,.${NS}-modal,.${NS}-stage,.${NS}-button,.${NS}-resizable-handle`;\r\n\r\nexport default {\r\n\r\n  /**\r\n   * --------------------------------------\r\n   * 1.no movable\r\n   * 2.vertical movable\r\n   * 3.horizontal movable\r\n   * 4.vertical & horizontal movable\r\n   * --------------------------------------\r\n   *\r\n   * [image movable]\r\n   * @param  {[Object]} stage   [the stage element]\r\n   * @param  {[Object]} image   [the image element]\r\n   */\r\n  movable(stage, image) {\r\n\r\n    let isDragging = false;\r\n\r\n    let startX = 0,\r\n      startY = 0,\r\n\r\n      left = 0,\r\n      top = 0,\r\n\r\n      widthDiff = 0,\r\n      heightDiff = 0,\r\n\r\n      δ = 0;\r\n\r\n    let dragStart = (e) => {\r\n\r\n      e = e || window.event;\r\n\r\n      e.preventDefault();\r\n\r\n      let imageWidth = $(image).width(),\r\n        imageHeight = $(image).height(),\r\n        stageWidth = $(stage).width(),\r\n        stageHeight = $(stage).height();\r\n\r\n      startX = e.type === 'touchstart'\r\n        ? e.originalEvent.targetTouches[0].pageX\r\n        : e.clientX;\r\n      startY = e.type === 'touchstart'\r\n        ? e.originalEvent.targetTouches[0].pageY\r\n        : e.clientY;\r\n\r\n      // δ is the difference between image width and height\r\n      δ = !this.isRotated ? 0 : (imageWidth - imageHeight) / 2;\r\n\r\n      // Width or height difference can be use to limit image right or top position\r\n      widthDiff = !this.isRotated\r\n        ? (imageWidth - stageWidth)\r\n        : (imageHeight - stageWidth);\r\n      heightDiff = !this.isRotated\r\n        ? (imageHeight - stageHeight)\r\n        : (imageWidth - stageHeight);\r\n\r\n      // Modal can be dragging if image is smaller to stage\r\n      isDragging = (widthDiff > 0 || heightDiff > 0) ? true : false;\r\n      PUBLIC_VARS['isMoving'] = (widthDiff > 0 || heightDiff > 0) ? true : false;\r\n\r\n      // Reclac the element position when mousedown\r\n      // Fixed the issue of stage with a border\r\n      left = $(image).position().left - δ;\r\n      top = $(image).position().top + δ;\r\n\r\n      // Add grabbing cursor\r\n      if (stage.hasClass('is-grab')) {\r\n        $(ELEMS_WITH_GRABBING_CURSOR).addClass('is-grabbing');\r\n      }\r\n\r\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\r\n        .on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\r\n\r\n    };\r\n\r\n    let dragMove = (e) => {\r\n\r\n      e = e || window.event;\r\n\r\n      e.preventDefault();\r\n\r\n      if (isDragging) {\r\n\r\n        let endX = e.type === 'touchmove'\r\n          ? e.originalEvent.targetTouches[0].pageX\r\n          : e.clientX,\r\n          endY = e.type === 'touchmove'\r\n            ? e.originalEvent.targetTouches[0].pageY\r\n            : e.clientY,\r\n\r\n          relativeX = endX - startX,\r\n          relativeY = endY - startY,\r\n\r\n          newLeft = relativeX + left,\r\n          newTop = relativeY + top;\r\n\r\n        // vertical limit\r\n        if (heightDiff > 0) {\r\n\r\n          if ((relativeY + top) > δ) {\r\n            newTop = δ;\r\n          } else if ((relativeY + top) < -heightDiff + δ) {\r\n            newTop = -heightDiff + δ;\r\n          }\r\n\r\n        } else {\r\n          newTop = top;\r\n        }\r\n        // horizontal limit\r\n        if (widthDiff > 0) {\r\n\r\n          if ((relativeX + left) > -δ) {\r\n            newLeft = -δ;\r\n          } else if ((relativeX + left) < -widthDiff - δ) {\r\n            newLeft = -widthDiff - δ;\r\n          }\r\n\r\n        } else {\r\n          newLeft = left;\r\n        }\r\n\r\n        $(image).css({\r\n          left: newLeft + 'px',\r\n          top: newTop + 'px'\r\n        });\r\n\r\n        // Update image initial data\r\n        $.extend(this.imageData, {\r\n          left: newLeft,\r\n          top: newTop\r\n        });\r\n\r\n      }\r\n\r\n    };\r\n\r\n    let dragEnd = () => {\r\n\r\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\r\n        .off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\r\n\r\n      isDragging = false;\r\n      PUBLIC_VARS['isMoving'] = false;\r\n\r\n      // Remove grabbing cursor\r\n      $(ELEMS_WITH_GRABBING_CURSOR).removeClass('is-grabbing');\r\n\r\n    };\r\n\r\n    $(stage).on(TOUCH_START_EVENT + EVENT_NS, dragStart);\r\n\r\n  }\r\n\r\n}\r\n","import {\r\n  $D,\r\n  TOUCH_START_EVENT,\r\n  TOUCH_MOVE_EVENT,\r\n  TOUCH_END_EVENT,\r\n  NS,\r\n  EVENT_NS,\r\n  PUBLIC_VARS\r\n} from './constants';\r\n\r\nimport {\r\n  setGrabCursor\r\n} from './utilities';\r\n\r\nconst ELEMS_WITH_RESIZE_CURSOR = `html,body,.${NS}-modal,.${NS}-stage,.${NS}-button`;\r\n\r\nexport default {\r\n\r\n  /**\r\n   * ------------------------------\r\n   * 1.modal resizable\r\n   * 2.keep image in stage center\r\n   * 3.other image limitations\r\n   * ------------------------------\r\n   *\r\n   * [resizable]\r\n   * @param  {[Object]} modal       [the modal element]\r\n   * @param  {[Object]} stage       [the stage element]\r\n   * @param  {[Object]} image       [the image element]\r\n   * @param  {[Number]} minWidth    [the option of modalWidth]\r\n   * @param  {[Number]} minHeight   [the option of modalHeight]\r\n   */\r\n  resizable(modal, stage, image, minWidth, minHeight) {\r\n\r\n    let resizableHandleE = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-e\"></div>`),\r\n      resizableHandleW = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-w\"></div>`),\r\n      resizableHandleS = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-s\"></div>`),\r\n      resizableHandleN = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-n\"></div>`),\r\n      resizableHandleSE = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-se\"></div>`),\r\n      resizableHandleSW = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-sw\"></div>`),\r\n      resizableHandleNE = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-ne\"></div>`),\r\n      resizableHandleNW = $(`<div class=\"${NS}-resizable-handle ${NS}-resizable-handle-nw\"></div>`);\r\n\r\n    let resizableHandles = {\r\n      'e': resizableHandleE,\r\n      's': resizableHandleS,\r\n      'se': resizableHandleSE,\r\n      'n': resizableHandleN,\r\n      'w': resizableHandleW,\r\n      'nw': resizableHandleNW,\r\n      'ne': resizableHandleNE,\r\n      'sw': resizableHandleSW\r\n    };\r\n\r\n    $(modal).append(\r\n      resizableHandleE, resizableHandleW, resizableHandleS, resizableHandleN,\r\n      resizableHandleSE, resizableHandleSW, resizableHandleNE, resizableHandleNW\r\n    );\r\n\r\n    let isDragging = false;\r\n\r\n    let startX = 0,\r\n      startY = 0,\r\n\r\n      modalData = {\r\n        w: 0,\r\n        h: 0,\r\n        l: 0,\r\n        t: 0\r\n      },\r\n      stageData = {\r\n        w: 0,\r\n        h: 0,\r\n        l: 0,\r\n        t: 0\r\n      },\r\n      imageData = {\r\n        w: 0,\r\n        h: 0,\r\n        l: 0,\r\n        t: 0\r\n      },\r\n\r\n      // δ is the difference between image width and height\r\n      δ = 0,\r\n      imgWidth = 0,\r\n      imgHeight = 0,\r\n\r\n      direction = '';\r\n\r\n    // modal CSS options\r\n    let getModalOpts = function (dir, offsetX, offsetY) {\r\n\r\n      // Modal should not move when its width to the minwidth\r\n      let modalLeft = (-offsetX + modalData.w) > minWidth\r\n        ? (offsetX + modalData.l)\r\n        : (modalData.l + modalData.w - minWidth),\r\n        modalTop = (-offsetY + modalData.h) > minHeight\r\n          ? (offsetY + modalData.t)\r\n          : (modalData.t + modalData.h - minHeight);\r\n\r\n      let opts = {\r\n        'e': {\r\n          width: Math.max((offsetX + modalData.w), minWidth) + 'px'\r\n        },\r\n        's': {\r\n          height: Math.max((offsetY + modalData.h), minHeight) + 'px'\r\n        },\r\n        'se': {\r\n          width: Math.max((offsetX + modalData.w), minWidth) + 'px',\r\n          height: Math.max((offsetY + modalData.h), minHeight) + 'px'\r\n        },\r\n        'w': {\r\n          width: Math.max((-offsetX + modalData.w), minWidth) + 'px',\r\n          left: modalLeft + 'px'\r\n        },\r\n        'n': {\r\n          height: Math.max((-offsetY + modalData.h), minHeight) + 'px',\r\n          top: modalTop + 'px'\r\n        },\r\n        'nw': {\r\n          width: Math.max((-offsetX + modalData.w), minWidth) + 'px',\r\n          height: Math.max((-offsetY + modalData.h), minHeight) + 'px',\r\n          top: modalTop + 'px',\r\n          left: modalLeft + 'px'\r\n        },\r\n        'ne': {\r\n          width: Math.max((offsetX + modalData.w), minWidth) + 'px',\r\n          height: Math.max((-offsetY + modalData.h), minHeight) + 'px',\r\n          top: modalTop + 'px'\r\n        },\r\n        'sw': {\r\n          width: Math.max((-offsetX + modalData.w), minWidth) + 'px',\r\n          height: Math.max((offsetY + modalData.h), minHeight) + 'px',\r\n          left: modalLeft + 'px'\r\n        }\r\n      };\r\n\r\n      return opts[dir];\r\n    };\r\n\r\n    // image CSS options\r\n    let getImageOpts = function (dir, offsetX, offsetY) {\r\n\r\n      // Image should not move when modal width to the min width\r\n      // The minwidth is modal width, so we should clac the stage minwidth\r\n      let widthDiff = (offsetX + modalData.w) > minWidth\r\n        ? (stageData.w - imgWidth + offsetX - δ)\r\n        : (minWidth - (modalData.w - stageData.w) - imgWidth - δ),\r\n        heightDiff = (offsetY + modalData.h) > minHeight\r\n          ? (stageData.h - imgHeight + offsetY + δ)\r\n          : (minHeight - (modalData.h - stageData.h) - imgHeight + δ),\r\n\r\n        widthDiff2 = (-offsetX + modalData.w) > minWidth\r\n          ? (stageData.w - imgWidth - offsetX - δ)\r\n          : (minWidth - (modalData.w - stageData.w) - imgWidth - δ),\r\n        heightDiff2 = (-offsetY + modalData.h) > minHeight\r\n          ? (stageData.h - imgHeight - offsetY + δ)\r\n          : (minHeight - (modalData.h - stageData.h) - imgHeight + δ);\r\n\r\n      // Get image position in dragging\r\n      let imgLeft = (widthDiff > 0\r\n        ? $(image).position().left\r\n        : ($(image).position().left < 0\r\n          ? $(image).position().left\r\n          : 0)) - δ,\r\n        imgTop = (heightDiff > 0\r\n          ? $(image).position().top\r\n          : ($(image).position().top < 0\r\n            ? $(image).position().top\r\n            : 0)) + δ,\r\n\r\n        imgLeft2 = (widthDiff2 > 0\r\n          ? $(image).position().left\r\n          : ($(image).position().left < 0\r\n            ? $(image).position().left\r\n            : 0)) - δ,\r\n        imgTop2 = (heightDiff2 > 0\r\n          ? $(image).position().top\r\n          : ($(image).position().top < 0\r\n            ? $(image).position().top\r\n            : 0)) + δ;\r\n\r\n      let opts = {\r\n        'e': {\r\n          left: widthDiff >= -δ\r\n            ? ((widthDiff - δ) / 2 + 'px')\r\n            : (imgLeft > widthDiff\r\n              ? (imgLeft + 'px')\r\n              : (widthDiff + 'px'))\r\n        },\r\n        's': {\r\n          top: heightDiff >= δ\r\n            ? ((heightDiff + δ) / 2 + 'px')\r\n            : (imgTop > heightDiff\r\n              ? (imgTop + 'px')\r\n              : (heightDiff + 'px'))\r\n        },\r\n        'se': {\r\n          top: heightDiff >= δ\r\n            ? ((heightDiff + δ) / 2 + 'px')\r\n            : (imgTop > heightDiff\r\n              ? (imgTop + 'px')\r\n              : (heightDiff + 'px')),\r\n          left: widthDiff >= -δ\r\n            ? ((widthDiff - δ) / 2 + 'px')\r\n            : (imgLeft > widthDiff\r\n              ? (imgLeft + 'px')\r\n              : (widthDiff + 'px'))\r\n        },\r\n        'w': {\r\n          left: widthDiff2 >= -δ\r\n            ? ((widthDiff2 - δ) / 2 + 'px')\r\n            : (imgLeft2 > widthDiff2\r\n              ? (imgLeft2 + 'px')\r\n              : (widthDiff2 + 'px'))\r\n        },\r\n        'n': {\r\n          top: heightDiff2 >= δ\r\n            ? ((heightDiff2 + δ) / 2 + 'px')\r\n            : (imgTop2 > heightDiff2\r\n              ? (imgTop2 + 'px')\r\n              : (heightDiff2 + 'px'))\r\n        },\r\n        'nw': {\r\n          top: heightDiff2 >= δ\r\n            ? ((heightDiff2 + δ) / 2 + 'px')\r\n            : (imgTop2 > heightDiff2\r\n              ? (imgTop2 + 'px')\r\n              : (heightDiff2 + 'px')),\r\n          left: widthDiff2 >= -δ\r\n            ? ((widthDiff2 - δ) / 2 + 'px')\r\n            : (imgLeft2 > widthDiff2\r\n              ? (imgLeft2 + 'px')\r\n              : (widthDiff2 + 'px'))\r\n        },\r\n        'ne': {\r\n          top: heightDiff2 >= δ\r\n            ? ((heightDiff2 + δ) / 2 + 'px')\r\n            : (imgTop2 > heightDiff2\r\n              ? (imgTop2 + 'px')\r\n              : (heightDiff2 + 'px')),\r\n          left: widthDiff >= -δ\r\n            ? ((widthDiff - δ) / 2 + 'px')\r\n            : (imgLeft > widthDiff\r\n              ? (imgLeft + 'px')\r\n              : (widthDiff + 'px'))\r\n        },\r\n        'sw': {\r\n          top: heightDiff >= δ\r\n            ? ((heightDiff + δ) / 2 + 'px')\r\n            : (imgTop > heightDiff\r\n              ? (imgTop + 'px')\r\n              : (heightDiff + 'px')),\r\n          left: widthDiff2 >= -δ\r\n            ? ((widthDiff2 - δ) / 2 + 'px')\r\n            : (imgLeft2 > widthDiff2\r\n              ? (imgLeft2 + 'px')\r\n              : (widthDiff2 + 'px'))\r\n        }\r\n      };\r\n\r\n      return opts[dir];\r\n    };\r\n\r\n    let dragStart = (dir, e) => {\r\n\r\n      e = e || window.event;\r\n\r\n      e.preventDefault();\r\n\r\n      isDragging = true;\r\n      PUBLIC_VARS['isResizing'] = true;\r\n\r\n      startX = e.type === 'touchstart'\r\n        ? e.originalEvent.targetTouches[0].pageX\r\n        : e.clientX;\r\n      startY = e.type === 'touchstart'\r\n        ? e.originalEvent.targetTouches[0].pageY\r\n        : e.clientY;\r\n\r\n      // Reclac the modal data when mousedown\r\n      modalData = {\r\n        w: $(modal).width(),\r\n        h: $(modal).height(),\r\n        l: $(modal).offset().left,\r\n        t: $(modal).offset().top\r\n      };\r\n\r\n      stageData = {\r\n        w: $(stage).width(),\r\n        h: $(stage).height(),\r\n        l: $(stage).offset().left,\r\n        t: $(stage).offset().top\r\n      };\r\n\r\n      imageData = {\r\n        w: $(image).width(),\r\n        h: $(image).height(),\r\n        l: $(image).position().left,\r\n        t: $(image).position().top\r\n      };\r\n\r\n      // δ is the difference between image width and height\r\n      δ = !this.isRotated\r\n        ? 0\r\n        : (imageData.w - imageData.h) / 2;\r\n      imgWidth = !this.isRotated\r\n        ? imageData.w\r\n        : imageData.h;\r\n      imgHeight = !this.isRotated\r\n        ? imageData.h\r\n        : imageData.w;\r\n\r\n      direction = dir;\r\n\r\n      // Add resizable cursor\r\n      $(ELEMS_WITH_RESIZE_CURSOR).css('cursor', dir + '-resize');\r\n\r\n      $D.on(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\r\n        .on(TOUCH_END_EVENT + EVENT_NS, dragEnd);\r\n\r\n    };\r\n\r\n    let dragMove = (e) => {\r\n\r\n      e = e || window.event;\r\n\r\n      e.preventDefault();\r\n\r\n      if (isDragging && !this.isMaximized) {\r\n\r\n        let endX = e.type === 'touchmove'\r\n          ? e.originalEvent.targetTouches[0].pageX\r\n          : e.clientX,\r\n          endY = e.type === 'touchmove'\r\n            ? e.originalEvent.targetTouches[0].pageY\r\n            : e.clientY,\r\n\r\n          relativeX = endX - startX,\r\n          relativeY = endY - startY;\r\n\r\n        let modalOpts = getModalOpts(direction, relativeX, relativeY);\r\n\r\n        $(modal).css(modalOpts);\r\n\r\n        let imageOpts = getImageOpts(direction, relativeX, relativeY);\r\n\r\n        $(image).css(imageOpts);\r\n\r\n        this.isDoResize = true;\r\n\r\n      }\r\n\r\n    };\r\n\r\n    let dragEnd = () => {\r\n\r\n      $D.off(TOUCH_MOVE_EVENT + EVENT_NS, dragMove)\r\n        .off(TOUCH_END_EVENT + EVENT_NS, dragEnd);\r\n\r\n      // Set grab cursor\r\n      if (PUBLIC_VARS['isResizing']) {\r\n        setGrabCursor(\r\n          {\r\n            w: imgWidth,\r\n            h: imgHeight\r\n          },\r\n          {\r\n            w: $(stage).width(),\r\n            h: $(stage).height()\r\n          },\r\n          stage\r\n        );\r\n      }\r\n\r\n      isDragging = false;\r\n      PUBLIC_VARS['isResizing'] = false;\r\n\r\n      // Remove resizable cursor\r\n      $(ELEMS_WITH_RESIZE_CURSOR).css('cursor', '');\r\n\r\n      // Update image initial data\r\n      let scale = this.getImageScaleToStage(\r\n        $(stage).width(),\r\n        $(stage).height()\r\n      );\r\n\r\n      $.extend(this.imageData, {\r\n        initWidth: this.img.width * scale,\r\n        initHeight: this.img.height * scale,\r\n        initLeft: ($(stage).width() - this.img.width * scale) / 2,\r\n        initTop: ($(stage).height() - this.img.height * scale) / 2\r\n      });\r\n\r\n    };\r\n\r\n    $.each(resizableHandles, function (dir, handle) {\r\n      handle.on(TOUCH_START_EVENT + EVENT_NS, function (e) {\r\n        dragStart(dir, e);\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n}\r\n","import $ from 'jquery';\r\n\r\nimport DEFAULTS from './defaults';\r\n\r\nimport {\r\n  $W,\r\n  $D,\r\n  CLICK_EVENT,\r\n  RESIZE_EVENT,\r\n  KEYDOWN_EVENT,\r\n  WHEEL_EVENT,\r\n  NS,\r\n  CLASS_NS,\r\n  EVENT_NS,\r\n  PUBLIC_VARS\r\n} from './constants';\r\n\r\nimport {\r\n  getImgSrc,\r\n  throttle,\r\n  preloadImg,\r\n  requestFullscreen,\r\n  getImageNameFromUrl,\r\n  getNumFromCSSValue,\r\n  hasScrollbar,\r\n  getScrollbarWidth,\r\n  setGrabCursor\r\n} from './utilities';\r\n\r\nimport draggable from './draggable';\r\nimport movable from './movable';\r\nimport resizable from './resizable';\r\n\r\n/**\r\n * PhotoViewer Class\r\n */\r\nclass PhotoViewer {\r\n\r\n  constructor(items, options, el) {\r\n\r\n    this.options = $.extend(true, {}, DEFAULTS, options);\r\n\r\n    if (options && $.isArray(options.footToolbar)) {\r\n      this.options.footToolbar = options.footToolbar;\r\n    }\r\n\r\n    if (options && $.isArray(options.headToolbar)) {\r\n      this.options.headToolbar = options.headToolbar;\r\n    }\r\n\r\n    // Store element of clicked\r\n    this.$el = $(el);\r\n\r\n    // As we have multiple instances,\r\n    // so every instance has following variables.\r\n\r\n    // modal open flag\r\n    this.isOpened = false;\r\n    // modal maximize flag\r\n    this.isMaximized = false;\r\n    // image rotate 90*(2n+1) flag\r\n    this.isRotated = false;\r\n    // image rotate angle\r\n    this.rotateAngle = 0;\r\n\r\n    // if modal do resize\r\n    this.isDoResize = false;\r\n\r\n    // Store image data in every instance\r\n    this.imageData = {};\r\n    // Store modal data in every instance\r\n    this.modalData = {\r\n      width: null,\r\n      height: null,\r\n      left: null,\r\n      top: null\r\n    };\r\n\r\n    this.init(items, this.options, el);\r\n\r\n  }\r\n\r\n  init(items, opts, el) {\r\n\r\n    this.groupData = items;\r\n    this.groupIndex = opts['index'];\r\n\r\n    // Get image src\r\n    let imgSrc = items[this.groupIndex]['src'];\r\n\r\n    this.open();\r\n\r\n    this.loadImg(imgSrc);\r\n\r\n    // draggable & movable & resizable\r\n    if (opts.draggable) {\r\n      this.draggable(this.$photoviewer, this.dragHandle, CLASS_NS + '-button');\r\n    }\r\n    if (opts.movable) {\r\n      this.movable(this.$stage, this.$image);\r\n    }\r\n    if (opts.resizable) {\r\n      this.resizable(\r\n        this.$photoviewer,\r\n        this.$stage,\r\n        this.$image,\r\n        opts.modalWidth,\r\n        opts.modalHeight\r\n      );\r\n    }\r\n\r\n  }\r\n\r\n  _creatBtns(toolbar, btns) {\r\n\r\n    let btnsStr = '';\r\n\r\n    $.each(toolbar, function (index, item) {\r\n      btnsStr += btns[item];\r\n    });\r\n\r\n    return btnsStr;\r\n\r\n  }\r\n\r\n  _creatTitle() {\r\n    return (this.options.title ? `<div class=\"${NS}-title\"></div>` : '');\r\n  }\r\n\r\n  _creatDOM() {\r\n\r\n    let btnsTpl = {\r\n      minimize: `<button class=\"${NS}-button ${NS}-button-minimize\"\r\n                  title=\"${this.options.i18n.minimize}\">\r\n                    ${this.options.icons.minimize}\r\n                  </button>`,\r\n      maximize: `<button class=\"${NS}-button ${NS}-button-maximize\"\r\n                  title=\"${this.options.i18n.maximize}\">\r\n                    ${this.options.icons.maximize}\r\n                  </button>`,\r\n      close: `<button class=\"${NS}-button ${NS}-button-close\"\r\n              title=\"${this.options.i18n.close}\">\r\n                ${this.options.icons.close}\r\n              </button>`,\r\n      zoomIn: `<button class=\"${NS}-button ${NS}-button-zoom-in\"\r\n                title=\"${this.options.i18n.zoomIn}\">\r\n                  ${this.options.icons.zoomIn}\r\n                </button>`,\r\n      zoomOut: `<button class=\"${NS}-button ${NS}-button-zoom-out\"\r\n                title=\"${this.options.i18n.zoomOut}\">\r\n                  ${this.options.icons.zoomOut}\r\n                </button>`,\r\n      prev: `<button class=\"${NS}-button ${NS}-button-prev\"\r\n              title=\"${this.options.i18n.prev}\">\r\n                ${this.options.icons.prev}\r\n              </button>`,\r\n      next: `<button class=\"${NS}-button ${NS}-button-next\"\r\n              title=\"${this.options.i18n.next}\">\r\n                ${this.options.icons.next}\r\n              </button>`,\r\n      fullscreen: `<button class=\"${NS}-button ${NS}-button-fullscreen\"\r\n                    title=\"${this.options.i18n.fullscreen}\">\r\n                    ${this.options.icons.fullscreen}\r\n                  </button>`,\r\n      actualSize: `<button class=\"${NS}-button ${NS}-button-actual-size\"\r\n                    title=\"${this.options.i18n.actualSize}\">\r\n                      ${this.options.icons.actualSize}\r\n                    </button>`,\r\n      rotateLeft: `<button class=\"${NS}-button ${NS}-button-rotate-left\"\r\n                    title=\"${this.options.i18n.rotateLeft}\">\r\n                      ${this.options.icons.rotateLeft}\r\n                    </button>`,\r\n      rotateRight: `<button class=\"${NS}-button ${NS}-button-rotate-right\"\r\n                      title=\"${this.options.i18n.rotateRight}\">\r\n                      ${this.options.icons.rotateRight}\r\n                    </button>`\r\n    };\r\n\r\n    // photoviewer base HTML\r\n    let photoviewerHTML =\r\n      `<div class=\"${NS}-modal\">\r\n        <div class=\"${NS}-inner\">\r\n          <div class=\"${NS}-header\">\r\n            <div class=\"${NS}-toolbar ${NS}-toolbar-head\">\r\n              ${this._creatBtns(this.options.headToolbar, btnsTpl)}\r\n            </div>\r\n            ${this._creatTitle()}\r\n          </div>\r\n          <div class=\"${NS}-stage\">\r\n            <img class=\"${NS}-image\" src=\"\" alt=\"\" />\r\n          </div>\r\n          <div class=\"${NS}-footer\">\r\n            <div class=\"${NS}-toolbar ${NS}-toolbar-foot\">\r\n              ${this._creatBtns(this.options.footToolbar, btnsTpl)}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>`;\r\n\r\n    return photoviewerHTML;\r\n\r\n  }\r\n\r\n  build() {\r\n\r\n    // Create photoviewer HTML string\r\n    let photoviewerHTML = this._creatDOM();\r\n\r\n    // Make photoviewer HTML string to jQuery element\r\n    let $photoviewer = $(photoviewerHTML);\r\n\r\n    // Get all photoviewer element\r\n    this.$photoviewer = $photoviewer;\r\n    this.$header = $photoviewer.find(CLASS_NS + '-header');\r\n    this.$headToolbar = $photoviewer.find(CLASS_NS + '-toolbar-head');\r\n    this.$footer = $photoviewer.find(CLASS_NS + '-footer');\r\n    this.$footToolbar = $photoviewer.find(CLASS_NS + '-toolbar-foot');\r\n    this.$stage = $photoviewer.find(CLASS_NS + '-stage');\r\n    this.$title = $photoviewer.find(CLASS_NS + '-title');\r\n    this.$image = $photoviewer.find(CLASS_NS + '-image');\r\n    this.$close = $photoviewer.find(CLASS_NS + '-button-close');\r\n    this.$maximize = $photoviewer.find(CLASS_NS + '-button-maximize');\r\n    this.$minimize = $photoviewer.find(CLASS_NS + '-button-minimize');\r\n    this.$zoomIn = $photoviewer.find(CLASS_NS + '-button-zoom-in');\r\n    this.$zoomOut = $photoviewer.find(CLASS_NS + '-button-zoom-out');\r\n    this.$actualSize = $photoviewer.find(CLASS_NS + '-button-actual-size');\r\n    this.$fullscreen = $photoviewer.find(CLASS_NS + '-button-fullscreen');\r\n    this.$rotateLeft = $photoviewer.find(CLASS_NS + '-button-rotate-left');\r\n    this.$rotateRight = $photoviewer.find(CLASS_NS + '-button-rotate-right');\r\n    this.$prev = $photoviewer.find(CLASS_NS + '-button-prev');\r\n    this.$next = $photoviewer.find(CLASS_NS + '-button-next');\r\n\r\n    // Add class before image loaded\r\n    this.$stage.addClass('stage-ready');\r\n    this.$image.addClass('image-ready');\r\n\r\n    // Reset modal z-index with multiple instances\r\n    this.$photoviewer.css('z-index', PUBLIC_VARS['zIndex']);\r\n\r\n    // Set handle element of draggable\r\n    if (!this.options.dragHandle || this.options.dragHandle === CLASS_NS + '-modal') {\r\n      this.dragHandle = this.$photoviewer;\r\n    } else {\r\n      this.dragHandle = this.$photoviewer.find(this.options.dragHandle);\r\n    }\r\n\r\n  }\r\n\r\n  open() {\r\n\r\n    if (!this.options.multiInstances) {\r\n      $(CLASS_NS + '-modal').eq(0).remove();\r\n    }\r\n\r\n    // Fixed modal position bug\r\n    if (!$(CLASS_NS + '-modal').length && this.options.fixedContent) {\r\n\r\n      $('html').css({ 'overflow': 'hidden' });\r\n\r\n      if (hasScrollbar()) {\r\n        let scrollbarWidth = getScrollbarWidth();\r\n        if (scrollbarWidth) {\r\n          $('html').css({ 'padding-right': scrollbarWidth });\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.build();\r\n\r\n    this._triggerHook('beforeOpen', this.$el);\r\n\r\n    // Add PhotoViewer to DOM\r\n    $('body').append(this.$photoviewer);\r\n\r\n    this.addEvents();\r\n\r\n    this.setModalPos(this.$photoviewer);\r\n\r\n    this._triggerHook('opened', this.$el);\r\n\r\n  }\r\n\r\n  close() {\r\n\r\n    this._triggerHook('beforeClose', this.$el);\r\n\r\n    // Remove instance\r\n    this.$photoviewer.remove();\r\n\r\n    this.isOpened = false;\r\n    this.isMaximized = false;\r\n    this.isRotated = false;\r\n    this.rotateAngle = 0;\r\n\r\n    let zeroModal = !$(CLASS_NS + '-modal').length;\r\n\r\n    // Fixed modal position bug\r\n    if (zeroModal && this.options.fixedContent) {\r\n      $('html').css({ 'overflow': '', 'padding-right': '' });\r\n    }\r\n\r\n    // Reset zIndex after close\r\n    if (zeroModal && this.options.multiInstances) {\r\n      PUBLIC_VARS['zIndex'] = this.options.zIndex;\r\n    }\r\n\r\n    // off events\r\n    if (!$(CLASS_NS + '-modal').length) {\r\n      $D.off(KEYDOWN_EVENT + EVENT_NS);\r\n      $W.off(RESIZE_EVENT + EVENT_NS);\r\n    }\r\n\r\n    this._triggerHook('closed', this.$el);\r\n\r\n  }\r\n\r\n  setModalPos(modal) {\r\n\r\n    let winWidth = $W.width(),\r\n      winHeight = $W.height(),\r\n      scrollLeft = $D.scrollLeft(),\r\n      scrollTop = $D.scrollTop();\r\n\r\n    let modalWidth = this.options.modalWidth,\r\n      modalHeight = this.options.modalHeight;\r\n\r\n    // Set modal maximized when init\r\n    if (this.options.initMaximized) {\r\n\r\n      modal.addClass(NS + '-maximize');\r\n\r\n      modal.css({\r\n        width: '100%',\r\n        height: '100%',\r\n        left: 0,\r\n        top: 0\r\n      });\r\n\r\n      this.isOpened = true;\r\n      this.isMaximized = true;\r\n\r\n    } else {\r\n\r\n      // Make the modal in windows center\r\n      modal.css({\r\n        width: modalWidth,\r\n        height: modalHeight,\r\n        left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\r\n        top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\r\n      });\r\n\r\n    }\r\n\r\n  }\r\n\r\n  setModalSize(img) {\r\n\r\n    let winWidth = $W.width(),\r\n      winHeight = $W.height(),\r\n      scrollLeft = $D.scrollLeft(),\r\n      scrollTop = $D.scrollTop();\r\n\r\n    // stage css value\r\n    let stageCSS = {\r\n      left: this.$stage.css('left'),\r\n      right: this.$stage.css('right'),\r\n      top: this.$stage.css('top'),\r\n      bottom: this.$stage.css('bottom'),\r\n      borderLeft: this.$stage.css('border-left-width'),\r\n      borderRight: this.$stage.css('border-right-width'),\r\n      borderTop: this.$stage.css('border-top-width'),\r\n      borderBottom: this.$stage.css('border-bottom-width')\r\n    };\r\n\r\n    // Modal size should calc with stage css value\r\n    let modalWidth = img.width +\r\n      getNumFromCSSValue(stageCSS.left) +\r\n      getNumFromCSSValue(stageCSS.right) +\r\n      getNumFromCSSValue(stageCSS.borderLeft) +\r\n      getNumFromCSSValue(stageCSS.borderRight),\r\n      modalHeight = img.height +\r\n        getNumFromCSSValue(stageCSS.top) +\r\n        getNumFromCSSValue(stageCSS.bottom) +\r\n        getNumFromCSSValue(stageCSS.borderTop) +\r\n        getNumFromCSSValue(stageCSS.borderBottom);\r\n\r\n    let gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1,\r\n      // modal scale to window\r\n      scale = Math.min(\r\n        winWidth / (modalWidth * gapThreshold),\r\n        winHeight / (modalHeight * gapThreshold),\r\n        1\r\n      );\r\n\r\n    let minWidth = Math.max(modalWidth * scale, this.options.modalWidth),\r\n      minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\r\n\r\n    minWidth = this.options.fixedModalSize\r\n      ? this.options.modalWidth\r\n      : Math.round(minWidth);\r\n    minHeight = this.options.fixedModalSize\r\n      ? this.options.modalHeight\r\n      : Math.round(minHeight);\r\n\r\n    let modalCSSObj = {\r\n      width: minWidth + 'px',\r\n      height: minHeight + 'px',\r\n      left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\r\n      top: (winHeight - minHeight) / 2 + scrollTop + 'px'\r\n    };\r\n\r\n    // Add modal init animation\r\n    if (this.options.initAnimation) {\r\n      this.$photoviewer.animate(modalCSSObj, () => {\r\n        this.setImageSize(img);\r\n      });\r\n    } else {\r\n      this.$photoviewer.css(modalCSSObj);\r\n      this.setImageSize(img);\r\n    }\r\n\r\n    this.isOpened = true;\r\n\r\n  }\r\n\r\n  getImageScaleToStage(stageWidth, stageHeight) {\r\n\r\n    var scale = 1;\r\n\r\n    if (!this.isRotated) {\r\n      scale = Math.min(stageWidth / this.img.width, stageHeight / this.img.height, 1);\r\n    } else {\r\n      scale = Math.min(stageWidth / this.img.height, stageHeight / this.img.width, 1);\r\n    }\r\n\r\n    return scale;\r\n  }\r\n\r\n  setImageSize(img) {\r\n\r\n    let stageData = {\r\n      w: this.$stage.width(),\r\n      h: this.$stage.height()\r\n    };\r\n\r\n    let scale = this.getImageScaleToStage(\r\n      stageData.w,\r\n      stageData.h\r\n    );\r\n\r\n    this.$image.css({\r\n      width: Math.ceil(img.width * scale) + 'px',\r\n      height: Math.ceil(img.height * scale) + 'px',\r\n      left: (stageData.w - Math.ceil(img.width * scale)) / 2 + 'px',\r\n      top: (stageData.h - Math.ceil(img.height * scale)) / 2 + 'px'\r\n    });\r\n\r\n    // Store image initial data\r\n    $.extend(this.imageData, {\r\n      initWidth: img.width * scale,\r\n      initHeight: img.height * scale,\r\n      initLeft: (stageData.w - img.width * scale) / 2,\r\n      initTop: (stageData.h - img.height * scale) / 2,\r\n      width: img.width * scale,\r\n      height: img.height * scale,\r\n      left: (stageData.w - img.width * scale) / 2,\r\n      top: (stageData.h - img.height * scale) / 2\r\n    });\r\n\r\n    // Set grab cursor\r\n    setGrabCursor(\r\n      {\r\n        w: this.$image.width(),\r\n        h: this.$image.height()\r\n      },\r\n      {\r\n        w: this.$stage.width(),\r\n        h: this.$stage.height()\r\n      },\r\n      this.$stage,\r\n      this.isRotated\r\n    );\r\n\r\n    this.$stage.removeClass('stage-ready');\r\n    this.$image.removeClass('image-ready');\r\n\r\n    // loader end\r\n    this.$photoviewer.find(CLASS_NS + '-loader').remove();\r\n\r\n    // Add image init animation\r\n    if (this.options.initAnimation && !this.options.progressiveLoading) {\r\n      this.$image.fadeIn();\r\n    }\r\n\r\n  }\r\n\r\n  loadImg(imgSrc, fn, err) {\r\n\r\n    let loaderHTML = `<div class=\"${NS}-loader\"></div>`;\r\n\r\n    // loader start\r\n    this.$photoviewer.append(loaderHTML);\r\n\r\n    // Add class before image loaded\r\n    this.$stage.addClass('stage-ready');\r\n    this.$image.addClass('image-ready');\r\n\r\n    // Reset image\r\n    this.$image.removeAttr('style').attr('src', '');\r\n    this.isRotated = false;\r\n    this.rotateAngle = 0;\r\n\r\n    if (this.options.initAnimation && !this.options.progressiveLoading) {\r\n      this.$image.hide();\r\n    }\r\n\r\n    this.$image.attr('src', imgSrc);\r\n\r\n    preloadImg(imgSrc, (img) => {\r\n      // Store HTMLImageElement\r\n      this.img = img;\r\n\r\n      // Store original data\r\n      this.imageData = {\r\n        originalWidth: img.width,\r\n        originalHeight: img.height\r\n      };\r\n\r\n      if (this.isMaximized || (this.isOpened && this.options.fixedModalPos)) {\r\n        this.setImageSize(img);\r\n      } else {\r\n        this.setModalSize(img);\r\n      }\r\n\r\n      // callback of image loaded successfully\r\n      if (fn) {\r\n        fn.call();\r\n      }\r\n\r\n    }, () => {\r\n      // loader end\r\n      this.$photoviewer.find(CLASS_NS + '-loader').remove();\r\n\r\n      // callback of image loading failed\r\n      if (err) {\r\n        err.call();\r\n      }\r\n    });\r\n\r\n    if (this.options.title) {\r\n      this.setImgTitle(imgSrc);\r\n    }\r\n\r\n  }\r\n\r\n  setImgTitle(url) {\r\n\r\n    let title = this.groupData[this.groupIndex].title\r\n      ? this.groupData[this.groupIndex].title\r\n      : getImageNameFromUrl(url);\r\n\r\n    this.$title.html(title);\r\n\r\n  }\r\n\r\n  jump(step) {\r\n\r\n    this._triggerHook('beforeChange', this.groupIndex);\r\n\r\n    this.groupIndex = this.groupIndex + step;\r\n\r\n    this.jumpTo(this.groupIndex);\r\n\r\n  }\r\n\r\n  jumpTo(index) {\r\n\r\n    index = index % this.groupData.length;\r\n\r\n    if (index >= 0) {\r\n      index = index % this.groupData.length;\r\n    } else if (index < 0) {\r\n      index = (this.groupData.length + index) % this.groupData.length;\r\n    }\r\n\r\n    this.groupIndex = index;\r\n\r\n    this.loadImg(this.groupData[index].src, () => {\r\n      this._triggerHook('changed', index);\r\n    }, () => {\r\n      this._triggerHook('changed', index);\r\n    });\r\n\r\n  }\r\n\r\n  wheel(e) {\r\n\r\n    e.preventDefault();\r\n\r\n    let delta = 1;\r\n\r\n    if (e.originalEvent.deltaY) {\r\n      delta = e.originalEvent.deltaY > 0 ? 1 : -1;\r\n    } else if (e.originalEvent.wheelDelta) {\r\n      delta = -e.originalEvent.wheelDelta / 120;\r\n    } else if (e.originalEvent.detail) {\r\n      delta = e.originalEvent.detail > 0 ? 1 : -1;\r\n    }\r\n\r\n    // ratio threshold\r\n    let ratio = -delta * this.options.ratioThreshold;\r\n\r\n    // mouse point position relative to stage\r\n    let pointer = {\r\n      x: e.originalEvent.clientX - this.$stage.offset().left + $D.scrollLeft(),\r\n      y: e.originalEvent.clientY - this.$stage.offset().top + $D.scrollTop()\r\n    };\r\n\r\n    this.zoom(ratio, pointer, e);\r\n\r\n  }\r\n\r\n  zoom(ratio, origin, e) {\r\n\r\n    // zoom out ratio & zoom in ratio\r\n    ratio = ratio < 0 ? (1 / (1 - ratio)) : (1 + ratio);\r\n\r\n    // image ratio\r\n    ratio = this.$image.width() / this.imageData.originalWidth * ratio;\r\n\r\n    // Fixed digital error\r\n    // if (ratio > 0.95 && ratio < 1.05) {\r\n    //   ratio = 1;\r\n    // }\r\n\r\n    if (ratio > this.options.maxRatio || ratio < this.options.minRatio) {\r\n      return;\r\n    }\r\n\r\n    this.zoomTo(ratio, origin, e);\r\n\r\n  }\r\n\r\n  zoomTo(ratio, origin, e) {\r\n\r\n    let $image = this.$image,\r\n      $stage = this.$stage,\r\n      imgData = {\r\n        w: this.imageData.width,\r\n        h: this.imageData.height,\r\n        x: this.imageData.left,\r\n        y: this.imageData.top\r\n      };\r\n\r\n    // image stage position\r\n    // We will use it to calc the relative position of image\r\n    let stageData = {\r\n      w: $stage.width(),\r\n      h: $stage.height(),\r\n      x: $stage.offset().left,\r\n      y: $stage.offset().top\r\n    };\r\n\r\n    let newWidth = this.imageData.originalWidth * ratio,\r\n      newHeight = this.imageData.originalHeight * ratio,\r\n      // Think about it for a while\r\n      newLeft = origin.x - (origin.x - imgData.x) / imgData.w * newWidth,\r\n      newTop = origin.y - (origin.y - imgData.y) / imgData.h * newHeight;\r\n\r\n    // δ is the difference between image new width and new height\r\n    let δ = !this.isRotated ? 0 : (newWidth - newHeight) / 2,\r\n      imgNewWidth = !this.isRotated ? newWidth : newHeight,\r\n      imgNewHeight = !this.isRotated ? newHeight : newWidth;\r\n\r\n    let offsetX = stageData.w - newWidth,\r\n      offsetY = stageData.h - newHeight;\r\n\r\n    // zoom out & zoom in condition\r\n    // It's important and it takes me a lot of time to get it\r\n    // The conditions with image rotate 90 degree drive me crazy alomst!\r\n    if (imgNewHeight <= stageData.h) {\r\n      newTop = (stageData.h - newHeight) / 2;\r\n    } else {\r\n      newTop = newTop > δ\r\n        ? δ\r\n        : (newTop > (offsetY - δ)\r\n          ? newTop\r\n          : (offsetY - δ));\r\n    }\r\n\r\n    if (imgNewWidth <= stageData.w) {\r\n      newLeft = (stageData.w - newWidth) / 2;\r\n    } else {\r\n      newLeft = newLeft > -δ\r\n        ? -δ\r\n        : (newLeft > (offsetX + δ)\r\n          ? newLeft\r\n          : (offsetX + δ));\r\n    }\r\n\r\n    // if the image scale get to the critical point\r\n    if (Math.abs(this.imageData.initWidth - newWidth) < this.imageData.initWidth * 0.05) {\r\n      this.setImageSize(this.img);\r\n    } else {\r\n      $image.css({\r\n        width: Math.round(newWidth) + 'px',\r\n        height: Math.round(newHeight) + 'px',\r\n        left: Math.round(newLeft) + 'px',\r\n        top: Math.round(newTop) + 'px'\r\n      });\r\n\r\n      // Set grab cursor\r\n      setGrabCursor(\r\n        {\r\n          w: Math.round(imgNewWidth),\r\n          h: Math.round(imgNewHeight)\r\n        },\r\n        {\r\n          w: stageData.w,\r\n          h: stageData.h\r\n        },\r\n        this.$stage\r\n      );\r\n    }\r\n\r\n\r\n    // Update image initial data\r\n    $.extend(this.imageData, {\r\n      width: newWidth,\r\n      height: newHeight,\r\n      left: newLeft,\r\n      top: newTop\r\n    });\r\n\r\n  }\r\n\r\n  rotate(angle) {\r\n\r\n    this.rotateAngle = this.rotateAngle + angle;\r\n\r\n    if ((this.rotateAngle / 90) % 2 === 0) {\r\n      this.isRotated = false;\r\n    } else {\r\n      this.isRotated = true;\r\n    }\r\n\r\n    this.rotateTo(this.rotateAngle);\r\n\r\n  }\r\n\r\n  rotateTo(angle) {\r\n\r\n    this.$image.css({\r\n      transform: 'rotate(' + angle + 'deg)'\r\n    });\r\n\r\n    this.setImageSize({\r\n      width: this.imageData.originalWidth,\r\n      height: this.imageData.originalHeight\r\n    });\r\n\r\n    // Remove grab cursor when rotate\r\n    this.$stage.removeClass('is-grab');\r\n\r\n  }\r\n\r\n  resize() {\r\n\r\n    let resizeHandler = throttle(() => {\r\n\r\n      if (this.isOpened) {\r\n        if (this.isMaximized) {\r\n          this.setImageSize({\r\n            width: this.imageData.originalWidth,\r\n            height: this.imageData.originalHeight\r\n          });\r\n        } else {\r\n          this.setModalSize({\r\n            width: this.imageData.originalWidth,\r\n            height: this.imageData.originalHeight\r\n          });\r\n        }\r\n      }\r\n\r\n    }, 500);\r\n\r\n    return resizeHandler;\r\n\r\n  }\r\n\r\n  maximize() {\r\n\r\n    if (!this.isMaximized) {\r\n      // Store modal data before maximize\r\n      this.modalData = {\r\n        width: this.$photoviewer.width(),\r\n        height: this.$photoviewer.height(),\r\n        left: this.$photoviewer.offset().left,\r\n        top: this.$photoviewer.offset().top\r\n      };\r\n\r\n      this.$photoviewer.addClass(NS + '-maximize');\r\n\r\n      this.$photoviewer.css({\r\n        width: '100%',\r\n        height: '100%',\r\n        left: 0,\r\n        top: 0\r\n      });\r\n\r\n      this.isMaximized = true;\r\n\r\n    } else {\r\n\r\n      this.$photoviewer.removeClass(NS + '-maximize');\r\n\r\n      this.$photoviewer.css({\r\n        width: this.modalData.width\r\n          ? this.modalData.width\r\n          : this.options.modalWidth,\r\n        height: this.modalData.height\r\n          ? this.modalData.height\r\n          : this.options.modalHeight,\r\n        left: this.modalData.left\r\n          ? this.modalData.left\r\n          : ($W.width() - this.options.modalWidth) / 2 + $D.scrollLeft(),\r\n        top: this.modalData.top\r\n          ? this.modalData.top\r\n          : ($W.height() - this.options.modalHeight) / 2 + $D.scrollTop()\r\n      });\r\n\r\n      this.isMaximized = false;\r\n    }\r\n\r\n    this.setImageSize({\r\n      width: this.imageData.originalWidth,\r\n      height: this.imageData.originalHeight\r\n    });\r\n\r\n  }\r\n\r\n  fullscreen() {\r\n\r\n    requestFullscreen(this.$photoviewer[0]);\r\n\r\n  }\r\n\r\n  keydown(e) {\r\n\r\n    if (!this.options.keyboard) {\r\n      return false;\r\n    }\r\n\r\n    let keyCode = e.keyCode || e.which || e.charCode,\r\n      ctrlKey = e.ctrlKey || e.metaKey,\r\n      altKey = e.altKey || e.metaKey;\r\n\r\n    switch (keyCode) {\r\n      // ←\r\n      case 37:\r\n        this.jump(-1);\r\n        break;\r\n      // →\r\n      case 39:\r\n        this.jump(1);\r\n        break;\r\n      // +\r\n      case 187:\r\n        this.zoom(\r\n          this.options.ratioThreshold * 3,\r\n          { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n          e\r\n        );\r\n        break;\r\n      // -\r\n      case 189:\r\n        this.zoom(\r\n          -this.options.ratioThreshold * 3,\r\n          { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n          e\r\n        );\r\n        break;\r\n      // + Firefox\r\n      case 61:\r\n        this.zoom(\r\n          this.options.ratioThreshold * 3,\r\n          { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n          e\r\n        );\r\n        break;\r\n      // - Firefox\r\n      case 173:\r\n        this.zoom(\r\n          -this.options.ratioThreshold * 3,\r\n          { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n          e\r\n        );\r\n        break;\r\n      // ctrl + alt + 0\r\n      case 48:\r\n        if (ctrlKey && altKey) {\r\n          this.zoomTo(\r\n            1,\r\n            { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n            e\r\n          );\r\n        }\r\n        break;\r\n      // ctrl + ,\r\n      case 188:\r\n        if (ctrlKey) {\r\n          this.rotate(-90);\r\n        }\r\n        break;\r\n      // ctrl + .\r\n      case 190:\r\n        if (ctrlKey) {\r\n          this.rotate(90);\r\n        }\r\n        break;\r\n      default:\r\n    }\r\n\r\n  }\r\n\r\n  addEvents() {\r\n\r\n    this.$close.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, (e) => {\r\n      this.close();\r\n    });\r\n\r\n    this.$stage.off(WHEEL_EVENT + EVENT_NS).on(WHEEL_EVENT + EVENT_NS, (e) => {\r\n      this.wheel(e);\r\n    });\r\n\r\n    this.$zoomIn.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, (e) => {\r\n      this.zoom(\r\n        this.options.ratioThreshold * 3,\r\n        { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n        e\r\n      );\r\n    });\r\n\r\n    this.$zoomOut.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, (e) => {\r\n      this.zoom(\r\n        -this.options.ratioThreshold * 3,\r\n        { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n        e\r\n      );\r\n    });\r\n\r\n    this.$actualSize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, (e) => {\r\n      this.zoomTo(\r\n        1,\r\n        { x: this.$stage.width() / 2, y: this.$stage.height() / 2 },\r\n        e\r\n      );\r\n    });\r\n\r\n    this.$prev.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, () => {\r\n      this.jump(-1);\r\n    });\r\n\r\n    this.$fullscreen.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, () => {\r\n      this.fullscreen();\r\n    });\r\n\r\n    this.$next.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, () => {\r\n      this.jump(1);\r\n    });\r\n\r\n    this.$rotateLeft.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, () => {\r\n      this.rotate(-90);\r\n    });\r\n\r\n    this.$rotateRight.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, () => {\r\n      this.rotate(90);\r\n    });\r\n\r\n    this.$maximize.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, () => {\r\n      this.maximize();\r\n    });\r\n\r\n    $D.off(KEYDOWN_EVENT + EVENT_NS).on(KEYDOWN_EVENT + EVENT_NS, (e) => {\r\n      this.keydown(e);\r\n    });\r\n\r\n    $W.on(RESIZE_EVENT + EVENT_NS, this.resize());\r\n\r\n  }\r\n\r\n  _triggerHook(e, data) {\r\n    if (this.options.callbacks[e]) {\r\n      this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\r\n    }\r\n  }\r\n\r\n\r\n}\r\n\r\n/**\r\n * Add methods to PhotoViewer\r\n */\r\n$.extend(PhotoViewer.prototype, draggable, movable, resizable);\r\n\r\n/**\r\n * Add PhotoViewer to globle\r\n */\r\nwindow.PhotoViewer = PhotoViewer;\r\n\r\n/**\r\n * jQuery plugin\r\n */\r\n\r\nlet jqEl = null,\r\n  getImgGroup = function (list, groupName) {\r\n\r\n    let items = [];\r\n\r\n    $(list).each(function () {\r\n\r\n      let src = getImgSrc(this);\r\n\r\n      items.push({\r\n        src: src,\r\n        title: $(this).attr('data-title'),\r\n        groupName: groupName\r\n      });\r\n\r\n    });\r\n\r\n    return items;\r\n\r\n  }\r\n\r\n$.fn.photoviewer = function (options) {\r\n\r\n  jqEl = $(this);\r\n\r\n  options = options ? options : {};\r\n\r\n  // Convert a numeric string into a number\r\n  for (let key in options) {\r\n    if (typeof (options[key]) === 'string' && !isNaN(options[key])) {\r\n      options[key] = parseFloat(options[key])\r\n    }\r\n  }\r\n\r\n  // Get init event, 'click' or 'dblclick'\r\n  let opts = $.extend(true, {}, DEFAULTS, options);\r\n\r\n  // We should get zIndex of options before plugin's init.\r\n  PUBLIC_VARS['zIndex'] = opts.zIndex;\r\n\r\n  if (typeof options === 'string') {\r\n\r\n    // $(this).data('photoviewer')[options]();\r\n\r\n  } else {\r\n\r\n    jqEl.off(CLICK_EVENT + EVENT_NS).on(CLICK_EVENT + EVENT_NS, function (e) {\r\n\r\n      e.preventDefault();\r\n      // This will stop triggering data-api event\r\n      e.stopPropagation();\r\n\r\n      // Get image group\r\n      let items = [],\r\n        currentGroupName = $(this).attr('data-group'),\r\n        groupList = $D.find('[data-group=\"' + currentGroupName + '\"]');\r\n\r\n      if (currentGroupName !== undefined) {\r\n        items = getImgGroup(groupList, currentGroupName);\r\n        options['index'] = $(this).index('[data-group=\"' + currentGroupName + '\"]');\r\n      } else {\r\n        items = getImgGroup(jqEl.not('[data-group]'));\r\n        options['index'] = $(this).index();\r\n      }\r\n\r\n      $(this).data(NS, new PhotoViewer(items, options, this));\r\n\r\n    });\r\n\r\n  }\r\n\r\n  return jqEl;\r\n\r\n};\r\n\r\n/**\r\n * PhotoViewer DATA-API\r\n */\r\n$D.on(CLICK_EVENT + EVENT_NS, '[data-' + NS + ']', function (e) {\r\n\r\n  jqEl = $('[data-' + NS + ']');\r\n\r\n  e.preventDefault();\r\n\r\n  // Get image group\r\n  let items = [],\r\n    currentGroupName = $(this).attr('data-group'),\r\n    groupList = $D.find('[data-group=\"' + currentGroupName + '\"]');\r\n\r\n  if (currentGroupName !== undefined) {\r\n    items = getImgGroup(groupList, currentGroupName);\r\n    DEFAULTS['index'] = $(this).index('[data-group=\"' + currentGroupName + '\"]');\r\n  } else {\r\n    items = getImgGroup(jqEl.not('[data-group]'));\r\n    DEFAULTS['index'] = $(this).index();\r\n  }\r\n\r\n  $(this).data(NS, new PhotoViewer(items, DEFAULTS, this));\r\n\r\n});\r\n\r\nexport default PhotoViewer;\r\n"],"names":["draggable","resizable","movable","keyboard","title","modalWidth","modalHeight","fixedContent","fixedModalSize","initMaximized","gapThreshold","ratioThreshold","minRatio","maxRatio","headToolbar","footToolbar","icons","minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight","i18n","multiInstances","initAnimation","fixedModalPos","zIndex","dragHandle","callbacks","beforeOpen","$","noop","opened","beforeClose","closed","beforeChange","changed","index","progressiveLoading","getImgSrc","el","src","attr","throttle","fn","delay","timer","context","args","arguments","clearTimeout","setTimeout","apply","preloadImg","success","error","img","Image","onload","onerror","requestFullscreen","element","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","getImageNameFromUrl","url","reg","txt","replace","getNumFromCSSValue","value","arr","match","num","parseFloat","hasScrollbar","document","body","scrollHeight","window","innerHeight","documentElement","clientHeight","getScrollbarWidth","scrollDiv","createElement","style","cssText","appendChild","scrollbarWidth","offsetWidth","clientWidth","removeChild","setGrabCursor","imageData","stageData","stage","isRotated","imageWidth","w","h","imageHeight","addClass","removeClass","supportTouch","DocumentTouch","$W","$D","CLICK_EVENT","RESIZE_EVENT","KEYDOWN_EVENT","WHEEL_EVENT","TOUCH_START_EVENT","TOUCH_MOVE_EVENT","TOUCH_END_EVENT","NS","CLASS_NS","EVENT_NS","PUBLIC_VARS","isMoving","isResizing","defaults","modal","dragCancel","isDragging","startX","startY","left","top","dragStart","e","event","options","css","elemCancel","target","closest","length","type","originalEvent","targetTouches","pageX","clientX","pageY","clientY","offset","on","dragMove","dragEnd","preventDefault","isMaximized","endX","endY","relativeX","relativeY","off","ELEMS_WITH_GRABBING_CURSOR","image","widthDiff","heightDiff","δ","width","height","stageWidth","stageHeight","position","hasClass","newLeft","newTop","extend","ELEMS_WITH_RESIZE_CURSOR","minWidth","minHeight","resizableHandleE","resizableHandleW","resizableHandleS","resizableHandleN","resizableHandleSE","resizableHandleSW","resizableHandleNE","resizableHandleNW","resizableHandles","append","modalData","l","t","imgWidth","imgHeight","direction","getModalOpts","dir","offsetX","offsetY","modalLeft","modalTop","opts","Math","max","getImageOpts","widthDiff2","heightDiff2","imgLeft","imgTop","imgLeft2","imgTop2","modalOpts","imageOpts","isDoResize","scale","getImageScaleToStage","initWidth","initHeight","initLeft","initTop","each","handle","PhotoViewer","items","DEFAULTS","isArray","$el","isOpened","rotateAngle","init","groupData","groupIndex","imgSrc","open","loadImg","$photoviewer","$stage","$image","_creatBtns","toolbar","btns","btnsStr","item","_creatTitle","_creatDOM","btnsTpl","photoviewerHTML","build","$header","find","$headToolbar","$footer","$footToolbar","$title","$close","$maximize","$minimize","$zoomIn","$zoomOut","$actualSize","$fullscreen","$rotateLeft","$rotateRight","$prev","$next","eq","remove","_triggerHook","addEvents","setModalPos","zeroModal","winWidth","winHeight","scrollLeft","scrollTop","setModalSize","stageCSS","right","bottom","borderLeft","borderRight","borderTop","borderBottom","min","round","modalCSSObj","animate","setImageSize","ceil","fadeIn","err","loaderHTML","removeAttr","hide","originalWidth","originalHeight","call","setImgTitle","html","jump","step","jumpTo","wheel","delta","deltaY","wheelDelta","detail","ratio","pointer","x","y","zoom","origin","zoomTo","imgData","newWidth","newHeight","imgNewWidth","imgNewHeight","abs","rotate","angle","rotateTo","transform","resize","resizeHandler","keydown","keyCode","which","charCode","ctrlKey","metaKey","altKey","data","prototype","jqEl","getImgGroup","list","groupName","push","photoviewer","key","isNaN","stopPropagation","currentGroupName","groupList","undefined","not"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,eAAe;;EAGbA,SAAS,EAAE,IAHE;;EAMbC,SAAS,EAAE,IANE;;EASbC,OAAO,EAAE,IATI;;EAYbC,QAAQ,EAAE,IAZG;;EAebC,KAAK,EAAE,IAfM;;EAkBbC,UAAU,EAAE,GAlBC;;EAqBbC,WAAW,EAAE,GArBA;;EAwBbC,YAAY,EAAE,IAxBD;;EA2BbC,cAAc,EAAE,KA3BH;;EA8BbC,aAAa,EAAE,KA9BF;;EAiCbC,YAAY,EAAE,IAjCD;;EAoCbC,cAAc,EAAE,GApCH;;EAuCbC,QAAQ,EAAE,IAvCG;;EA0CbC,QAAQ,EAAE,EA1CG;;EA6CbC,WAAW,EAAE,CACX,UADW,EAEX,OAFW,CA7CA;;EAmDbC,WAAW,EAAE,CACX,QADW,EAEX,SAFW,EAGX,MAHW,EAIX,YAJW,EAKX,MALW,EAMX,YANW,EAOX,aAPW,CAnDA;;EA8DbC,KAAK,EAAE;IACLC,QAAQ,yJADH;IAILC,QAAQ,wKAJH;IAOLC,KAAK,+QAPA;IAYLC,MAAM,0eAZD;IAmBLC,OAAO,2dAnBF;IA0BLC,IAAI,wKA1BC;IA6BLC,IAAI,sKA7BC;IAgCLC,UAAU,mSAhCL;IAqCLC,UAAU,ocArCL;IA4CLC,UAAU,spBA5CL;IAqDLC,WAAW;GAnHA;;EAgIbC,IAAI,EAAE;IACJX,QAAQ,EAAE,UADN;IAEJC,QAAQ,EAAE,UAFN;IAGJC,KAAK,EAAE,OAHH;IAIJC,MAAM,EAAE,YAJJ;IAKJC,OAAO,EAAE,aALL;IAMJC,IAAI,EAAE,SANF;IAOJC,IAAI,EAAE,SAPF;IAQJC,UAAU,EAAE,YARR;IASJC,UAAU,EAAE,yBATR;IAUJC,UAAU,EAAE,qBAVR;IAWJC,WAAW,EAAE;GA3IF;;EA+IbE,cAAc,EAAE,IA/IH;;EAkJbC,aAAa,EAAE,IAlJF;;EAqJbC,aAAa,EAAE,KArJF;;EAwJbC,MAAM,EAAE,IAxJK;;EA2JbC,UAAU,EAAE,KA3JC;;EA8JbC,SAAS,EAAE;IACTC,UAAU,EAAEC,CAAC,CAACC,IADL;IAETC,MAAM,EAAEF,CAAC,CAACC,IAFD;IAGTE,WAAW,EAAEH,CAAC,CAACC,IAHN;IAITG,MAAM,EAAEJ,CAAC,CAACC,IAJD;IAKTI,YAAY,EAAEL,CAAC,CAACC,IALP;IAMTK,OAAO,EAAEN,CAAC,CAACC;GApKA;;EAwKbM,KAAK,EAAE,CAxKM;;EA2KbC,kBAAkB,EAAE;CA3KtB;;ACAA;;;;AAIA,AAAO,SAASC,SAAT,CAAmBC,EAAnB,EAAuB;;MAExBC,GAAG,GAAGX,CAAC,CAACU,EAAD,CAAD,CAAME,IAAN,CAAW,UAAX,IACNZ,CAAC,CAACU,EAAD,CAAD,CAAME,IAAN,CAAW,UAAX,CADM,GAENZ,CAAC,CAACU,EAAD,CAAD,CAAME,IAAN,CAAW,MAAX,CAFJ;SAGOD,GAAP;;;;;;;;;AASF,AAAO,SAASE,QAAT,CAAkBC,EAAlB,EAAsBC,KAAtB,EAA6B;MAE9BC,KAAK,GAAG,IAAZ;SAEO,YAAY;QACbC,OAAO,GAAG,IAAd;QACEC,IAAI,GAAGC,SADT;IAGAC,YAAY,CAACJ,KAAD,CAAZ;IAEAA,KAAK,GAAGK,UAAU,CAAC,YAAY;MAC7BP,EAAE,CAACQ,KAAH,CAASL,OAAT,EAAkBC,IAAlB;KADgB,EAEfH,KAFe,CAAlB;GANF;;;;;;;;;AAmBF,AAAO,SAASQ,UAAT,CAAoBZ,GAApB,EAAyBa,OAAzB,EAAkCC,KAAlC,EAAyC;MAE1CC,GAAG,GAAG,IAAIC,KAAJ,EAAV;;EAEAD,GAAG,CAACE,MAAJ,GAAa,YAAY;IACvBJ,OAAO,CAACE,GAAD,CAAP;GADF;;EAIAA,GAAG,CAACG,OAAJ,GAAc,YAAY;IACxBJ,KAAK,CAACC,GAAD,CAAL;GADF;;EAIAA,GAAG,CAACf,GAAJ,GAAUA,GAAV;;;;;;;AAQF,AAAO,SAASmB,iBAAT,CAA2BC,OAA3B,EAAoC;MACrCA,OAAO,CAACD,iBAAZ,EAA+B;IAC7BC,OAAO,CAACD,iBAAR;GADF,MAEO,IAAIC,OAAO,CAACC,oBAAZ,EAAkC;IACvCD,OAAO,CAACC,oBAAR;GADK,MAEA,IAAID,OAAO,CAACE,uBAAZ,EAAqC;IAC1CF,OAAO,CAACE,uBAAR;GADK,MAEA,IAAIF,OAAO,CAACG,mBAAZ,EAAiC;IACtCH,OAAO,CAACG,mBAAR;;;AAIJ,AAaA;;;;;;AAKA,AAAO,SAASC,mBAAT,CAA6BC,GAA7B,EAAkC;MACnCC,GAAG,GAAG,mCAAV;MACEC,GAAG,GAAGF,GAAG,CAACG,OAAJ,CAAYF,GAAZ,EAAiB,IAAjB,CADR;SAEOC,GAAP;;;;;;;;AAQF,AAAO,SAASE,kBAAT,CAA4BC,KAA5B,EAAmC;MACpCJ,GAAG,GAAG,MAAV;MACEK,GAAG,GAAGD,KAAK,CAACE,KAAN,CAAYN,GAAZ,CADR;MAEEO,GAAG,GAAGC,UAAU,CAACH,GAAG,CAAC,CAAD,CAAJ,CAFlB;SAGOE,GAAP;;;;;;;AAOF,AAAO,SAASE,YAAT,GAAwB;SACtBC,QAAQ,CAACC,IAAT,CAAcC,YAAd,IAA8BC,MAAM,CAACC,WAAP,IAAsBJ,QAAQ,CAACK,eAAT,CAAyBC,YAA7E,CAAP;;;;;;;AAOF,AAAO,SAASC,iBAAT,GAA6B;MAE9BC,SAAS,GAAGR,QAAQ,CAACS,aAAT,CAAuB,KAAvB,CAAhB;EACAD,SAAS,CAACE,KAAV,CAAgBC,OAAhB,GAA0B,gFAA1B;EACAX,QAAQ,CAACC,IAAT,CAAcW,WAAd,CAA0BJ,SAA1B;MACIK,cAAc,GAAGL,SAAS,CAACM,WAAV,GAAwBN,SAAS,CAACO,WAAvD;EACAf,QAAQ,CAACC,IAAT,CAAce,WAAd,CAA0BR,SAA1B;SAEOK,cAAP;;;;;;;;;;AAWF,AAAO,SAASI,aAAT,CAAuBC,SAAvB,EAAkCC,SAAlC,EAA6CC,KAA7C,EAAoDC,SAApD,EAA+D;MAEhEC,UAAU,GAAG,CAACD,SAAD,GAAaH,SAAS,CAACK,CAAvB,GAA2BL,SAAS,CAACM,CAAtD;MACEC,WAAW,GAAG,CAACJ,SAAD,GAAaH,SAAS,CAACM,CAAvB,GAA2BN,SAAS,CAACK,CADrD;;MAGIE,WAAW,GAAGN,SAAS,CAACK,CAAxB,IAA6BF,UAAU,GAAGH,SAAS,CAACI,CAAxD,EAA2D;IACzDH,KAAK,CAACM,QAAN,CAAe,SAAf;;;MAEED,WAAW,IAAIN,SAAS,CAACK,CAAzB,IAA8BF,UAAU,IAAIH,SAAS,CAACI,CAA1D,EAA6D;IAC3DH,KAAK,CAACO,WAAN,CAAkB,SAAlB;;;;;;;;AAQJ,AAAO,SAASC,YAAT,GAAwB;SACtB,CAAC,EAAG,kBAAkBzB,MAAnB,IAA8BA,MAAM,CAAC0B,aAAP,IAAwB7B,QAAQ,YAAY6B,aAA5E,CAAR;;;AC3JK,IAAMC,EAAE,GAAG7E,CAAC,CAACkD,MAAD,CAAZ;AACP,AAAO,IAAM4B,EAAE,GAAG9E,CAAC,CAAC+C,QAAD,CAAZ;AAEP,AAAO,IAAMgC,WAAW,GAAG,OAApB;AACP,AAAO,IAAMC,YAAY,GAAG,QAArB;AACP,AAAO,IAAMC,aAAa,GAAG,SAAtB;AACP,AAAO,IAAMC,WAAW,GAAG,iCAApB;AAEP,AAAO,IAAMC,iBAAiB,GAAGR,YAAY,KAAK,YAAL,GAAoB,WAA1D;AACP,AAAO,IAAMS,gBAAgB,GAAGT,YAAY,KAAK,WAAL,GAAmB,WAAxD;AACP,AAAO,IAAMU,eAAe,GAAGV,YAAY,KAAK,UAAL,GAAkB,SAAtD;AAEP,AAAO,IAAMW,EAAE,GAAG,aAAX;AACP,AAAO,IAAMC,QAAQ,GAAG,MAAMD,EAAvB;AACP,AAAO,IAAME,QAAQ,GAAG,MAAMF,EAAvB;AAEP,AAAO,IAAMG,WAAW,GAAG;;EAEzBC,QAAQ,EAAE,KAFe;;EAIzBC,UAAU,EAAE,KAJa;;EAMzB/F,MAAM,EAAEgG,QAAQ,CAAChG;CANZ;;ACVP,gBAAe;;;;;;;EAQbhC,SARa,qBAQHiI,KARG,EAQIhG,UARJ,EAQgBiG,UARhB,EAQ4B;;;QAEnCC,UAAU,GAAG,KAAjB;QAEIC,MAAM,GAAG,CAAb;QACEC,MAAM,GAAG,CADX;QAGEC,IAAI,GAAG,CAHT;QAIEC,GAAG,GAAG,CAJR;;QAMIC,SAAS,GAAG,SAAZA,SAAY,CAACC,CAAD,EAAO;MAErBA,CAAC,GAAGA,CAAC,IAAInD,MAAM,CAACoD,KAAhB,CAFqB;;;UAOjB,KAAI,CAACC,OAAL,CAAa9G,cAAjB,EAAiC;QAC/BoG,KAAK,CAACW,GAAN,CAAU,SAAV,EAAqB,EAAEf,WAAW,CAAC,QAAD,CAAlC;OARmB;;;UAYjBgB,UAAU,GAAGzG,CAAC,CAACqG,CAAC,CAACK,MAAH,CAAD,CAAYC,OAAZ,CAAoBb,UAApB,CAAjB,CAZqB;;UAcjBW,UAAU,CAACG,MAAf,EAAuB;eACd,IAAP;;;MAGFb,UAAU,GAAG,IAAb;MAEAC,MAAM,GAAGK,CAAC,CAACQ,IAAF,KAAW,YAAX,GACLR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCC,KAD5B,GAELX,CAAC,CAACY,OAFN;MAGAhB,MAAM,GAAGI,CAAC,CAACQ,IAAF,KAAW,YAAX,GACLR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCG,KAD5B,GAELb,CAAC,CAACc,OAFN;MAIAjB,IAAI,GAAGlG,CAAC,CAAC6F,KAAD,CAAD,CAASuB,MAAT,GAAkBlB,IAAzB;MACAC,GAAG,GAAGnG,CAAC,CAAC6F,KAAD,CAAD,CAASuB,MAAT,GAAkBjB,GAAxB;MAEArB,EAAE,CAACuC,EAAH,CAAMjC,gBAAgB,GAAGI,QAAzB,EAAmC8B,QAAnC,EACGD,EADH,CACMhC,eAAe,GAAGG,QADxB,EACkC+B,OADlC;KA9BF;;QAmCID,QAAQ,GAAG,SAAXA,QAAW,CAACjB,CAAD,EAAO;MAEpBA,CAAC,GAAGA,CAAC,IAAInD,MAAM,CAACoD,KAAhB;MAEAD,CAAC,CAACmB,cAAF;;UAEIzB,UAAU,IAAI,CAACN,WAAW,CAAC,UAAD,CAA1B,IAA0C,CAACA,WAAW,CAAC,YAAD,CAAtD,IAAwE,CAAC,KAAI,CAACgC,WAAlF,EAA+F;YAEzFC,IAAI,GAAGrB,CAAC,CAACQ,IAAF,KAAW,WAAX,GACPR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCC,KAD1B,GAEPX,CAAC,CAACY,OAFN;YAGEU,IAAI,GAAGtB,CAAC,CAACQ,IAAF,KAAW,WAAX,GACHR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCG,KAD9B,GAEHb,CAAC,CAACc,OALR;YAOES,SAAS,GAAGF,IAAI,GAAG1B,MAPrB;YAQE6B,SAAS,GAAGF,IAAI,GAAG1B,MARrB;QAUAjG,CAAC,CAAC6F,KAAD,CAAD,CAASW,GAAT,CAAa;UACXN,IAAI,EAAE0B,SAAS,GAAG1B,IAAZ,GAAmB,IADd;UAEXC,GAAG,EAAE0B,SAAS,GAAG1B,GAAZ,GAAkB;SAFzB;;KAlBJ;;QA2BIoB,OAAO,GAAG,SAAVA,OAAU,GAAM;MAElBzC,EAAE,CAACgD,GAAH,CAAO1C,gBAAgB,GAAGI,QAA1B,EAAoC8B,QAApC,EACGQ,GADH,CACOzC,eAAe,GAAGG,QADzB,EACmC+B,OADnC;MAGAxB,UAAU,GAAG,KAAb;KALF;;IASA/F,CAAC,CAACH,UAAD,CAAD,CAAcwH,EAAd,CAAiBlC,iBAAiB,GAAGK,QAArC,EAA+CY,SAA/C;;CAzFJ;;ACCA,IAAM2B,0BAA0B,mBAAiBzC,EAAjB,gBAA8BA,EAA9B,gBAA2CA,EAA3C,iBAAyDA,EAAzD,sBAAhC;AAEA,cAAe;;;;;;;;;;;;;EAcbxH,OAda,mBAcLqG,KAdK,EAcE6D,KAdF,EAcS;;;QAEhBjC,UAAU,GAAG,KAAjB;QAEIC,MAAM,GAAG,CAAb;QACEC,MAAM,GAAG,CADX;QAGEC,IAAI,GAAG,CAHT;QAIEC,GAAG,GAAG,CAJR;QAME8B,SAAS,GAAG,CANd;QAOEC,UAAU,GAAG,CAPf;QASEC,CAAC,GAAG,CATN;;QAWI/B,SAAS,GAAG,SAAZA,SAAY,CAACC,CAAD,EAAO;MAErBA,CAAC,GAAGA,CAAC,IAAInD,MAAM,CAACoD,KAAhB;MAEAD,CAAC,CAACmB,cAAF;UAEInD,UAAU,GAAGrE,CAAC,CAACgI,KAAD,CAAD,CAASI,KAAT,EAAjB;UACE5D,WAAW,GAAGxE,CAAC,CAACgI,KAAD,CAAD,CAASK,MAAT,EADhB;UAEEC,UAAU,GAAGtI,CAAC,CAACmE,KAAD,CAAD,CAASiE,KAAT,EAFf;UAGEG,WAAW,GAAGvI,CAAC,CAACmE,KAAD,CAAD,CAASkE,MAAT,EAHhB;MAKArC,MAAM,GAAGK,CAAC,CAACQ,IAAF,KAAW,YAAX,GACLR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCC,KAD5B,GAELX,CAAC,CAACY,OAFN;MAGAhB,MAAM,GAAGI,CAAC,CAACQ,IAAF,KAAW,YAAX,GACLR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCG,KAD5B,GAELb,CAAC,CAACc,OAFN,CAdqB;;MAmBrBgB,CAAC,GAAG,CAAC,KAAI,CAAC/D,SAAN,GAAkB,CAAlB,GAAsB,CAACC,UAAU,GAAGG,WAAd,IAA6B,CAAvD,CAnBqB;;MAsBrByD,SAAS,GAAG,CAAC,KAAI,CAAC7D,SAAN,GACPC,UAAU,GAAGiE,UADN,GAEP9D,WAAW,GAAG8D,UAFnB;MAGAJ,UAAU,GAAG,CAAC,KAAI,CAAC9D,SAAN,GACRI,WAAW,GAAG+D,WADN,GAERlE,UAAU,GAAGkE,WAFlB,CAzBqB;;MA8BrBxC,UAAU,GAAIkC,SAAS,GAAG,CAAZ,IAAiBC,UAAU,GAAG,CAA/B,GAAoC,IAApC,GAA2C,KAAxD;MACAzC,WAAW,CAAC,UAAD,CAAX,GAA2BwC,SAAS,GAAG,CAAZ,IAAiBC,UAAU,GAAG,CAA/B,GAAoC,IAApC,GAA2C,KAArE,CA/BqB;;;MAmCrBhC,IAAI,GAAGlG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IAApB,GAA2BiC,CAAlC;MACAhC,GAAG,GAAGnG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC,GAApB,GAA0BgC,CAAhC,CApCqB;;UAuCjBhE,KAAK,CAACsE,QAAN,CAAe,SAAf,CAAJ,EAA+B;QAC7BzI,CAAC,CAAC+H,0BAAD,CAAD,CAA8BtD,QAA9B,CAAuC,aAAvC;;;MAGFK,EAAE,CAACuC,EAAH,CAAMjC,gBAAgB,GAAGI,QAAzB,EAAmC8B,QAAnC,EACGD,EADH,CACMhC,eAAe,GAAGG,QADxB,EACkC+B,OADlC;KA3CF;;QAgDID,QAAQ,GAAG,SAAXA,QAAW,CAACjB,CAAD,EAAO;MAEpBA,CAAC,GAAGA,CAAC,IAAInD,MAAM,CAACoD,KAAhB;MAEAD,CAAC,CAACmB,cAAF;;UAEIzB,UAAJ,EAAgB;YAEV2B,IAAI,GAAGrB,CAAC,CAACQ,IAAF,KAAW,WAAX,GACPR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCC,KAD1B,GAEPX,CAAC,CAACY,OAFN;YAGEU,IAAI,GAAGtB,CAAC,CAACQ,IAAF,KAAW,WAAX,GACHR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCG,KAD9B,GAEHb,CAAC,CAACc,OALR;YAOES,SAAS,GAAGF,IAAI,GAAG1B,MAPrB;YAQE6B,SAAS,GAAGF,IAAI,GAAG1B,MARrB;YAUEyC,OAAO,GAAGd,SAAS,GAAG1B,IAVxB;YAWEyC,MAAM,GAAGd,SAAS,GAAG1B,GAXvB,CAFc;;YAgBV+B,UAAU,GAAG,CAAjB,EAAoB;cAEbL,SAAS,GAAG1B,GAAb,GAAoBgC,CAAxB,EAA2B;YACzBQ,MAAM,GAAGR,CAAT;WADF,MAEO,IAAKN,SAAS,GAAG1B,GAAb,GAAoB,CAAC+B,UAAD,GAAcC,CAAtC,EAAyC;YAC9CQ,MAAM,GAAG,CAACT,UAAD,GAAcC,CAAvB;;SALJ,MAQO;UACLQ,MAAM,GAAGxC,GAAT;SAzBY;;;YA4BV8B,SAAS,GAAG,CAAhB,EAAmB;cAEZL,SAAS,GAAG1B,IAAb,GAAqB,CAACiC,CAA1B,EAA6B;YAC3BO,OAAO,GAAG,CAACP,CAAX;WADF,MAEO,IAAKP,SAAS,GAAG1B,IAAb,GAAqB,CAAC+B,SAAD,GAAaE,CAAtC,EAAyC;YAC9CO,OAAO,GAAG,CAACT,SAAD,GAAaE,CAAvB;;SALJ,MAQO;UACLO,OAAO,GAAGxC,IAAV;;;QAGFlG,CAAC,CAACgI,KAAD,CAAD,CAASxB,GAAT,CAAa;UACXN,IAAI,EAAEwC,OAAO,GAAG,IADL;UAEXvC,GAAG,EAAEwC,MAAM,GAAG;SAFhB,EAxCc;;QA8Cd3I,CAAC,CAAC4I,MAAF,CAAS,KAAI,CAAC3E,SAAd,EAAyB;UACvBiC,IAAI,EAAEwC,OADiB;UAEvBvC,GAAG,EAAEwC;SAFP;;KApDJ;;QA6DIpB,OAAO,GAAG,SAAVA,OAAU,GAAM;MAElBzC,EAAE,CAACgD,GAAH,CAAO1C,gBAAgB,GAAGI,QAA1B,EAAoC8B,QAApC,EACGQ,GADH,CACOzC,eAAe,GAAGG,QADzB,EACmC+B,OADnC;MAGAxB,UAAU,GAAG,KAAb;MACAN,WAAW,CAAC,UAAD,CAAX,GAA0B,KAA1B,CANkB;;MASlBzF,CAAC,CAAC+H,0BAAD,CAAD,CAA8BrD,WAA9B,CAA0C,aAA1C;KATF;;IAaA1E,CAAC,CAACmE,KAAD,CAAD,CAASkD,EAAT,CAAYlC,iBAAiB,GAAGK,QAAhC,EAA0CY,SAA1C;;CAvJJ;;ACEA,IAAMyC,wBAAwB,mBAAiBvD,EAAjB,gBAA8BA,EAA9B,gBAA2CA,EAA3C,YAA9B;AAEA,gBAAe;;;;;;;;;;;;;;;EAgBbzH,SAhBa,qBAgBHgI,KAhBG,EAgBI1B,KAhBJ,EAgBW6D,KAhBX,EAgBkBc,QAhBlB,EAgB4BC,SAhB5B,EAgBuC;;;QAE9CC,gBAAgB,GAAGhJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,kCAAxB;QACE2D,gBAAgB,GAAGjJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,kCADtB;QAEE4D,gBAAgB,GAAGlJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,kCAFtB;QAGE6D,gBAAgB,GAAGnJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,kCAHtB;QAIE8D,iBAAiB,GAAGpJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,mCAJvB;QAKE+D,iBAAiB,GAAGrJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,mCALvB;QAMEgE,iBAAiB,GAAGtJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,mCANvB;QAOEiE,iBAAiB,GAAGvJ,CAAC,mBAAgBsF,EAAhB,0BAAuCA,EAAvC,mCAPvB;QASIkE,gBAAgB,GAAG;WAChBR,gBADgB;WAEhBE,gBAFgB;YAGfE,iBAHe;WAIhBD,gBAJgB;WAKhBF,gBALgB;YAMfM,iBANe;YAOfD,iBAPe;YAQfD;KARR;IAWArJ,CAAC,CAAC6F,KAAD,CAAD,CAAS4D,MAAT,CACET,gBADF,EACoBC,gBADpB,EACsCC,gBADtC,EACwDC,gBADxD,EAEEC,iBAFF,EAEqBC,iBAFrB,EAEwCC,iBAFxC,EAE2DC,iBAF3D;QAKIxD,UAAU,GAAG,KAAjB;QAEIC,MAAM,GAAG,CAAb;QACEC,MAAM,GAAG,CADX;QAGEyD,SAAS,GAAG;MACVpF,CAAC,EAAE,CADO;MAEVC,CAAC,EAAE,CAFO;MAGVoF,CAAC,EAAE,CAHO;MAIVC,CAAC,EAAE;KAPP;QASE1F,SAAS,GAAG;MACVI,CAAC,EAAE,CADO;MAEVC,CAAC,EAAE,CAFO;MAGVoF,CAAC,EAAE,CAHO;MAIVC,CAAC,EAAE;KAbP;QAeE3F,SAAS,GAAG;MACVK,CAAC,EAAE,CADO;MAEVC,CAAC,EAAE,CAFO;MAGVoF,CAAC,EAAE,CAHO;MAIVC,CAAC,EAAE;KAnBP;;IAuBEzB,CAAC,GAAG,CAvBN;QAwBE0B,QAAQ,GAAG,CAxBb;QAyBEC,SAAS,GAAG,CAzBd;QA2BEC,SAAS,GAAG,EA3Bd,CA7BkD;;QA2D9CC,YAAY,GAAG,SAAfA,YAAe,CAAUC,GAAV,EAAeC,OAAf,EAAwBC,OAAxB,EAAiC;;UAG9CC,SAAS,GAAI,CAACF,OAAD,GAAWR,SAAS,CAACpF,CAAtB,GAA2BwE,QAA3B,GACXoB,OAAO,GAAGR,SAAS,CAACC,CADT,GAEXD,SAAS,CAACC,CAAV,GAAcD,SAAS,CAACpF,CAAxB,GAA4BwE,QAFjC;UAGEuB,QAAQ,GAAI,CAACF,OAAD,GAAWT,SAAS,CAACnF,CAAtB,GAA2BwE,SAA3B,GACNoB,OAAO,GAAGT,SAAS,CAACE,CADd,GAENF,SAAS,CAACE,CAAV,GAAcF,SAAS,CAACnF,CAAxB,GAA4BwE,SALnC;UAOIuB,IAAI,GAAG;aACJ;UACHlC,KAAK,EAAEmC,IAAI,CAACC,GAAL,CAAUN,OAAO,GAAGR,SAAS,CAACpF,CAA9B,EAAkCwE,QAAlC,IAA8C;SAF9C;aAIJ;UACHT,MAAM,EAAEkC,IAAI,CAACC,GAAL,CAAUL,OAAO,GAAGT,SAAS,CAACnF,CAA9B,EAAkCwE,SAAlC,IAA+C;SALhD;cAOH;UACJX,KAAK,EAAEmC,IAAI,CAACC,GAAL,CAAUN,OAAO,GAAGR,SAAS,CAACpF,CAA9B,EAAkCwE,QAAlC,IAA8C,IADjD;UAEJT,MAAM,EAAEkC,IAAI,CAACC,GAAL,CAAUL,OAAO,GAAGT,SAAS,CAACnF,CAA9B,EAAkCwE,SAAlC,IAA+C;SAThD;aAWJ;UACHX,KAAK,EAAEmC,IAAI,CAACC,GAAL,CAAU,CAACN,OAAD,GAAWR,SAAS,CAACpF,CAA/B,EAAmCwE,QAAnC,IAA+C,IADnD;UAEH5C,IAAI,EAAEkE,SAAS,GAAG;SAbX;aAeJ;UACH/B,MAAM,EAAEkC,IAAI,CAACC,GAAL,CAAU,CAACL,OAAD,GAAWT,SAAS,CAACnF,CAA/B,EAAmCwE,SAAnC,IAAgD,IADrD;UAEH5C,GAAG,EAAEkE,QAAQ,GAAG;SAjBT;cAmBH;UACJjC,KAAK,EAAEmC,IAAI,CAACC,GAAL,CAAU,CAACN,OAAD,GAAWR,SAAS,CAACpF,CAA/B,EAAmCwE,QAAnC,IAA+C,IADlD;UAEJT,MAAM,EAAEkC,IAAI,CAACC,GAAL,CAAU,CAACL,OAAD,GAAWT,SAAS,CAACnF,CAA/B,EAAmCwE,SAAnC,IAAgD,IAFpD;UAGJ5C,GAAG,EAAEkE,QAAQ,GAAG,IAHZ;UAIJnE,IAAI,EAAEkE,SAAS,GAAG;SAvBX;cAyBH;UACJhC,KAAK,EAAEmC,IAAI,CAACC,GAAL,CAAUN,OAAO,GAAGR,SAAS,CAACpF,CAA9B,EAAkCwE,QAAlC,IAA8C,IADjD;UAEJT,MAAM,EAAEkC,IAAI,CAACC,GAAL,CAAU,CAACL,OAAD,GAAWT,SAAS,CAACnF,CAA/B,EAAmCwE,SAAnC,IAAgD,IAFpD;UAGJ5C,GAAG,EAAEkE,QAAQ,GAAG;SA5BT;cA8BH;UACJjC,KAAK,EAAEmC,IAAI,CAACC,GAAL,CAAU,CAACN,OAAD,GAAWR,SAAS,CAACpF,CAA/B,EAAmCwE,QAAnC,IAA+C,IADlD;UAEJT,MAAM,EAAEkC,IAAI,CAACC,GAAL,CAAUL,OAAO,GAAGT,SAAS,CAACnF,CAA9B,EAAkCwE,SAAlC,IAA+C,IAFnD;UAGJ7C,IAAI,EAAEkE,SAAS,GAAG;;OAjCtB;aAqCOE,IAAI,CAACL,GAAD,CAAX;KA/CF,CA3DkD;;;QA8G9CQ,YAAY,GAAG,SAAfA,YAAe,CAAUR,GAAV,EAAeC,OAAf,EAAwBC,OAAxB,EAAiC;;;UAI9ClC,SAAS,GAAIiC,OAAO,GAAGR,SAAS,CAACpF,CAArB,GAA0BwE,QAA1B,GACX5E,SAAS,CAACI,CAAV,GAAcuF,QAAd,GAAyBK,OAAzB,GAAmC/B,CADxB,GAEXW,QAAQ,IAAIY,SAAS,CAACpF,CAAV,GAAcJ,SAAS,CAACI,CAA5B,CAAR,GAAyCuF,QAAzC,GAAoD1B,CAFzD;UAGED,UAAU,GAAIiC,OAAO,GAAGT,SAAS,CAACnF,CAArB,GAA0BwE,SAA1B,GACR7E,SAAS,CAACK,CAAV,GAAcuF,SAAd,GAA0BK,OAA1B,GAAoChC,CAD5B,GAERY,SAAS,IAAIW,SAAS,CAACnF,CAAV,GAAcL,SAAS,CAACK,CAA5B,CAAT,GAA0CuF,SAA1C,GAAsD3B,CAL7D;UAOEuC,UAAU,GAAI,CAACR,OAAD,GAAWR,SAAS,CAACpF,CAAtB,GAA2BwE,QAA3B,GACR5E,SAAS,CAACI,CAAV,GAAcuF,QAAd,GAAyBK,OAAzB,GAAmC/B,CAD3B,GAERW,QAAQ,IAAIY,SAAS,CAACpF,CAAV,GAAcJ,SAAS,CAACI,CAA5B,CAAR,GAAyCuF,QAAzC,GAAoD1B,CAT3D;UAUEwC,WAAW,GAAI,CAACR,OAAD,GAAWT,SAAS,CAACnF,CAAtB,GAA2BwE,SAA3B,GACT7E,SAAS,CAACK,CAAV,GAAcuF,SAAd,GAA0BK,OAA1B,GAAoChC,CAD3B,GAETY,SAAS,IAAIW,SAAS,CAACnF,CAAV,GAAcL,SAAS,CAACK,CAA5B,CAAT,GAA0CuF,SAA1C,GAAsD3B,CAZ7D,CAJkD;;UAmB9CyC,OAAO,GAAG,CAAC3C,SAAS,GAAG,CAAZ,GACXjI,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IADT,GAEVlG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IAApB,GAA2B,CAA3B,GACClG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IADrB,GAEC,CAJQ,IAIFiC,CAJZ;UAKE0C,MAAM,GAAG,CAAC3C,UAAU,GAAG,CAAb,GACNlI,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC,GADd,GAELnG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC,GAApB,GAA0B,CAA1B,GACCnG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC,GADrB,GAEC,CAJG,IAIGgC,CATd;UAWE2C,QAAQ,GAAG,CAACJ,UAAU,GAAG,CAAb,GACR1K,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IADZ,GAEPlG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IAApB,GAA2B,CAA3B,GACClG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IADrB,GAEC,CAJK,IAICiC,CAfd;UAgBE4C,OAAO,GAAG,CAACJ,WAAW,GAAG,CAAd,GACP3K,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC,GADb,GAENnG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC,GAApB,GAA0B,CAA1B,GACCnG,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC,GADrB,GAEC,CAJI,IAIEgC,CApBd;UAsBImC,IAAI,GAAG;aACJ;UACHpE,IAAI,EAAE+B,SAAS,IAAI,CAACE,CAAd,GACD,CAACF,SAAS,GAAGE,CAAb,IAAkB,CAAlB,GAAsB,IADrB,GAEDyC,OAAO,GAAG3C,SAAV,GACE2C,OAAO,GAAG,IADZ,GAEE3C,SAAS,GAAG;SANZ;aAQJ;UACH9B,GAAG,EAAE+B,UAAU,IAAIC,CAAd,GACA,CAACD,UAAU,GAAGC,CAAd,IAAmB,CAAnB,GAAuB,IADvB,GAEA0C,MAAM,GAAG3C,UAAT,GACE2C,MAAM,GAAG,IADX,GAEE3C,UAAU,GAAG;SAbb;cAeH;UACJ/B,GAAG,EAAE+B,UAAU,IAAIC,CAAd,GACA,CAACD,UAAU,GAAGC,CAAd,IAAmB,CAAnB,GAAuB,IADvB,GAEA0C,MAAM,GAAG3C,UAAT,GACE2C,MAAM,GAAG,IADX,GAEE3C,UAAU,GAAG,IALhB;UAMJhC,IAAI,EAAE+B,SAAS,IAAI,CAACE,CAAd,GACD,CAACF,SAAS,GAAGE,CAAb,IAAkB,CAAlB,GAAsB,IADrB,GAEDyC,OAAO,GAAG3C,SAAV,GACE2C,OAAO,GAAG,IADZ,GAEE3C,SAAS,GAAG;SAzBZ;aA2BJ;UACH/B,IAAI,EAAEwE,UAAU,IAAI,CAACvC,CAAf,GACD,CAACuC,UAAU,GAAGvC,CAAd,IAAmB,CAAnB,GAAuB,IADtB,GAED2C,QAAQ,GAAGJ,UAAX,GACEI,QAAQ,GAAG,IADb,GAEEJ,UAAU,GAAG;SAhCb;aAkCJ;UACHvE,GAAG,EAAEwE,WAAW,IAAIxC,CAAf,GACA,CAACwC,WAAW,GAAGxC,CAAf,IAAoB,CAApB,GAAwB,IADxB,GAEA4C,OAAO,GAAGJ,WAAV,GACEI,OAAO,GAAG,IADZ,GAEEJ,WAAW,GAAG;SAvCd;cAyCH;UACJxE,GAAG,EAAEwE,WAAW,IAAIxC,CAAf,GACA,CAACwC,WAAW,GAAGxC,CAAf,IAAoB,CAApB,GAAwB,IADxB,GAEA4C,OAAO,GAAGJ,WAAV,GACEI,OAAO,GAAG,IADZ,GAEEJ,WAAW,GAAG,IALjB;UAMJzE,IAAI,EAAEwE,UAAU,IAAI,CAACvC,CAAf,GACD,CAACuC,UAAU,GAAGvC,CAAd,IAAmB,CAAnB,GAAuB,IADtB,GAED2C,QAAQ,GAAGJ,UAAX,GACEI,QAAQ,GAAG,IADb,GAEEJ,UAAU,GAAG;SAnDb;cAqDH;UACJvE,GAAG,EAAEwE,WAAW,IAAIxC,CAAf,GACA,CAACwC,WAAW,GAAGxC,CAAf,IAAoB,CAApB,GAAwB,IADxB,GAEA4C,OAAO,GAAGJ,WAAV,GACEI,OAAO,GAAG,IADZ,GAEEJ,WAAW,GAAG,IALjB;UAMJzE,IAAI,EAAE+B,SAAS,IAAI,CAACE,CAAd,GACD,CAACF,SAAS,GAAGE,CAAb,IAAkB,CAAlB,GAAsB,IADrB,GAEDyC,OAAO,GAAG3C,SAAV,GACE2C,OAAO,GAAG,IADZ,GAEE3C,SAAS,GAAG;SA/DZ;cAiEH;UACJ9B,GAAG,EAAE+B,UAAU,IAAIC,CAAd,GACA,CAACD,UAAU,GAAGC,CAAd,IAAmB,CAAnB,GAAuB,IADvB,GAEA0C,MAAM,GAAG3C,UAAT,GACE2C,MAAM,GAAG,IADX,GAEE3C,UAAU,GAAG,IALhB;UAMJhC,IAAI,EAAEwE,UAAU,IAAI,CAACvC,CAAf,GACD,CAACuC,UAAU,GAAGvC,CAAd,IAAmB,CAAnB,GAAuB,IADtB,GAED2C,QAAQ,GAAGJ,UAAX,GACEI,QAAQ,GAAG,IADb,GAEEJ,UAAU,GAAG;;OA3ExB;aA+EOJ,IAAI,CAACL,GAAD,CAAX;KAxHF;;QA2HI7D,SAAS,GAAG,SAAZA,SAAY,CAAC6D,GAAD,EAAM5D,CAAN,EAAY;MAE1BA,CAAC,GAAGA,CAAC,IAAInD,MAAM,CAACoD,KAAhB;MAEAD,CAAC,CAACmB,cAAF;MAEAzB,UAAU,GAAG,IAAb;MACAN,WAAW,CAAC,YAAD,CAAX,GAA4B,IAA5B;MAEAO,MAAM,GAAGK,CAAC,CAACQ,IAAF,KAAW,YAAX,GACLR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCC,KAD5B,GAELX,CAAC,CAACY,OAFN;MAGAhB,MAAM,GAAGI,CAAC,CAACQ,IAAF,KAAW,YAAX,GACLR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCG,KAD5B,GAELb,CAAC,CAACc,OAFN,CAZ0B;;MAiB1BuC,SAAS,GAAG;QACVpF,CAAC,EAAEtE,CAAC,CAAC6F,KAAD,CAAD,CAASuC,KAAT,EADO;QAEV7D,CAAC,EAAEvE,CAAC,CAAC6F,KAAD,CAAD,CAASwC,MAAT,EAFO;QAGVsB,CAAC,EAAE3J,CAAC,CAAC6F,KAAD,CAAD,CAASuB,MAAT,GAAkBlB,IAHX;QAIV0D,CAAC,EAAE5J,CAAC,CAAC6F,KAAD,CAAD,CAASuB,MAAT,GAAkBjB;OAJvB;MAOAjC,SAAS,GAAG;QACVI,CAAC,EAAEtE,CAAC,CAACmE,KAAD,CAAD,CAASiE,KAAT,EADO;QAEV7D,CAAC,EAAEvE,CAAC,CAACmE,KAAD,CAAD,CAASkE,MAAT,EAFO;QAGVsB,CAAC,EAAE3J,CAAC,CAACmE,KAAD,CAAD,CAASiD,MAAT,GAAkBlB,IAHX;QAIV0D,CAAC,EAAE5J,CAAC,CAACmE,KAAD,CAAD,CAASiD,MAAT,GAAkBjB;OAJvB;MAOAlC,SAAS,GAAG;QACVK,CAAC,EAAEtE,CAAC,CAACgI,KAAD,CAAD,CAASI,KAAT,EADO;QAEV7D,CAAC,EAAEvE,CAAC,CAACgI,KAAD,CAAD,CAASK,MAAT,EAFO;QAGVsB,CAAC,EAAE3J,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBtC,IAHb;QAIV0D,CAAC,EAAE5J,CAAC,CAACgI,KAAD,CAAD,CAASQ,QAAT,GAAoBrC;OAJzB,CA/B0B;;MAuC1BgC,CAAC,GAAG,CAAC,KAAI,CAAC/D,SAAN,GACA,CADA,GAEA,CAACH,SAAS,CAACK,CAAV,GAAcL,SAAS,CAACM,CAAzB,IAA8B,CAFlC;MAGAsF,QAAQ,GAAG,CAAC,KAAI,CAACzF,SAAN,GACPH,SAAS,CAACK,CADH,GAEPL,SAAS,CAACM,CAFd;MAGAuF,SAAS,GAAG,CAAC,KAAI,CAAC1F,SAAN,GACRH,SAAS,CAACM,CADF,GAERN,SAAS,CAACK,CAFd;MAIAyF,SAAS,GAAGE,GAAZ,CAjD0B;;MAoD1BjK,CAAC,CAAC6I,wBAAD,CAAD,CAA4BrC,GAA5B,CAAgC,QAAhC,EAA0CyD,GAAG,GAAG,SAAhD;MAEAnF,EAAE,CAACuC,EAAH,CAAMjC,gBAAgB,GAAGI,QAAzB,EAAmC8B,QAAnC,EACGD,EADH,CACMhC,eAAe,GAAGG,QADxB,EACkC+B,OADlC;KAtDF;;QA2DID,QAAQ,GAAG,SAAXA,QAAW,CAACjB,CAAD,EAAO;MAEpBA,CAAC,GAAGA,CAAC,IAAInD,MAAM,CAACoD,KAAhB;MAEAD,CAAC,CAACmB,cAAF;;UAEIzB,UAAU,IAAI,CAAC,KAAI,CAAC0B,WAAxB,EAAqC;YAE/BC,IAAI,GAAGrB,CAAC,CAACQ,IAAF,KAAW,WAAX,GACPR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCC,KAD1B,GAEPX,CAAC,CAACY,OAFN;YAGEU,IAAI,GAAGtB,CAAC,CAACQ,IAAF,KAAW,WAAX,GACHR,CAAC,CAACS,aAAF,CAAgBC,aAAhB,CAA8B,CAA9B,EAAiCG,KAD9B,GAEHb,CAAC,CAACc,OALR;YAOES,SAAS,GAAGF,IAAI,GAAG1B,MAPrB;YAQE6B,SAAS,GAAGF,IAAI,GAAG1B,MARrB;YAUI+E,SAAS,GAAGhB,YAAY,CAACD,SAAD,EAAYnC,SAAZ,EAAuBC,SAAvB,CAA5B;QAEA7H,CAAC,CAAC6F,KAAD,CAAD,CAASW,GAAT,CAAawE,SAAb;YAEIC,SAAS,GAAGR,YAAY,CAACV,SAAD,EAAYnC,SAAZ,EAAuBC,SAAvB,CAA5B;QAEA7H,CAAC,CAACgI,KAAD,CAAD,CAASxB,GAAT,CAAayE,SAAb;QAEA,KAAI,CAACC,UAAL,GAAkB,IAAlB;;KA1BJ;;QAgCI3D,OAAO,GAAG,SAAVA,OAAU,GAAM;MAElBzC,EAAE,CAACgD,GAAH,CAAO1C,gBAAgB,GAAGI,QAA1B,EAAoC8B,QAApC,EACGQ,GADH,CACOzC,eAAe,GAAGG,QADzB,EACmC+B,OADnC,EAFkB;;UAMd9B,WAAW,CAAC,YAAD,CAAf,EAA+B;QAC7BzB,aAAa,CACX;UACEM,CAAC,EAAEuF,QADL;UAEEtF,CAAC,EAAEuF;SAHM,EAKX;UACExF,CAAC,EAAEtE,CAAC,CAACmE,KAAD,CAAD,CAASiE,KAAT,EADL;UAEE7D,CAAC,EAAEvE,CAAC,CAACmE,KAAD,CAAD,CAASkE,MAAT;SAPM,EASXlE,KATW,CAAb;;;MAaF4B,UAAU,GAAG,KAAb;MACAN,WAAW,CAAC,YAAD,CAAX,GAA4B,KAA5B,CArBkB;;MAwBlBzF,CAAC,CAAC6I,wBAAD,CAAD,CAA4BrC,GAA5B,CAAgC,QAAhC,EAA0C,EAA1C,EAxBkB;;UA2Bd2E,KAAK,GAAG,KAAI,CAACC,oBAAL,CACVpL,CAAC,CAACmE,KAAD,CAAD,CAASiE,KAAT,EADU,EAEVpI,CAAC,CAACmE,KAAD,CAAD,CAASkE,MAAT,EAFU,CAAZ;;MAKArI,CAAC,CAAC4I,MAAF,CAAS,KAAI,CAAC3E,SAAd,EAAyB;QACvBoH,SAAS,EAAE,KAAI,CAAC3J,GAAL,CAAS0G,KAAT,GAAiB+C,KADL;QAEvBG,UAAU,EAAE,KAAI,CAAC5J,GAAL,CAAS2G,MAAT,GAAkB8C,KAFP;QAGvBI,QAAQ,EAAE,CAACvL,CAAC,CAACmE,KAAD,CAAD,CAASiE,KAAT,KAAmB,KAAI,CAAC1G,GAAL,CAAS0G,KAAT,GAAiB+C,KAArC,IAA8C,CAHjC;QAIvBK,OAAO,EAAE,CAACxL,CAAC,CAACmE,KAAD,CAAD,CAASkE,MAAT,KAAoB,KAAI,CAAC3G,GAAL,CAAS2G,MAAT,GAAkB8C,KAAvC,IAAgD;OAJ3D;KAhCF;;IAyCAnL,CAAC,CAACyL,IAAF,CAAOjC,gBAAP,EAAyB,UAAUS,GAAV,EAAeyB,MAAf,EAAuB;MAC9CA,MAAM,CAACrE,EAAP,CAAUlC,iBAAiB,GAAGK,QAA9B,EAAwC,UAAUa,CAAV,EAAa;QACnDD,SAAS,CAAC6D,GAAD,EAAM5D,CAAN,CAAT;OADF;KADF;;CA7XJ;;ACiBA;;;;IAGMsF;;;uBAEQC,KAAZ,EAAmBrF,OAAnB,EAA4B7F,EAA5B,EAAgC;SAEzB6F,OAAL,GAAevG,GAAC,CAAC4I,MAAF,CAAS,IAAT,EAAe,EAAf,EAAmBiD,QAAnB,EAA6BtF,OAA7B,CAAf;;QAEIA,OAAO,IAAIvG,GAAC,CAAC8L,OAAF,CAAUvF,OAAO,CAAC5H,WAAlB,CAAf,EAA+C;WACxC4H,OAAL,CAAa5H,WAAb,GAA2B4H,OAAO,CAAC5H,WAAnC;;;QAGE4H,OAAO,IAAIvG,GAAC,CAAC8L,OAAF,CAAUvF,OAAO,CAAC7H,WAAlB,CAAf,EAA+C;WACxC6H,OAAL,CAAa7H,WAAb,GAA2B6H,OAAO,CAAC7H,WAAnC;KAT4B;;;SAazBqN,GAAL,GAAW/L,GAAC,CAACU,EAAD,CAAZ,CAb8B;;;;SAmBzBsL,QAAL,GAAgB,KAAhB,CAnB8B;;SAqBzBvE,WAAL,GAAmB,KAAnB,CArB8B;;SAuBzBrD,SAAL,GAAiB,KAAjB,CAvB8B;;SAyBzB6H,WAAL,GAAmB,CAAnB,CAzB8B;;SA4BzBf,UAAL,GAAkB,KAAlB,CA5B8B;;SA+BzBjH,SAAL,GAAiB,EAAjB,CA/B8B;;SAiCzByF,SAAL,GAAiB;MACftB,KAAK,EAAE,IADQ;MAEfC,MAAM,EAAE,IAFO;MAGfnC,IAAI,EAAE,IAHS;MAIfC,GAAG,EAAE;KAJP;SAOK+F,IAAL,CAAUN,KAAV,EAAiB,KAAKrF,OAAtB,EAA+B7F,EAA/B;;;;;SAIFwL,OAAA,cAAKN,KAAL,EAAYtB,IAAZ,EAAkB5J,EAAlB,EAAsB;SAEfyL,SAAL,GAAiBP,KAAjB;SACKQ,UAAL,GAAkB9B,IAAI,CAAC,OAAD,CAAtB,CAHoB;;QAMhB+B,MAAM,GAAGT,KAAK,CAAC,KAAKQ,UAAN,CAAL,CAAuB,KAAvB,CAAb;SAEKE,IAAL;SAEKC,OAAL,CAAaF,MAAb,EAVoB;;QAahB/B,IAAI,CAAC1M,SAAT,EAAoB;WACbA,SAAL,CAAe,KAAK4O,YAApB,EAAkC,KAAK3M,UAAvC,EAAmD0F,QAAQ,GAAG,SAA9D;;;QAEE+E,IAAI,CAACxM,OAAT,EAAkB;WACXA,OAAL,CAAa,KAAK2O,MAAlB,EAA0B,KAAKC,MAA/B;;;QAEEpC,IAAI,CAACzM,SAAT,EAAoB;WACbA,SAAL,CACE,KAAK2O,YADP,EAEE,KAAKC,MAFP,EAGE,KAAKC,MAHP,EAIEpC,IAAI,CAACrM,UAJP,EAKEqM,IAAI,CAACpM,WALP;;;;SAWJyO,aAAA,oBAAWC,OAAX,EAAoBC,IAApB,EAA0B;QAEpBC,OAAO,GAAG,EAAd;IAEA9M,GAAC,CAACyL,IAAF,CAAOmB,OAAP,EAAgB,UAAUrM,KAAV,EAAiBwM,IAAjB,EAAuB;MACrCD,OAAO,IAAID,IAAI,CAACE,IAAD,CAAf;KADF;WAIOD,OAAP;;;SAIFE,cAAA,uBAAc;WACJ,KAAKzG,OAAL,CAAavI,KAAb,qBAAoCsH,EAApC,uBAAyD,EAAjE;;;SAGF2H,YAAA,qBAAY;QAENC,OAAO,GAAG;MACZrO,QAAQ,uBAAoByG,EAApB,gBAAiCA,EAAjC,sDACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBX,QAD/B,iCAEQ,KAAK0H,OAAL,CAAa3H,KAAb,CAAmBC,QAF3B,kCADI;MAKZC,QAAQ,uBAAoBwG,EAApB,gBAAiCA,EAAjC,sDACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBV,QAD/B,iCAEQ,KAAKyH,OAAL,CAAa3H,KAAb,CAAmBE,QAF3B,kCALI;MASZC,KAAK,uBAAoBuG,EAApB,gBAAiCA,EAAjC,+CACY,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBT,KAD9B,6BAEO,KAAKwH,OAAL,CAAa3H,KAAb,CAAmBG,KAF1B,8BATO;MAaZC,MAAM,uBAAoBsG,EAApB,gBAAiCA,EAAjC,mDACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBR,MAD/B,+BAEQ,KAAKuH,OAAL,CAAa3H,KAAb,CAAmBI,MAF3B,gCAbM;MAiBZC,OAAO,uBAAoBqG,EAApB,gBAAiCA,EAAjC,oDACY,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBP,OAD9B,+BAEO,KAAKsH,OAAL,CAAa3H,KAAb,CAAmBK,OAF1B,gCAjBK;MAqBZC,IAAI,uBAAoBoG,EAApB,gBAAiCA,EAAjC,8CACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBN,IAD/B,6BAEQ,KAAKqH,OAAL,CAAa3H,KAAb,CAAmBM,IAF3B,8BArBQ;MAyBZC,IAAI,uBAAoBmG,EAApB,gBAAiCA,EAAjC,8CACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBL,IAD/B,6BAEQ,KAAKoH,OAAL,CAAa3H,KAAb,CAAmBO,IAF3B,8BAzBQ;MA6BZC,UAAU,uBAAoBkG,EAApB,gBAAiCA,EAAjC,0DACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBJ,UAD/B,iCAEM,KAAKmH,OAAL,CAAa3H,KAAb,CAAmBQ,UAFzB,kCA7BE;MAiCZC,UAAU,uBAAoBiG,EAApB,gBAAiCA,EAAjC,2DACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBH,UAD/B,mCAEQ,KAAKkH,OAAL,CAAa3H,KAAb,CAAmBS,UAF3B,oCAjCE;MAqCZC,UAAU,uBAAoBgG,EAApB,gBAAiCA,EAAjC,2DACa,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBF,UAD/B,mCAEQ,KAAKiH,OAAL,CAAa3H,KAAb,CAAmBU,UAF3B,oCArCE;MAyCZC,WAAW,uBAAoB+F,EAApB,gBAAiCA,EAAjC,8DACc,KAAKiB,OAAL,CAAa/G,IAAb,CAAkBD,WADhC,mCAEO,KAAKgH,OAAL,CAAa3H,KAAb,CAAmBW,WAF1B;KAzCb,CAFU;;QAkDN4N,eAAe,qBACF7H,EADE,wCAEDA,EAFC,0CAGCA,EAHD,6CAIGA,EAJH,iBAIiBA,EAJjB,wCAKP,KAAKqH,UAAL,CAAgB,KAAKpG,OAAL,CAAa7H,WAA7B,EAA0CwO,OAA1C,CALO,0CAOT,KAAKF,WAAL,EAPS,mDASC1H,EATD,4CAUGA,EAVH,gFAYCA,EAZD,6CAaGA,EAbH,iBAaiBA,EAbjB,wCAcP,KAAKqH,UAAL,CAAgB,KAAKpG,OAAL,CAAa5H,WAA7B,EAA0CuO,OAA1C,CAdO,yEAAnB;WAoBOC,eAAP;;;SAIFC,QAAA,iBAAQ;;QAGFD,eAAe,GAAG,KAAKF,SAAL,EAAtB,CAHM;;;QAMFT,YAAY,GAAGxM,GAAC,CAACmN,eAAD,CAApB,CANM;;SASDX,YAAL,GAAoBA,YAApB;SACKa,OAAL,GAAeb,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,SAA7B,CAAf;SACKgI,YAAL,GAAoBf,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,eAA7B,CAApB;SACKiI,OAAL,GAAehB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,SAA7B,CAAf;SACKkI,YAAL,GAAoBjB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,eAA7B,CAApB;SACKkH,MAAL,GAAcD,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,QAA7B,CAAd;SACKmI,MAAL,GAAclB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,QAA7B,CAAd;SACKmH,MAAL,GAAcF,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,QAA7B,CAAd;SACKoI,MAAL,GAAcnB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,eAA7B,CAAd;SACKqI,SAAL,GAAiBpB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,kBAA7B,CAAjB;SACKsI,SAAL,GAAiBrB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,kBAA7B,CAAjB;SACKuI,OAAL,GAAetB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,iBAA7B,CAAf;SACKwI,QAAL,GAAgBvB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,kBAA7B,CAAhB;SACKyI,WAAL,GAAmBxB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,qBAA7B,CAAnB;SACK0I,WAAL,GAAmBzB,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,oBAA7B,CAAnB;SACK2I,WAAL,GAAmB1B,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,qBAA7B,CAAnB;SACK4I,YAAL,GAAoB3B,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,sBAA7B,CAApB;SACK6I,KAAL,GAAa5B,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,cAA7B,CAAb;SACK8I,KAAL,GAAa7B,YAAY,CAACc,IAAb,CAAkB/H,QAAQ,GAAG,cAA7B,CAAb,CA3BM;;SA8BDkH,MAAL,CAAYhI,QAAZ,CAAqB,aAArB;SACKiI,MAAL,CAAYjI,QAAZ,CAAqB,aAArB,EA/BM;;SAkCD+H,YAAL,CAAkBhG,GAAlB,CAAsB,SAAtB,EAAiCf,WAAW,CAAC,QAAD,CAA5C,EAlCM;;QAqCF,CAAC,KAAKc,OAAL,CAAa1G,UAAd,IAA4B,KAAK0G,OAAL,CAAa1G,UAAb,KAA4B0F,QAAQ,GAAG,QAAvE,EAAiF;WAC1E1F,UAAL,GAAkB,KAAK2M,YAAvB;KADF,MAEO;WACA3M,UAAL,GAAkB,KAAK2M,YAAL,CAAkBc,IAAlB,CAAuB,KAAK/G,OAAL,CAAa1G,UAApC,CAAlB;;;;SAKJyM,OAAA,gBAAO;QAED,CAAC,KAAK/F,OAAL,CAAa9G,cAAlB,EAAkC;MAChCO,GAAC,CAACuF,QAAQ,GAAG,QAAZ,CAAD,CAAuB+I,EAAvB,CAA0B,CAA1B,EAA6BC,MAA7B;KAHG;;;QAOD,CAACvO,GAAC,CAACuF,QAAQ,GAAG,QAAZ,CAAD,CAAuBqB,MAAxB,IAAkC,KAAKL,OAAL,CAAapI,YAAnD,EAAiE;MAE/D6B,GAAC,CAAC,MAAD,CAAD,CAAUwG,GAAV,CAAc;oBAAc;OAA5B;;UAEI1D,YAAY,EAAhB,EAAoB;YACdc,cAAc,GAAGN,iBAAiB,EAAtC;;YACIM,cAAJ,EAAoB;UAClB5D,GAAC,CAAC,MAAD,CAAD,CAAUwG,GAAV,CAAc;6BAAmB5C;WAAjC;;;;;SAMDwJ,KAAL;;SAEKoB,YAAL,CAAkB,YAAlB,EAAgC,KAAKzC,GAArC,EAtBK;;;IAyBL/L,GAAC,CAAC,MAAD,CAAD,CAAUyJ,MAAV,CAAiB,KAAK+C,YAAtB;SAEKiC,SAAL;SAEKC,WAAL,CAAiB,KAAKlC,YAAtB;;SAEKgC,YAAL,CAAkB,QAAlB,EAA4B,KAAKzC,GAAjC;;;SAIFhN,QAAA,iBAAQ;SAEDyP,YAAL,CAAkB,aAAlB,EAAiC,KAAKzC,GAAtC,EAFM;;;SAKDS,YAAL,CAAkB+B,MAAlB;SAEKvC,QAAL,GAAgB,KAAhB;SACKvE,WAAL,GAAmB,KAAnB;SACKrD,SAAL,GAAiB,KAAjB;SACK6H,WAAL,GAAmB,CAAnB;QAEI0C,SAAS,GAAG,CAAC3O,GAAC,CAACuF,QAAQ,GAAG,QAAZ,CAAD,CAAuBqB,MAAxC,CAZM;;QAeF+H,SAAS,IAAI,KAAKpI,OAAL,CAAapI,YAA9B,EAA4C;MAC1C6B,GAAC,CAAC,MAAD,CAAD,CAAUwG,GAAV,CAAc;oBAAc,EAAd;yBAAmC;OAAjD;KAhBI;;;QAoBFmI,SAAS,IAAI,KAAKpI,OAAL,CAAa9G,cAA9B,EAA8C;MAC5CgG,WAAW,CAAC,QAAD,CAAX,GAAwB,KAAKc,OAAL,CAAa3G,MAArC;KArBI;;;QAyBF,CAACI,GAAC,CAACuF,QAAQ,GAAG,QAAZ,CAAD,CAAuBqB,MAA5B,EAAoC;MAClC9B,EAAE,CAACgD,GAAH,CAAO7C,aAAa,GAAGO,QAAvB;MACAX,EAAE,CAACiD,GAAH,CAAO9C,YAAY,GAAGQ,QAAtB;;;SAGGgJ,YAAL,CAAkB,QAAlB,EAA4B,KAAKzC,GAAjC;;;SAIF2C,cAAA,qBAAY7I,KAAZ,EAAmB;QAEb+I,QAAQ,GAAG/J,EAAE,CAACuD,KAAH,EAAf;QACEyG,SAAS,GAAGhK,EAAE,CAACwD,MAAH,EADd;QAEEyG,UAAU,GAAGhK,EAAE,CAACgK,UAAH,EAFf;QAGEC,SAAS,GAAGjK,EAAE,CAACiK,SAAH,EAHd;QAKI9Q,UAAU,GAAG,KAAKsI,OAAL,CAAatI,UAA9B;QACEC,WAAW,GAAG,KAAKqI,OAAL,CAAarI,WAD7B,CAPiB;;QAWb,KAAKqI,OAAL,CAAalI,aAAjB,EAAgC;MAE9BwH,KAAK,CAACpB,QAAN,CAAea,EAAE,GAAG,WAApB;MAEAO,KAAK,CAACW,GAAN,CAAU;QACR4B,KAAK,EAAE,MADC;QAERC,MAAM,EAAE,MAFA;QAGRnC,IAAI,EAAE,CAHE;QAIRC,GAAG,EAAE;OAJP;WAOK6F,QAAL,GAAgB,IAAhB;WACKvE,WAAL,GAAmB,IAAnB;KAZF,MAcO;;MAGL5B,KAAK,CAACW,GAAN,CAAU;QACR4B,KAAK,EAAEnK,UADC;QAERoK,MAAM,EAAEnK,WAFA;QAGRgI,IAAI,EAAE,CAAC0I,QAAQ,GAAG3Q,UAAZ,IAA0B,CAA1B,GAA8B6Q,UAA9B,GAA2C,IAHzC;QAIR3I,GAAG,EAAE,CAAC0I,SAAS,GAAG3Q,WAAb,IAA4B,CAA5B,GAAgC6Q,SAAhC,GAA4C;OAJnD;;;;SAWJC,eAAA,sBAAatN,GAAb,EAAkB;;;QAEZkN,QAAQ,GAAG/J,EAAE,CAACuD,KAAH,EAAf;QACEyG,SAAS,GAAGhK,EAAE,CAACwD,MAAH,EADd;QAEEyG,UAAU,GAAGhK,EAAE,CAACgK,UAAH,EAFf;QAGEC,SAAS,GAAGjK,EAAE,CAACiK,SAAH,EAHd,CAFgB;;QAQZE,QAAQ,GAAG;MACb/I,IAAI,EAAE,KAAKuG,MAAL,CAAYjG,GAAZ,CAAgB,MAAhB,CADO;MAEb0I,KAAK,EAAE,KAAKzC,MAAL,CAAYjG,GAAZ,CAAgB,OAAhB,CAFM;MAGbL,GAAG,EAAE,KAAKsG,MAAL,CAAYjG,GAAZ,CAAgB,KAAhB,CAHQ;MAIb2I,MAAM,EAAE,KAAK1C,MAAL,CAAYjG,GAAZ,CAAgB,QAAhB,CAJK;MAKb4I,UAAU,EAAE,KAAK3C,MAAL,CAAYjG,GAAZ,CAAgB,mBAAhB,CALC;MAMb6I,WAAW,EAAE,KAAK5C,MAAL,CAAYjG,GAAZ,CAAgB,oBAAhB,CANA;MAOb8I,SAAS,EAAE,KAAK7C,MAAL,CAAYjG,GAAZ,CAAgB,kBAAhB,CAPE;MAQb+I,YAAY,EAAE,KAAK9C,MAAL,CAAYjG,GAAZ,CAAgB,qBAAhB;KARhB,CARgB;;QAoBZvI,UAAU,GAAGyD,GAAG,CAAC0G,KAAJ,GACf5F,kBAAkB,CAACyM,QAAQ,CAAC/I,IAAV,CADH,GAEf1D,kBAAkB,CAACyM,QAAQ,CAACC,KAAV,CAFH,GAGf1M,kBAAkB,CAACyM,QAAQ,CAACG,UAAV,CAHH,GAIf5M,kBAAkB,CAACyM,QAAQ,CAACI,WAAV,CAJpB;QAKEnR,WAAW,GAAGwD,GAAG,CAAC2G,MAAJ,GACZ7F,kBAAkB,CAACyM,QAAQ,CAAC9I,GAAV,CADN,GAEZ3D,kBAAkB,CAACyM,QAAQ,CAACE,MAAV,CAFN,GAGZ3M,kBAAkB,CAACyM,QAAQ,CAACK,SAAV,CAHN,GAIZ9M,kBAAkB,CAACyM,QAAQ,CAACM,YAAV,CATtB;QAWIjR,YAAY,GAAG,CAAC,KAAKiI,OAAL,CAAajI,YAAb,GAA4B,CAA5B,GAAgC,KAAKiI,OAAL,CAAajI,YAA7C,GAA4D,CAA7D,IAAkE,CAArF;;IAEE6M,KAAK,GAAGZ,IAAI,CAACiF,GAAL,CACNZ,QAAQ,IAAI3Q,UAAU,GAAGK,YAAjB,CADF,EAENuQ,SAAS,IAAI3Q,WAAW,GAAGI,YAAlB,CAFH,EAGN,CAHM,CAFV;QAQIwK,QAAQ,GAAGyB,IAAI,CAACC,GAAL,CAASvM,UAAU,GAAGkN,KAAtB,EAA6B,KAAK5E,OAAL,CAAatI,UAA1C,CAAf;QACE8K,SAAS,GAAGwB,IAAI,CAACC,GAAL,CAAStM,WAAW,GAAGiN,KAAvB,EAA8B,KAAK5E,OAAL,CAAarI,WAA3C,CADd;IAGA4K,QAAQ,GAAG,KAAKvC,OAAL,CAAanI,cAAb,GACP,KAAKmI,OAAL,CAAatI,UADN,GAEPsM,IAAI,CAACkF,KAAL,CAAW3G,QAAX,CAFJ;IAGAC,SAAS,GAAG,KAAKxC,OAAL,CAAanI,cAAb,GACR,KAAKmI,OAAL,CAAarI,WADL,GAERqM,IAAI,CAACkF,KAAL,CAAW1G,SAAX,CAFJ;QAII2G,WAAW,GAAG;MAChBtH,KAAK,EAAEU,QAAQ,GAAG,IADF;MAEhBT,MAAM,EAAEU,SAAS,GAAG,IAFJ;MAGhB7C,IAAI,EAAE,CAAC0I,QAAQ,GAAG9F,QAAZ,IAAwB,CAAxB,GAA4BgG,UAA5B,GAAyC,IAH/B;MAIhB3I,GAAG,EAAE,CAAC0I,SAAS,GAAG9F,SAAb,IAA0B,CAA1B,GAA8BgG,SAA9B,GAA0C;KAJjD,CAjDgB;;QAyDZ,KAAKxI,OAAL,CAAa7G,aAAjB,EAAgC;WACzB8M,YAAL,CAAkBmD,OAAlB,CAA0BD,WAA1B,EAAuC,YAAM;QAC3C,KAAI,CAACE,YAAL,CAAkBlO,GAAlB;OADF;KADF,MAIO;WACA8K,YAAL,CAAkBhG,GAAlB,CAAsBkJ,WAAtB;WACKE,YAAL,CAAkBlO,GAAlB;;;SAGGsK,QAAL,GAAgB,IAAhB;;;SAIFZ,uBAAA,8BAAqB9C,UAArB,EAAiCC,WAAjC,EAA8C;QAExC4C,KAAK,GAAG,CAAZ;;QAEI,CAAC,KAAK/G,SAAV,EAAqB;MACnB+G,KAAK,GAAGZ,IAAI,CAACiF,GAAL,CAASlH,UAAU,GAAG,KAAK5G,GAAL,CAAS0G,KAA/B,EAAsCG,WAAW,GAAG,KAAK7G,GAAL,CAAS2G,MAA7D,EAAqE,CAArE,CAAR;KADF,MAEO;MACL8C,KAAK,GAAGZ,IAAI,CAACiF,GAAL,CAASlH,UAAU,GAAG,KAAK5G,GAAL,CAAS2G,MAA/B,EAAuCE,WAAW,GAAG,KAAK7G,GAAL,CAAS0G,KAA9D,EAAqE,CAArE,CAAR;;;WAGK+C,KAAP;;;SAGFyE,eAAA,sBAAalO,GAAb,EAAkB;QAEZwC,SAAS,GAAG;MACdI,CAAC,EAAE,KAAKmI,MAAL,CAAYrE,KAAZ,EADW;MAEd7D,CAAC,EAAE,KAAKkI,MAAL,CAAYpE,MAAZ;KAFL;QAKI8C,KAAK,GAAG,KAAKC,oBAAL,CACVlH,SAAS,CAACI,CADA,EAEVJ,SAAS,CAACK,CAFA,CAAZ;SAKKmI,MAAL,CAAYlG,GAAZ,CAAgB;MACd4B,KAAK,EAAEmC,IAAI,CAACsF,IAAL,CAAUnO,GAAG,CAAC0G,KAAJ,GAAY+C,KAAtB,IAA+B,IADxB;MAEd9C,MAAM,EAAEkC,IAAI,CAACsF,IAAL,CAAUnO,GAAG,CAAC2G,MAAJ,GAAa8C,KAAvB,IAAgC,IAF1B;MAGdjF,IAAI,EAAE,CAAChC,SAAS,CAACI,CAAV,GAAciG,IAAI,CAACsF,IAAL,CAAUnO,GAAG,CAAC0G,KAAJ,GAAY+C,KAAtB,CAAf,IAA+C,CAA/C,GAAmD,IAH3C;MAIdhF,GAAG,EAAE,CAACjC,SAAS,CAACK,CAAV,GAAcgG,IAAI,CAACsF,IAAL,CAAUnO,GAAG,CAAC2G,MAAJ,GAAa8C,KAAvB,CAAf,IAAgD,CAAhD,GAAoD;KAJ3D,EAZgB;;IAoBhBnL,GAAC,CAAC4I,MAAF,CAAS,KAAK3E,SAAd,EAAyB;MACvBoH,SAAS,EAAE3J,GAAG,CAAC0G,KAAJ,GAAY+C,KADA;MAEvBG,UAAU,EAAE5J,GAAG,CAAC2G,MAAJ,GAAa8C,KAFF;MAGvBI,QAAQ,EAAE,CAACrH,SAAS,CAACI,CAAV,GAAc5C,GAAG,CAAC0G,KAAJ,GAAY+C,KAA3B,IAAoC,CAHvB;MAIvBK,OAAO,EAAE,CAACtH,SAAS,CAACK,CAAV,GAAc7C,GAAG,CAAC2G,MAAJ,GAAa8C,KAA5B,IAAqC,CAJvB;MAKvB/C,KAAK,EAAE1G,GAAG,CAAC0G,KAAJ,GAAY+C,KALI;MAMvB9C,MAAM,EAAE3G,GAAG,CAAC2G,MAAJ,GAAa8C,KANE;MAOvBjF,IAAI,EAAE,CAAChC,SAAS,CAACI,CAAV,GAAc5C,GAAG,CAAC0G,KAAJ,GAAY+C,KAA3B,IAAoC,CAPnB;MAQvBhF,GAAG,EAAE,CAACjC,SAAS,CAACK,CAAV,GAAc7C,GAAG,CAAC2G,MAAJ,GAAa8C,KAA5B,IAAqC;KAR5C,EApBgB;;IAgChBnH,aAAa,CACX;MACEM,CAAC,EAAE,KAAKoI,MAAL,CAAYtE,KAAZ,EADL;MAEE7D,CAAC,EAAE,KAAKmI,MAAL,CAAYrE,MAAZ;KAHM,EAKX;MACE/D,CAAC,EAAE,KAAKmI,MAAL,CAAYrE,KAAZ,EADL;MAEE7D,CAAC,EAAE,KAAKkI,MAAL,CAAYpE,MAAZ;KAPM,EASX,KAAKoE,MATM,EAUX,KAAKrI,SAVM,CAAb;SAaKqI,MAAL,CAAY/H,WAAZ,CAAwB,aAAxB;SACKgI,MAAL,CAAYhI,WAAZ,CAAwB,aAAxB,EA9CgB;;SAiDX8H,YAAL,CAAkBc,IAAlB,CAAuB/H,QAAQ,GAAG,SAAlC,EAA6CgJ,MAA7C,GAjDgB;;QAoDZ,KAAKhI,OAAL,CAAa7G,aAAb,IAA8B,CAAC,KAAK6G,OAAL,CAAa/F,kBAAhD,EAAoE;WAC7DkM,MAAL,CAAYoD,MAAZ;;;;SAKJvD,UAAA,iBAAQF,MAAR,EAAgBvL,EAAhB,EAAoBiP,GAApB,EAAyB;;;QAEnBC,UAAU,qBAAkB1K,EAAlB,qBAAd,CAFuB;;SAKlBkH,YAAL,CAAkB/C,MAAlB,CAAyBuG,UAAzB,EALuB;;SAQlBvD,MAAL,CAAYhI,QAAZ,CAAqB,aAArB;SACKiI,MAAL,CAAYjI,QAAZ,CAAqB,aAArB,EATuB;;SAYlBiI,MAAL,CAAYuD,UAAZ,CAAuB,OAAvB,EAAgCrP,IAAhC,CAAqC,KAArC,EAA4C,EAA5C;SACKwD,SAAL,GAAiB,KAAjB;SACK6H,WAAL,GAAmB,CAAnB;;QAEI,KAAK1F,OAAL,CAAa7G,aAAb,IAA8B,CAAC,KAAK6G,OAAL,CAAa/F,kBAAhD,EAAoE;WAC7DkM,MAAL,CAAYwD,IAAZ;;;SAGGxD,MAAL,CAAY9L,IAAZ,CAAiB,KAAjB,EAAwByL,MAAxB;IAEA9K,UAAU,CAAC8K,MAAD,EAAS,UAAC3K,GAAD,EAAS;;MAE1B,MAAI,CAACA,GAAL,GAAWA,GAAX,CAF0B;;MAK1B,MAAI,CAACuC,SAAL,GAAiB;QACfkM,aAAa,EAAEzO,GAAG,CAAC0G,KADJ;QAEfgI,cAAc,EAAE1O,GAAG,CAAC2G;OAFtB;;UAKI,MAAI,CAACZ,WAAL,IAAqB,MAAI,CAACuE,QAAL,IAAiB,MAAI,CAACzF,OAAL,CAAa5G,aAAvD,EAAuE;QACrE,MAAI,CAACiQ,YAAL,CAAkBlO,GAAlB;OADF,MAEO;QACL,MAAI,CAACsN,YAAL,CAAkBtN,GAAlB;OAbwB;;;UAiBtBZ,EAAJ,EAAQ;QACNA,EAAE,CAACuP,IAAH;;KAlBM,EAqBP,YAAM;;MAEP,MAAI,CAAC7D,YAAL,CAAkBc,IAAlB,CAAuB/H,QAAQ,GAAG,SAAlC,EAA6CgJ,MAA7C,GAFO;;;UAKHwB,GAAJ,EAAS;QACPA,GAAG,CAACM,IAAJ;;KA3BM,CAAV;;QA+BI,KAAK9J,OAAL,CAAavI,KAAjB,EAAwB;WACjBsS,WAAL,CAAiBjE,MAAjB;;;;SAKJiE,cAAA,qBAAYlO,GAAZ,EAAiB;QAEXpE,KAAK,GAAG,KAAKmO,SAAL,CAAe,KAAKC,UAApB,EAAgCpO,KAAhC,GACR,KAAKmO,SAAL,CAAe,KAAKC,UAApB,EAAgCpO,KADxB,GAERmE,mBAAmB,CAACC,GAAD,CAFvB;SAIKsL,MAAL,CAAY6C,IAAZ,CAAiBvS,KAAjB;;;SAIFwS,OAAA,cAAKC,IAAL,EAAW;SAEJjC,YAAL,CAAkB,cAAlB,EAAkC,KAAKpC,UAAvC;;SAEKA,UAAL,GAAkB,KAAKA,UAAL,GAAkBqE,IAApC;SAEKC,MAAL,CAAY,KAAKtE,UAAjB;;;SAIFsE,SAAA,gBAAOnQ,KAAP,EAAc;;;IAEZA,KAAK,GAAGA,KAAK,GAAG,KAAK4L,SAAL,CAAevF,MAA/B;;QAEIrG,KAAK,IAAI,CAAb,EAAgB;MACdA,KAAK,GAAGA,KAAK,GAAG,KAAK4L,SAAL,CAAevF,MAA/B;KADF,MAEO,IAAIrG,KAAK,GAAG,CAAZ,EAAe;MACpBA,KAAK,GAAG,CAAC,KAAK4L,SAAL,CAAevF,MAAf,GAAwBrG,KAAzB,IAAkC,KAAK4L,SAAL,CAAevF,MAAzD;;;SAGGwF,UAAL,GAAkB7L,KAAlB;SAEKgM,OAAL,CAAa,KAAKJ,SAAL,CAAe5L,KAAf,EAAsBI,GAAnC,EAAwC,YAAM;MAC5C,MAAI,CAAC6N,YAAL,CAAkB,SAAlB,EAA6BjO,KAA7B;KADF,EAEG,YAAM;MACP,MAAI,CAACiO,YAAL,CAAkB,SAAlB,EAA6BjO,KAA7B;KAHF;;;SAQFoQ,QAAA,eAAMtK,CAAN,EAAS;IAEPA,CAAC,CAACmB,cAAF;QAEIoJ,KAAK,GAAG,CAAZ;;QAEIvK,CAAC,CAACS,aAAF,CAAgB+J,MAApB,EAA4B;MAC1BD,KAAK,GAAGvK,CAAC,CAACS,aAAF,CAAgB+J,MAAhB,GAAyB,CAAzB,GAA6B,CAA7B,GAAiC,CAAC,CAA1C;KADF,MAEO,IAAIxK,CAAC,CAACS,aAAF,CAAgBgK,UAApB,EAAgC;MACrCF,KAAK,GAAG,CAACvK,CAAC,CAACS,aAAF,CAAgBgK,UAAjB,GAA8B,GAAtC;KADK,MAEA,IAAIzK,CAAC,CAACS,aAAF,CAAgBiK,MAApB,EAA4B;MACjCH,KAAK,GAAGvK,CAAC,CAACS,aAAF,CAAgBiK,MAAhB,GAAyB,CAAzB,GAA6B,CAA7B,GAAiC,CAAC,CAA1C;KAXK;;;QAeHC,KAAK,GAAG,CAACJ,KAAD,GAAS,KAAKrK,OAAL,CAAahI,cAAlC,CAfO;;QAkBH0S,OAAO,GAAG;MACZC,CAAC,EAAE7K,CAAC,CAACS,aAAF,CAAgBG,OAAhB,GAA0B,KAAKwF,MAAL,CAAYrF,MAAZ,GAAqBlB,IAA/C,GAAsDpB,EAAE,CAACgK,UAAH,EAD7C;MAEZqC,CAAC,EAAE9K,CAAC,CAACS,aAAF,CAAgBK,OAAhB,GAA0B,KAAKsF,MAAL,CAAYrF,MAAZ,GAAqBjB,GAA/C,GAAqDrB,EAAE,CAACiK,SAAH;KAF1D;SAKKqC,IAAL,CAAUJ,KAAV,EAAiBC,OAAjB,EAA0B5K,CAA1B;;;SAIF+K,OAAA,cAAKJ,KAAL,EAAYK,MAAZ,EAAoBhL,CAApB,EAAuB;;IAGrB2K,KAAK,GAAGA,KAAK,GAAG,CAAR,GAAa,KAAK,IAAIA,KAAT,CAAb,GAAiC,IAAIA,KAA7C,CAHqB;;IAMrBA,KAAK,GAAG,KAAKtE,MAAL,CAAYtE,KAAZ,KAAsB,KAAKnE,SAAL,CAAekM,aAArC,GAAqDa,KAA7D,CANqB;;;;;QAajBA,KAAK,GAAG,KAAKzK,OAAL,CAAa9H,QAArB,IAAiCuS,KAAK,GAAG,KAAKzK,OAAL,CAAa/H,QAA1D,EAAoE;;;;SAI/D8S,MAAL,CAAYN,KAAZ,EAAmBK,MAAnB,EAA2BhL,CAA3B;;;SAIFiL,SAAA,gBAAON,KAAP,EAAcK,MAAd,EAAsBhL,CAAtB,EAAyB;QAEnBqG,MAAM,GAAG,KAAKA,MAAlB;QACED,MAAM,GAAG,KAAKA,MADhB;QAEE8E,OAAO,GAAG;MACRjN,CAAC,EAAE,KAAKL,SAAL,CAAemE,KADV;MAER7D,CAAC,EAAE,KAAKN,SAAL,CAAeoE,MAFV;MAGR6I,CAAC,EAAE,KAAKjN,SAAL,CAAeiC,IAHV;MAIRiL,CAAC,EAAE,KAAKlN,SAAL,CAAekC;KANtB,CAFuB;;;QAanBjC,SAAS,GAAG;MACdI,CAAC,EAAEmI,MAAM,CAACrE,KAAP,EADW;MAEd7D,CAAC,EAAEkI,MAAM,CAACpE,MAAP,EAFW;MAGd6I,CAAC,EAAEzE,MAAM,CAACrF,MAAP,GAAgBlB,IAHL;MAIdiL,CAAC,EAAE1E,MAAM,CAACrF,MAAP,GAAgBjB;KAJrB;QAOIqL,QAAQ,GAAG,KAAKvN,SAAL,CAAekM,aAAf,GAA+Ba,KAA9C;QACES,SAAS,GAAG,KAAKxN,SAAL,CAAemM,cAAf,GAAgCY,KAD9C;;IAGEtI,OAAO,GAAG2I,MAAM,CAACH,CAAP,GAAW,CAACG,MAAM,CAACH,CAAP,GAAWK,OAAO,CAACL,CAApB,IAAyBK,OAAO,CAACjN,CAAjC,GAAqCkN,QAH5D;QAIE7I,MAAM,GAAG0I,MAAM,CAACF,CAAP,GAAW,CAACE,MAAM,CAACF,CAAP,GAAWI,OAAO,CAACJ,CAApB,IAAyBI,OAAO,CAAChN,CAAjC,GAAqCkN,SAJ3D,CApBuB;;QA2BnBtJ,CAAC,GAAG,CAAC,KAAK/D,SAAN,GAAkB,CAAlB,GAAsB,CAACoN,QAAQ,GAAGC,SAAZ,IAAyB,CAAvD;QACEC,WAAW,GAAG,CAAC,KAAKtN,SAAN,GAAkBoN,QAAlB,GAA6BC,SAD7C;QAEEE,YAAY,GAAG,CAAC,KAAKvN,SAAN,GAAkBqN,SAAlB,GAA8BD,QAF/C;QAIItH,OAAO,GAAGhG,SAAS,CAACI,CAAV,GAAckN,QAA5B;QACErH,OAAO,GAAGjG,SAAS,CAACK,CAAV,GAAckN,SAD1B,CA/BuB;;;;QAqCnBE,YAAY,IAAIzN,SAAS,CAACK,CAA9B,EAAiC;MAC/BoE,MAAM,GAAG,CAACzE,SAAS,CAACK,CAAV,GAAckN,SAAf,IAA4B,CAArC;KADF,MAEO;MACL9I,MAAM,GAAGA,MAAM,GAAGR,CAAT,GACLA,CADK,GAEJQ,MAAM,GAAIwB,OAAO,GAAGhC,CAApB,GACCQ,MADD,GAEEwB,OAAO,GAAGhC,CAJjB;;;QAOEuJ,WAAW,IAAIxN,SAAS,CAACI,CAA7B,EAAgC;MAC9BoE,OAAO,GAAG,CAACxE,SAAS,CAACI,CAAV,GAAckN,QAAf,IAA2B,CAArC;KADF,MAEO;MACL9I,OAAO,GAAGA,OAAO,GAAG,CAACP,CAAX,GACN,CAACA,CADK,GAELO,OAAO,GAAIwB,OAAO,GAAG/B,CAArB,GACCO,OADD,GAEEwB,OAAO,GAAG/B,CAJjB;KAlDqB;;;QA0DnBoC,IAAI,CAACqH,GAAL,CAAS,KAAK3N,SAAL,CAAeoH,SAAf,GAA2BmG,QAApC,IAAgD,KAAKvN,SAAL,CAAeoH,SAAf,GAA2B,IAA/E,EAAqF;WAC9EuE,YAAL,CAAkB,KAAKlO,GAAvB;KADF,MAEO;MACLgL,MAAM,CAAClG,GAAP,CAAW;QACT4B,KAAK,EAAEmC,IAAI,CAACkF,KAAL,CAAW+B,QAAX,IAAuB,IADrB;QAETnJ,MAAM,EAAEkC,IAAI,CAACkF,KAAL,CAAWgC,SAAX,IAAwB,IAFvB;QAGTvL,IAAI,EAAEqE,IAAI,CAACkF,KAAL,CAAW/G,OAAX,IAAsB,IAHnB;QAITvC,GAAG,EAAEoE,IAAI,CAACkF,KAAL,CAAW9G,MAAX,IAAqB;OAJ5B,EADK;;MASL3E,aAAa,CACX;QACEM,CAAC,EAAEiG,IAAI,CAACkF,KAAL,CAAWiC,WAAX,CADL;QAEEnN,CAAC,EAAEgG,IAAI,CAACkF,KAAL,CAAWkC,YAAX;OAHM,EAKX;QACErN,CAAC,EAAEJ,SAAS,CAACI,CADf;QAEEC,CAAC,EAAEL,SAAS,CAACK;OAPJ,EASX,KAAKkI,MATM,CAAb;KArEqB;;;IAoFvBzM,GAAC,CAAC4I,MAAF,CAAS,KAAK3E,SAAd,EAAyB;MACvBmE,KAAK,EAAEoJ,QADgB;MAEvBnJ,MAAM,EAAEoJ,SAFe;MAGvBvL,IAAI,EAAEwC,OAHiB;MAIvBvC,GAAG,EAAEwC;KAJP;;;SASFkJ,SAAA,gBAAOC,KAAP,EAAc;SAEP7F,WAAL,GAAmB,KAAKA,WAAL,GAAmB6F,KAAtC;;QAEK,KAAK7F,WAAL,GAAmB,EAApB,GAA0B,CAA1B,KAAgC,CAApC,EAAuC;WAChC7H,SAAL,GAAiB,KAAjB;KADF,MAEO;WACAA,SAAL,GAAiB,IAAjB;;;SAGG2N,QAAL,CAAc,KAAK9F,WAAnB;;;SAIF8F,WAAA,kBAASD,KAAT,EAAgB;SAETpF,MAAL,CAAYlG,GAAZ,CAAgB;MACdwL,SAAS,EAAE,YAAYF,KAAZ,GAAoB;KADjC;SAIKlC,YAAL,CAAkB;MAChBxH,KAAK,EAAE,KAAKnE,SAAL,CAAekM,aADN;MAEhB9H,MAAM,EAAE,KAAKpE,SAAL,CAAemM;KAFzB,EANc;;SAYT3D,MAAL,CAAY/H,WAAZ,CAAwB,SAAxB;;;SAIFuN,SAAA,kBAAS;;;QAEHC,aAAa,GAAGrR,QAAQ,CAAC,YAAM;UAE7B,MAAI,CAACmL,QAAT,EAAmB;YACb,MAAI,CAACvE,WAAT,EAAsB;UACpB,MAAI,CAACmI,YAAL,CAAkB;YAChBxH,KAAK,EAAE,MAAI,CAACnE,SAAL,CAAekM,aADN;YAEhB9H,MAAM,EAAE,MAAI,CAACpE,SAAL,CAAemM;WAFzB;SADF,MAKO;UACL,MAAI,CAACpB,YAAL,CAAkB;YAChB5G,KAAK,EAAE,MAAI,CAACnE,SAAL,CAAekM,aADN;YAEhB9H,MAAM,EAAE,MAAI,CAACpE,SAAL,CAAemM;WAFzB;;;KATsB,EAgBzB,GAhByB,CAA5B;WAkBO8B,aAAP;;;SAIFpT,WAAA,oBAAW;QAEL,CAAC,KAAK2I,WAAV,EAAuB;;WAEhBiC,SAAL,GAAiB;QACftB,KAAK,EAAE,KAAKoE,YAAL,CAAkBpE,KAAlB,EADQ;QAEfC,MAAM,EAAE,KAAKmE,YAAL,CAAkBnE,MAAlB,EAFO;QAGfnC,IAAI,EAAE,KAAKsG,YAAL,CAAkBpF,MAAlB,GAA2BlB,IAHlB;QAIfC,GAAG,EAAE,KAAKqG,YAAL,CAAkBpF,MAAlB,GAA2BjB;OAJlC;WAOKqG,YAAL,CAAkB/H,QAAlB,CAA2Ba,EAAE,GAAG,WAAhC;WAEKkH,YAAL,CAAkBhG,GAAlB,CAAsB;QACpB4B,KAAK,EAAE,MADa;QAEpBC,MAAM,EAAE,MAFY;QAGpBnC,IAAI,EAAE,CAHc;QAIpBC,GAAG,EAAE;OAJP;WAOKsB,WAAL,GAAmB,IAAnB;KAlBF,MAoBO;WAEA+E,YAAL,CAAkB9H,WAAlB,CAA8BY,EAAE,GAAG,WAAnC;WAEKkH,YAAL,CAAkBhG,GAAlB,CAAsB;QACpB4B,KAAK,EAAE,KAAKsB,SAAL,CAAetB,KAAf,GACH,KAAKsB,SAAL,CAAetB,KADZ,GAEH,KAAK7B,OAAL,CAAatI,UAHG;QAIpBoK,MAAM,EAAE,KAAKqB,SAAL,CAAerB,MAAf,GACJ,KAAKqB,SAAL,CAAerB,MADX,GAEJ,KAAK9B,OAAL,CAAarI,WANG;QAOpBgI,IAAI,EAAE,KAAKwD,SAAL,CAAexD,IAAf,GACF,KAAKwD,SAAL,CAAexD,IADb,GAEF,CAACrB,EAAE,CAACuD,KAAH,KAAa,KAAK7B,OAAL,CAAatI,UAA3B,IAAyC,CAAzC,GAA6C6G,EAAE,CAACgK,UAAH,EAT7B;QAUpB3I,GAAG,EAAE,KAAKuD,SAAL,CAAevD,GAAf,GACD,KAAKuD,SAAL,CAAevD,GADd,GAED,CAACtB,EAAE,CAACwD,MAAH,KAAc,KAAK9B,OAAL,CAAarI,WAA5B,IAA2C,CAA3C,GAA+C4G,EAAE,CAACiK,SAAH;OAZrD;WAeKtH,WAAL,GAAmB,KAAnB;;;SAGGmI,YAAL,CAAkB;MAChBxH,KAAK,EAAE,KAAKnE,SAAL,CAAekM,aADN;MAEhB9H,MAAM,EAAE,KAAKpE,SAAL,CAAemM;KAFzB;;;SAOFhR,aAAA,sBAAa;IAEX0C,iBAAiB,CAAC,KAAK0K,YAAL,CAAkB,CAAlB,CAAD,CAAjB;;;SAIF2F,UAAA,iBAAQ9L,CAAR,EAAW;QAEL,CAAC,KAAKE,OAAL,CAAaxI,QAAlB,EAA4B;aACnB,KAAP;;;QAGEqU,OAAO,GAAG/L,CAAC,CAAC+L,OAAF,IAAa/L,CAAC,CAACgM,KAAf,IAAwBhM,CAAC,CAACiM,QAAxC;QACEC,OAAO,GAAGlM,CAAC,CAACkM,OAAF,IAAalM,CAAC,CAACmM,OAD3B;QAEEC,MAAM,GAAGpM,CAAC,CAACoM,MAAF,IAAYpM,CAAC,CAACmM,OAFzB;;YAIQJ,OAAR;;WAEO,EAAL;aACO5B,IAAL,CAAU,CAAC,CAAX;;;;WAGG,EAAL;aACOA,IAAL,CAAU,CAAV;;;;WAGG,GAAL;aACOY,IAAL,CACE,KAAK7K,OAAL,CAAahI,cAAb,GAA8B,CADhC,EAEE;UAAE2S,CAAC,EAAE,KAAKzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;UAA8B+I,CAAC,EAAE,KAAK1E,MAAL,CAAYpE,MAAZ,KAAuB;SAF1D,EAGEhC,CAHF;;;;WAOG,GAAL;aACO+K,IAAL,CACE,CAAC,KAAK7K,OAAL,CAAahI,cAAd,GAA+B,CADjC,EAEE;UAAE2S,CAAC,EAAE,KAAKzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;UAA8B+I,CAAC,EAAE,KAAK1E,MAAL,CAAYpE,MAAZ,KAAuB;SAF1D,EAGEhC,CAHF;;;;WAOG,EAAL;aACO+K,IAAL,CACE,KAAK7K,OAAL,CAAahI,cAAb,GAA8B,CADhC,EAEE;UAAE2S,CAAC,EAAE,KAAKzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;UAA8B+I,CAAC,EAAE,KAAK1E,MAAL,CAAYpE,MAAZ,KAAuB;SAF1D,EAGEhC,CAHF;;;;WAOG,GAAL;aACO+K,IAAL,CACE,CAAC,KAAK7K,OAAL,CAAahI,cAAd,GAA+B,CADjC,EAEE;UAAE2S,CAAC,EAAE,KAAKzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;UAA8B+I,CAAC,EAAE,KAAK1E,MAAL,CAAYpE,MAAZ,KAAuB;SAF1D,EAGEhC,CAHF;;;;WAOG,EAAL;YACMkM,OAAO,IAAIE,MAAf,EAAuB;eAChBnB,MAAL,CACE,CADF,EAEE;YAAEJ,CAAC,EAAE,KAAKzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;YAA8B+I,CAAC,EAAE,KAAK1E,MAAL,CAAYpE,MAAZ,KAAuB;WAF1D,EAGEhC,CAHF;;;;;;WAQC,GAAL;YACMkM,OAAJ,EAAa;eACNV,MAAL,CAAY,CAAC,EAAb;;;;;;WAIC,GAAL;YACMU,OAAJ,EAAa;eACNV,MAAL,CAAY,EAAZ;;;;;;;;;SAQRpD,YAAA,qBAAY;;;SAELd,MAAL,CAAY7F,GAAZ,CAAgB/C,WAAW,GAAGS,QAA9B,EAAwC6B,EAAxC,CAA2CtC,WAAW,GAAGS,QAAzD,EAAmE,UAACa,CAAD,EAAO;MACxE,MAAI,CAACtH,KAAL;KADF;SAIK0N,MAAL,CAAY3E,GAAZ,CAAgB5C,WAAW,GAAGM,QAA9B,EAAwC6B,EAAxC,CAA2CnC,WAAW,GAAGM,QAAzD,EAAmE,UAACa,CAAD,EAAO;MACxE,MAAI,CAACsK,KAAL,CAAWtK,CAAX;KADF;SAIKyH,OAAL,CAAahG,GAAb,CAAiB/C,WAAW,GAAGS,QAA/B,EAAyC6B,EAAzC,CAA4CtC,WAAW,GAAGS,QAA1D,EAAoE,UAACa,CAAD,EAAO;MACzE,MAAI,CAAC+K,IAAL,CACE,MAAI,CAAC7K,OAAL,CAAahI,cAAb,GAA8B,CADhC,EAEE;QAAE2S,CAAC,EAAE,MAAI,CAACzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;QAA8B+I,CAAC,EAAE,MAAI,CAAC1E,MAAL,CAAYpE,MAAZ,KAAuB;OAF1D,EAGEhC,CAHF;KADF;SAQK0H,QAAL,CAAcjG,GAAd,CAAkB/C,WAAW,GAAGS,QAAhC,EAA0C6B,EAA1C,CAA6CtC,WAAW,GAAGS,QAA3D,EAAqE,UAACa,CAAD,EAAO;MAC1E,MAAI,CAAC+K,IAAL,CACE,CAAC,MAAI,CAAC7K,OAAL,CAAahI,cAAd,GAA+B,CADjC,EAEE;QAAE2S,CAAC,EAAE,MAAI,CAACzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;QAA8B+I,CAAC,EAAE,MAAI,CAAC1E,MAAL,CAAYpE,MAAZ,KAAuB;OAF1D,EAGEhC,CAHF;KADF;SAQK2H,WAAL,CAAiBlG,GAAjB,CAAqB/C,WAAW,GAAGS,QAAnC,EAA6C6B,EAA7C,CAAgDtC,WAAW,GAAGS,QAA9D,EAAwE,UAACa,CAAD,EAAO;MAC7E,MAAI,CAACiL,MAAL,CACE,CADF,EAEE;QAAEJ,CAAC,EAAE,MAAI,CAACzE,MAAL,CAAYrE,KAAZ,KAAsB,CAA3B;QAA8B+I,CAAC,EAAE,MAAI,CAAC1E,MAAL,CAAYpE,MAAZ,KAAuB;OAF1D,EAGEhC,CAHF;KADF;SAQK+H,KAAL,CAAWtG,GAAX,CAAe/C,WAAW,GAAGS,QAA7B,EAAuC6B,EAAvC,CAA0CtC,WAAW,GAAGS,QAAxD,EAAkE,YAAM;MACtE,MAAI,CAACgL,IAAL,CAAU,CAAC,CAAX;KADF;SAIKvC,WAAL,CAAiBnG,GAAjB,CAAqB/C,WAAW,GAAGS,QAAnC,EAA6C6B,EAA7C,CAAgDtC,WAAW,GAAGS,QAA9D,EAAwE,YAAM;MAC5E,MAAI,CAACpG,UAAL;KADF;SAIKiP,KAAL,CAAWvG,GAAX,CAAe/C,WAAW,GAAGS,QAA7B,EAAuC6B,EAAvC,CAA0CtC,WAAW,GAAGS,QAAxD,EAAkE,YAAM;MACtE,MAAI,CAACgL,IAAL,CAAU,CAAV;KADF;SAIKtC,WAAL,CAAiBpG,GAAjB,CAAqB/C,WAAW,GAAGS,QAAnC,EAA6C6B,EAA7C,CAAgDtC,WAAW,GAAGS,QAA9D,EAAwE,YAAM;MAC5E,MAAI,CAACqM,MAAL,CAAY,CAAC,EAAb;KADF;SAIK1D,YAAL,CAAkBrG,GAAlB,CAAsB/C,WAAW,GAAGS,QAApC,EAA8C6B,EAA9C,CAAiDtC,WAAW,GAAGS,QAA/D,EAAyE,YAAM;MAC7E,MAAI,CAACqM,MAAL,CAAY,EAAZ;KADF;SAIKjE,SAAL,CAAe9F,GAAf,CAAmB/C,WAAW,GAAGS,QAAjC,EAA2C6B,EAA3C,CAA8CtC,WAAW,GAAGS,QAA5D,EAAsE,YAAM;MAC1E,MAAI,CAAC1G,QAAL;KADF;IAIAgG,EAAE,CAACgD,GAAH,CAAO7C,aAAa,GAAGO,QAAvB,EAAiC6B,EAAjC,CAAoCpC,aAAa,GAAGO,QAApD,EAA8D,UAACa,CAAD,EAAO;MACnE,MAAI,CAAC8L,OAAL,CAAa9L,CAAb;KADF;IAIAxB,EAAE,CAACwC,EAAH,CAAMrC,YAAY,GAAGQ,QAArB,EAA+B,KAAKyM,MAAL,EAA/B;;;SAIFzD,eAAA,sBAAanI,CAAb,EAAgBqM,IAAhB,EAAsB;QAChB,KAAKnM,OAAL,CAAazG,SAAb,CAAuBuG,CAAvB,CAAJ,EAA+B;WACxBE,OAAL,CAAazG,SAAb,CAAuBuG,CAAvB,EAA0B/E,KAA1B,CAAgC,IAAhC,EAAsCtB,GAAC,CAAC8L,OAAF,CAAU4G,IAAV,IAAkBA,IAAlB,GAAyB,CAACA,IAAD,CAA/D;;;;;;;;;;;AAUN1S,GAAC,CAAC4I,MAAF,CAAS+C,WAAW,CAACgH,SAArB,EAAgC/U,SAAhC,EAA2CE,OAA3C,EAAoDD,SAApD;;;;;AAKAqF,MAAM,CAACyI,WAAP,GAAqBA,WAArB;;;;;AAMA,IAAIiH,IAAI,GAAG,IAAX;IACEC,WAAW,GAAG,SAAdA,WAAc,CAAUC,IAAV,EAAgBC,SAAhB,EAA2B;MAEnCnH,KAAK,GAAG,EAAZ;EAEA5L,GAAC,CAAC8S,IAAD,CAAD,CAAQrH,IAAR,CAAa,YAAY;QAEnB9K,GAAG,GAAGF,SAAS,CAAC,IAAD,CAAnB;IAEAmL,KAAK,CAACoH,IAAN,CAAW;MACTrS,GAAG,EAAEA,GADI;MAET3C,KAAK,EAAEgC,GAAC,CAAC,IAAD,CAAD,CAAQY,IAAR,CAAa,YAAb,CAFE;MAGTmS,SAAS,EAAEA;KAHb;GAJF;SAYOnH,KAAP;CAjBJ;;AAqBA5L,GAAC,CAACc,EAAF,CAAKmS,WAAL,GAAmB,UAAU1M,OAAV,EAAmB;EAEpCqM,IAAI,GAAG5S,GAAC,CAAC,IAAD,CAAR;EAEAuG,OAAO,GAAGA,OAAO,GAAGA,OAAH,GAAa,EAA9B,CAJoC;;OAO/B,IAAI2M,GAAT,IAAgB3M,OAAhB,EAAyB;QACnB,OAAQA,OAAO,CAAC2M,GAAD,CAAf,KAA0B,QAA1B,IAAsC,CAACC,KAAK,CAAC5M,OAAO,CAAC2M,GAAD,CAAR,CAAhD,EAAgE;MAC9D3M,OAAO,CAAC2M,GAAD,CAAP,GAAerQ,UAAU,CAAC0D,OAAO,CAAC2M,GAAD,CAAR,CAAzB;;GATgC;;;MAchC5I,IAAI,GAAGtK,GAAC,CAAC4I,MAAF,CAAS,IAAT,EAAe,EAAf,EAAmBiD,QAAnB,EAA6BtF,OAA7B,CAAX,CAdoC;;EAiBpCd,WAAW,CAAC,QAAD,CAAX,GAAwB6E,IAAI,CAAC1K,MAA7B;;MAEI,OAAO2G,OAAP,KAAmB,QAAvB,EAAiC,CAAjC,MAIO;IAELqM,IAAI,CAAC9K,GAAL,CAAS/C,WAAW,GAAGS,QAAvB,EAAiC6B,EAAjC,CAAoCtC,WAAW,GAAGS,QAAlD,EAA4D,UAAUa,CAAV,EAAa;MAEvEA,CAAC,CAACmB,cAAF,GAFuE;;MAIvEnB,CAAC,CAAC+M,eAAF,GAJuE;;UAOnExH,KAAK,GAAG,EAAZ;UACEyH,gBAAgB,GAAGrT,GAAC,CAAC,IAAD,CAAD,CAAQY,IAAR,CAAa,YAAb,CADrB;UAEE0S,SAAS,GAAGxO,EAAE,CAACwI,IAAH,CAAQ,kBAAkB+F,gBAAlB,GAAqC,IAA7C,CAFd;;UAIIA,gBAAgB,KAAKE,SAAzB,EAAoC;QAClC3H,KAAK,GAAGiH,WAAW,CAACS,SAAD,EAAYD,gBAAZ,CAAnB;QACA9M,OAAO,CAAC,OAAD,CAAP,GAAmBvG,GAAC,CAAC,IAAD,CAAD,CAAQO,KAAR,CAAc,kBAAkB8S,gBAAlB,GAAqC,IAAnD,CAAnB;OAFF,MAGO;QACLzH,KAAK,GAAGiH,WAAW,CAACD,IAAI,CAACY,GAAL,CAAS,cAAT,CAAD,CAAnB;QACAjN,OAAO,CAAC,OAAD,CAAP,GAAmBvG,GAAC,CAAC,IAAD,CAAD,CAAQO,KAAR,EAAnB;;;MAGFP,GAAC,CAAC,IAAD,CAAD,CAAQ0S,IAAR,CAAapN,EAAb,EAAiB,IAAIqG,WAAJ,CAAgBC,KAAhB,EAAuBrF,OAAvB,EAAgC,IAAhC,CAAjB;KAnBF;;;SAyBKqM,IAAP;CAlDF;;;;;;AAyDA9N,EAAE,CAACuC,EAAH,CAAMtC,WAAW,GAAGS,QAApB,EAA8B,WAAWF,EAAX,GAAgB,GAA9C,EAAmD,UAAUe,CAAV,EAAa;EAE9DuM,IAAI,GAAG5S,GAAC,CAAC,WAAWsF,EAAX,GAAgB,GAAjB,CAAR;EAEAe,CAAC,CAACmB,cAAF,GAJ8D;;MAO1DoE,KAAK,GAAG,EAAZ;MACEyH,gBAAgB,GAAGrT,GAAC,CAAC,IAAD,CAAD,CAAQY,IAAR,CAAa,YAAb,CADrB;MAEE0S,SAAS,GAAGxO,EAAE,CAACwI,IAAH,CAAQ,kBAAkB+F,gBAAlB,GAAqC,IAA7C,CAFd;;MAIIA,gBAAgB,KAAKE,SAAzB,EAAoC;IAClC3H,KAAK,GAAGiH,WAAW,CAACS,SAAD,EAAYD,gBAAZ,CAAnB;IACAxH,QAAQ,CAAC,OAAD,CAAR,GAAoB7L,GAAC,CAAC,IAAD,CAAD,CAAQO,KAAR,CAAc,kBAAkB8S,gBAAlB,GAAqC,IAAnD,CAApB;GAFF,MAGO;IACLzH,KAAK,GAAGiH,WAAW,CAACD,IAAI,CAACY,GAAL,CAAS,cAAT,CAAD,CAAnB;IACA3H,QAAQ,CAAC,OAAD,CAAR,GAAoB7L,GAAC,CAAC,IAAD,CAAD,CAAQO,KAAR,EAApB;;;EAGFP,GAAC,CAAC,IAAD,CAAD,CAAQ0S,IAAR,CAAapN,EAAb,EAAiB,IAAIqG,WAAJ,CAAgBC,KAAhB,EAAuBC,QAAvB,EAAiC,IAAjC,CAAjB;CAnBF;;;;"}